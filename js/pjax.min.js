(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.Pjax=e()}})(function(){var e,t,o;return function(){function u(r,s,a){function l(o,e){if(!s[o]){if(!r[o]){var t="function"==typeof require&&require;if(!e&&t)return t(o,!0);if(c)return c(o,!0);var n=new Error("Cannot find module '"+o+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[o]={exports:{}};r[o][0].call(i.exports,function(e){var t=r[o][1][e];return l(t||e)},i,i.exports,u,r,s,a)}return s[o].exports}for(var c="function"==typeof require&&require,e=0;e<a.length;e++)l(a[e]);return l}return u}()({1:[function(i,e,t){var s=i("./lib/execute-scripts");var a=i("./lib/foreach-els");var o=i("./lib/parse-options");var n=i("./lib/switches");var l=i("./lib/uniqueid");var r=i("./lib/events/on");var c=i("./lib/events/trigger");var u=i("./lib/util/clone");var f=i("./lib/util/contains");var h=i("./lib/util/extend");var d=i("./lib/util/noop");var p=function(e){this.state={numPendingSwitches:0,href:null,options:null};this.options=o(e);this.log("Pjax options",this.options);if(this.options.scrollRestoration&&"scrollRestoration"in history){history.scrollRestoration="manual"}this.maxUid=this.lastUid=l();this.parseDOM(document);r(window,"popstate",function(e){if(e.state){var t=u(this.options);t.url=e.state.url;t.title=e.state.title;t.history=false;t.scrollPos=e.state.scrollPos;if(e.state.uid<this.lastUid){t.backward=true}else{t.forward=true}this.lastUid=e.state.uid;this.loadUrl(e.state.url,t)}}.bind(this))};p.switches=n;p.prototype={log:i("./lib/proto/log"),getElements:function(e){return e.querySelectorAll(this.options.elements)},parseDOM:function(e){var t=i("./lib/proto/parse-element");a(this.getElements(e),t,this)},refresh:function(e){this.parseDOM(e||document)},reload:function(){window.location.reload()},attachLink:i("./lib/proto/attach-link"),attachForm:i("./lib/proto/attach-form"),forEachSelectors:function(e,t,o){return i("./lib/foreach-selectors").bind(this)(this.options.selectors,e,t,o)},switchSelectors:function(e,t,o,n){return i("./lib/switches-selectors").bind(this)(this.options.switches,this.options.switchesOptions,e,t,o,n)},latestChance:function(e){window.location=e},onSwitch:function(){c(window,"resize scroll");this.state.numPendingSwitches--;if(this.state.numPendingSwitches===0){this.afterAllSwitches()}},loadContent:function(e,t){if(typeof e!=="string"){c(document,"pjax:complete pjax:error",t);return}var o=document.implementation.createHTMLDocument("pjax");var n=/<html[^>]+>/gi;var i=/\s?[a-z:]+(?:=['"][^'">]+['"])*/gi;var r=e.match(n);if(r&&r.length){r=r[0].match(i);if(r.length){r.shift();r.forEach(function(e){var t=e.trim().split("=");if(t.length===1){o.documentElement.setAttribute(t[0],true)}else{o.documentElement.setAttribute(t[0],t[1].slice(1,-1))}})}}o.documentElement.innerHTML=e;this.log("load content",o.documentElement.attributes,o.documentElement.innerHTML.length);if(document.activeElement&&f(document,this.options.selectors,document.activeElement)){try{document.activeElement.blur()}catch(e){}}this.switchSelectors(this.options.selectors,o,document,t)},abortRequest:i("./lib/abort-request"),doRequest:i("./lib/send-request"),handleResponse:i("./lib/proto/handle-response"),loadUrl:function(e,t){t=typeof t==="object"?h({},this.options,t):u(this.options);this.log("load href",e,t);this.abortRequest(this.request);c(document,"pjax:send",t);this.request=this.doRequest(e,t,this.handleResponse.bind(this))},afterAllSwitches:function(){var e=Array.prototype.slice.call(document.querySelectorAll("[autofocus]")).pop();if(e&&document.activeElement!==e){e.focus()}this.options.selectors.forEach(function(e){a(document.querySelectorAll(e),function(e){s(e)})});var t=this.state;if(t.options.history){if(!window.history.state){this.lastUid=this.maxUid=l();window.history.replaceState({url:window.location.href,title:document.title,uid:this.maxUid,scrollPos:[0,0]},document.title)}this.lastUid=this.maxUid=l();window.history.pushState({url:t.href,title:t.options.title,uid:this.maxUid,scrollPos:[0,0]},t.options.title,t.href)}this.forEachSelectors(function(e){this.parseDOM(e)},this);c(document,"pjax:complete pjax:success",t.options);if(typeof t.options.analytics==="function"){t.options.analytics()}if(t.options.history){var o=document.createElement("a");o.href=this.state.href;if(o.hash){var n=o.hash.slice(1);n=decodeURIComponent(n);var i=0;var r=document.getElementById(n)||document.getElementsByName(n)[0];if(r){if(r.offsetParent){do{i+=r.offsetTop;r=r.offsetParent}while(r)}}window.scrollTo(0,i)}else if(t.options.scrollTo!==false){if(t.options.scrollTo.length>1){window.scrollTo(t.options.scrollTo[0],t.options.scrollTo[1])}else{window.scrollTo(0,t.options.scrollTo)}}}else if(t.options.scrollRestoration&&t.options.scrollPos){window.scrollTo(t.options.scrollPos[0],t.options.scrollPos[1])}this.state={numPendingSwitches:0,href:null,options:null}}};p.isSupported=i("./lib/is-supported");if(p.isSupported()){e.exports=p}else{var m=d;for(var v in p.prototype){if(p.prototype.hasOwnProperty(v)&&typeof p.prototype[v]==="function"){m[v]=d}}e.exports=m}},{"./lib/abort-request":2,"./lib/events/on":4,"./lib/events/trigger":5,"./lib/execute-scripts":6,"./lib/foreach-els":7,"./lib/foreach-selectors":8,"./lib/is-supported":9,"./lib/parse-options":10,"./lib/proto/attach-form":11,"./lib/proto/attach-link":12,"./lib/proto/handle-response":13,"./lib/proto/log":14,"./lib/proto/parse-element":15,"./lib/send-request":16,"./lib/switches":18,"./lib/switches-selectors":17,"./lib/uniqueid":19,"./lib/util/clone":20,"./lib/util/contains":21,"./lib/util/extend":22,"./lib/util/noop":23}],2:[function(e,t,o){var n=e("./util/noop");t.exports=function(e){if(e&&e.readyState<4){e.onreadystatechange=n;e.abort()}}},{"./util/noop":23}],3:[function(e,t,o){t.exports=function(e){var t=e.text||e.textContent||e.innerHTML||"";var o=e.src||"";var n=e.parentNode||document.querySelector("head")||document.documentElement;var i=document.createElement("script");if(t.match("document.write")){if(console&&console.log){console.log("Script contains document.write. Can’t be executed correctly. Code skipped ",e)}return false}i.type="text/javascript";i.id=e.id;if(o!==""){i.src=o;i.async=false}if(t!==""){try{i.appendChild(document.createTextNode(t))}catch(e){i.text=t}}n.appendChild(i);if((n instanceof HTMLHeadElement||n instanceof HTMLBodyElement)&&n.contains(i)){n.removeChild(i)}return true}},{}],4:[function(e,t,o){var i=e("../foreach-els");t.exports=function(e,t,o,n){t=typeof t==="string"?t.split(" "):t;t.forEach(function(t){i(e,function(e){e.addEventListener(t,o,n)})})}},{"../foreach-els":7}],5:[function(e,t,o){var i=e("../foreach-els");t.exports=function(t,e,n){e=typeof e==="string"?e.split(" "):e;e.forEach(function(e){var o;o=document.createEvent("HTMLEvents");o.initEvent(e,true,true);o.eventName=e;if(n){Object.keys(n).forEach(function(e){o[e]=n[e]})}i(t,function(e){var t=false;if(!e.parentNode&&e!==document&&e!==window){t=true;document.body.appendChild(e)}e.dispatchEvent(o);if(t){e.parentNode.removeChild(e)}})})}},{"../foreach-els":7}],6:[function(e,t,o){var n=e("./foreach-els");var i=e("./eval-script");t.exports=function(e){if(e.tagName.toLowerCase()==="script"){i(e)}n(e.querySelectorAll("script"),function(e){if(!e.type||e.type.toLowerCase()==="text/javascript"){if(e.parentNode){e.parentNode.removeChild(e)}i(e)}})}},{"./eval-script":3,"./foreach-els":7}],7:[function(e,t,o){t.exports=function(e,t,o){if(e instanceof HTMLCollection||e instanceof NodeList||e instanceof Array){return Array.prototype.forEach.call(e,t,o)}return t.call(o,e)}},{}],8:[function(e,t,o){var i=e("./foreach-els");t.exports=function(e,t,o,n){n=n||document;e.forEach(function(e){i(n.querySelectorAll(e),t,o)})}},{"./foreach-els":7}],9:[function(e,t,o){t.exports=function(){return window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/)}},{}],10:[function(e,t,o){var n=e("./switches");t.exports=function(e){e=e||{};e.elements=e.elements||"a[href], form[action]";e.selectors=e.selectors||["title",".js-Pjax"];e.switches=e.switches||{};e.switchesOptions=e.switchesOptions||{};e.history=typeof e.history==="undefined"?true:e.history;e.analytics=typeof e.analytics==="function"||e.analytics===false?e.analytics:i;e.scrollTo=typeof e.scrollTo==="undefined"?0:e.scrollTo;e.scrollRestoration=typeof e.scrollRestoration!=="undefined"?e.scrollRestoration:true;e.cacheBust=typeof e.cacheBust==="undefined"?true:e.cacheBust;e.debug=e.debug||false;e.timeout=e.timeout||0;e.currentUrlFullReload=typeof e.currentUrlFullReload==="undefined"?false:e.currentUrlFullReload;if(!e.switches.head){e.switches.head=n.switchElementsAlt}if(!e.switches.body){e.switches.body=n.switchElementsAlt}return e};function i(){if(window._gaq){_gaq.push(["_trackPageview"])}if(window.ga){ga("send","pageview",{page:location.pathname,title:document.title})}}},{"./switches":18}],11:[function(e,t,o){var n=e("../events/on");var r=e("../util/clone");var s="data-pjax-state";var i=function(e,t){if(c(t)){return}var o=r(this.options);o.requestOptions={requestUrl:e.getAttribute("action")||window.location.href,requestMethod:e.getAttribute("method")||"GET"};var n=document.createElement("a");n.setAttribute("href",o.requestOptions.requestUrl);var i=l(n,o);if(i){e.setAttribute(s,i);return}t.preventDefault();if(e.enctype==="multipart/form-data"){o.requestOptions.formData=new FormData(e)}else{o.requestOptions.requestParams=a(e)}e.setAttribute(s,"submit");o.triggerElement=e;this.loadUrl(n.href,o)};function a(e){var t=[];var o=e.elements;for(var n=0;n<o.length;n++){var i=o[n];var r=i.tagName.toLowerCase();if(!!i.name&&i.attributes!==undefined&&r!=="button"){var s=i.attributes.type;if(!s||s.value!=="checkbox"&&s.value!=="radio"||i.checked){var a=[];if(r==="select"){var l;for(var c=0;c<i.options.length;c++){l=i.options[c];if(l.selected&&!l.disabled){a.push(l.hasAttribute("value")?l.value:l.text)}}}else{a.push(i.value)}for(var u=0;u<a.length;u++){t.push({name:encodeURIComponent(i.name),value:encodeURIComponent(a[u])})}}}}return t}function l(e,t){if(e.protocol!==window.location.protocol||e.host!==window.location.host){return"external"}if(e.hash&&e.href.replace(e.hash,"")===window.location.href.replace(location.hash,"")){return"anchor"}if(e.href===window.location.href.split("#")[0]+"#"){return"anchor-empty"}if(t.currentUrlFullReload&&e.href===window.location.href.split("#")[0]){return"reload"}}var c=function(e){return e.defaultPrevented||e.returnValue===false};t.exports=function(t){var o=this;t.setAttribute(s,"");n(t,"submit",function(e){i.call(o,t,e)})}},{"../events/on":4,"../util/clone":20}],12:[function(e,t,o){var n=e("../events/on");var i=e("../util/clone");var r="data-pjax-state";var s=function(e,t){if(l(t)){return}var o=i(this.options);var n=a(e,t);if(n){e.setAttribute(r,n);return}t.preventDefault();if(this.options.currentUrlFullReload&&e.href===window.location.href.split("#")[0]){e.setAttribute(r,"reload");this.reload();return}e.setAttribute(r,"load");o.triggerElement=e;this.loadUrl(e.href,o)};function a(e,t){if(t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey){return"modifier"}if(e.protocol!==window.location.protocol||e.host!==window.location.host){return"external"}if(e.hash&&e.href.replace(e.hash,"")===window.location.href.replace(location.hash,"")){return"anchor"}if(e.href===window.location.href.split("#")[0]+"#"){return"anchor-empty"}}var l=function(e){return e.defaultPrevented||e.returnValue===false};t.exports=function(t){var o=this;t.setAttribute(r,"");n(t,"click",function(e){s.call(o,t,e)});n(t,"keyup",function(e){if(e.keyCode===13){s.call(o,t,e)}}.bind(this))}},{"../events/on":4,"../util/clone":20}],13:[function(e,t,o){var l=e("../util/clone");var c=e("../uniqueid");var u=e("../events/trigger");t.exports=function(e,t,o,n){n=l(n||this.options);n.request=t;if(e===false){u(document,"pjax:complete pjax:error",n);return}var i=window.history.state||{};window.history.replaceState({url:i.url||window.location.href,title:i.title||document.title,uid:i.uid||c(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href);var r=o;if(t.responseURL){if(o!==t.responseURL){o=t.responseURL}}else if(t.getResponseHeader("X-PJAX-URL")){o=t.getResponseHeader("X-PJAX-URL")}else if(t.getResponseHeader("X-XHR-Redirected-To")){o=t.getResponseHeader("X-XHR-Redirected-To")}var s=document.createElement("a");s.href=r;var a=s.hash;s.href=o;if(a&&!s.hash){s.hash=a;o=s.href}this.state.href=o;this.state.options=n;try{this.loadContent(e,n)}catch(e){u(document,"pjax:error",n);if(!this.options.debug){if(console&&console.error){console.error("Pjax switch fail: ",e)}return this.latestChance(o)}else{throw e}}}},{"../events/trigger":5,"../uniqueid":19,"../util/clone":20}],14:[function(e,t,o){t.exports=function(){if(this.options.debug&&console){if(typeof console.log==="function"){console.log.apply(console,arguments)}else if(console.log){console.log(arguments)}}}},{}],15:[function(e,t,o){var n="data-pjax-state";t.exports=function(e){switch(e.tagName.toLowerCase()){case"a":if(!e.hasAttribute(n)){this.attachLink(e)}break;case"form":if(!e.hasAttribute(n)){this.attachForm(e)}break;default:throw"Pjax can only be applied on <a> or <form> submit"}}},{}],16:[function(e,t,o){var f=e("./util/update-query-string");t.exports=function(t,o,n){o=o||{};var e;var i=o.requestOptions||{};var r=(i.requestMethod||"GET").toUpperCase();var s=i.requestParams||null;var a=i.formData||null;var l=null;var c=new XMLHttpRequest;var u=o.timeout||0;c.onreadystatechange=function(){if(c.readyState===4){if(c.status===200){n(c.responseText,c,t,o)}else if(c.status!==0){n(null,c,t,o)}}};c.onerror=function(e){console.log(e);n(null,c,t,o)};c.ontimeout=function(){n(null,c,t,o)};if(s&&s.length){e=s.map(function(e){return e.name+"="+e.value}).join("&");switch(r){case"GET":t=t.split("?")[0];t+="?"+e;break;case"POST":l=e;break}}else if(a){l=a}if(o.cacheBust){t=f(t,"t",Date.now())}c.open(r,t,true);c.timeout=u;c.setRequestHeader("X-Requested-With","XMLHttpRequest");c.setRequestHeader("X-PJAX","true");c.setRequestHeader("X-PJAX-Selectors",JSON.stringify(o.selectors));if(l&&r==="POST"&&!a){c.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}c.send(l);return c}},{"./util/update-query-string":24}],17:[function(e,t,o){var n=e("./foreach-els");var u=e("./switches");t.exports=function(s,a,e,t,o,l){var c=[];e.forEach(function(i){var e=t.querySelectorAll(i);var r=o.querySelectorAll(i);if(this.log){this.log("Pjax switch",i,e,r)}if(e.length!==r.length){throw"DOM doesn’t look the same on new loaded page: ’"+i+"’ - new "+e.length+", old "+r.length}n(e,function(e,t){var o=r[t];if(this.log){this.log("newEl",e,"oldEl",o)}var n=s[i]?s[i].bind(this,o,e,l,a[i]):u.outerHTML.bind(this,o,e,l);c.push(n)},this)},this);this.state.numPendingSwitches=c.length;c.forEach(function(e){e()})}},{"./foreach-els":7,"./switches":18}],18:[function(e,t,o){var f=e("./events/on");t.exports={outerHTML:function(e,t){e.outerHTML=t.outerHTML;this.onSwitch()},innerHTML:function(e,t){e.innerHTML=t.innerHTML;if(t.className===""){e.removeAttribute("class")}else{e.className=t.className}this.onSwitch()},switchElementsAlt:function(e,t){e.innerHTML=t.innerHTML;if(t.hasAttributes()){var o=t.attributes;for(var n=0;n<o.length;n++){e.attributes.setNamedItem(o[n].cloneNode())}}this.onSwitch()},replaceNode:function(e,t){e.parentNode.replaceChild(t,e);this.onSwitch()},sideBySide:function(e,t,o,n){var i=Array.prototype.forEach;var r=[];var s=[];var a=document.createDocumentFragment();var l="animationend webkitAnimationEnd MSAnimationEnd oanimationend";var c=0;var u=function(e){if(e.target!==e.currentTarget){return}c--;if(c<=0&&r){r.forEach(function(e){if(e.parentNode){e.parentNode.removeChild(e)}});s.forEach(function(e){e.className=e.className.replace(e.getAttribute("data-pjax-classes"),"");e.removeAttribute("data-pjax-classes")});s=null;r=null;this.onSwitch()}}.bind(this);n=n||{};i.call(e.childNodes,function(e){r.push(e);if(e.classList&&!e.classList.contains("js-Pjax-remove")){if(e.hasAttribute("data-pjax-classes")){e.className=e.className.replace(e.getAttribute("data-pjax-classes"),"");e.removeAttribute("data-pjax-classes")}e.classList.add("js-Pjax-remove");if(n.callbacks&&n.callbacks.removeElement){n.callbacks.removeElement(e)}if(n.classNames){e.className+=" "+n.classNames.remove+" "+(o.backward?n.classNames.backward:n.classNames.forward)}c++;f(e,l,u,true)}});i.call(t.childNodes,function(e){if(e.classList){var t="";if(n.classNames){t=" js-Pjax-add "+n.classNames.add+" "+(o.backward?n.classNames.forward:n.classNames.backward)}if(n.callbacks&&n.callbacks.addElement){n.callbacks.addElement(e)}e.className+=t;e.setAttribute("data-pjax-classes",t);s.push(e);a.appendChild(e);c++;f(e,l,u,true)}});e.className=t.className;e.appendChild(a)}}},{"./events/on":4}],19:[function(e,t,o){t.exports=function(){var t=0;return function(){var e="pjax"+(new Date).getTime()+"_"+t;t++;return e}}()},{}],20:[function(e,t,o){t.exports=function(e){if(null===e||"object"!==typeof e){return e}var t=e.constructor();for(var o in e){if(e.hasOwnProperty(o)){t[o]=e[o]}}return t}},{}],21:[function(e,t,o){t.exports=function e(t,o,n){for(var i=0;i<o.length;i++){var r=t.querySelectorAll(o[i]);for(var s=0;s<r.length;s++){if(r[s].contains(n)){return true}}}return false}},{}],22:[function(e,t,o){t.exports=function(e){if(e==null){return null}var t=Object(e);for(var o=1;o<arguments.length;o++){var n=arguments[o];if(n!=null){for(var i in n){if(Object.prototype.hasOwnProperty.call(n,i)){t[i]=n[i]}}}}return t}},{}],23:[function(e,t,o){t.exports=function(){}},{}],24:[function(e,t,o){t.exports=function(e,t,o){var n=new RegExp("([?&])"+t+"=.*?(&|$)","i");var i=e.indexOf("?")!==-1?"&":"?";if(e.match(n)){return e.replace(n,"$1"+t+"="+o+"$2")}else{return e+i+t+"="+o}}},{}]},{},[1])(1)});